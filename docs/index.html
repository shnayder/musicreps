<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Music Reps</title>
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">

  <style>
    :root {
  /* Brand (sage) */
  --color-brand: hsl(90, 35%, 45%);
  --color-brand-dark: hsl(90, 35%, 35%);
  --color-brand-bg: hsl(90, 25%, 94%);

  /* Semantic colors */
  --color-success: #4caf50;
  --color-success-dark: #388e3c;
  --color-success-bg: #e8f5e9;
  --color-success-text: #2e7d32;
  --color-error: #f44336;
  --color-error-bg: #ffebee;
  --color-error-text: #c62828;
  --color-focus: #2196f3;
  --color-focus-bg: #e3f2fd;
  --color-recommended: #ff9800;
  --color-highlight: #ffd700;

  /* UI accents */
  --color-toggle-active: hsl(90, 35%, 42%);
  --color-toggle-recommended: hsl(35, 80%, 55%);

  /* Text (warm neutrals) */
  --color-text: hsl(30, 5%, 20%);
  --color-text-muted: hsl(30, 3%, 40%);
  --color-text-light: hsl(30, 3%, 60%);

  /* Surfaces & backgrounds (warm neutrals) */
  --color-bg: #fff;
  --color-surface: hsl(30, 10%, 96%);
  --color-surface-hover: hsl(30, 8%, 93%);
  --color-surface-alt: hsl(30, 8%, 92%);
  --color-surface-pressed: hsl(30, 5%, 82%);
  --color-surface-accent: hsl(30, 8%, 90%);

  /* Borders (warm neutrals) */
  --color-border: hsl(30, 5%, 60%);
  --color-border-light: hsl(30, 5%, 80%);
  --color-border-lighter: hsl(30, 5%, 86%);

  /* Overlay */
  --color-overlay: rgba(0, 0, 0, 0.35);

  /* Heatmap scale (warm → sage, matches fretboard circle palette) */
  --heatmap-none: hsl(30, 4%, 85%);
  --heatmap-1: hsl(12, 48%, 65%);
  --heatmap-2: hsl(30, 48%, 58%);
  --heatmap-3: hsl(50, 40%, 50%);
  --heatmap-4: hsl(72, 38%, 42%);
  --heatmap-5: hsl(90, 45%, 35%);

  /* Typography scale */
  --text-xs: 0.75rem;
  --text-sm: 0.85rem;
  --text-base: 1rem;
  --text-md: 1.125rem;
  --text-lg: 1.3rem;
  --text-xl: 1.5rem;
  --text-2xl: 2rem;

  /* Spacing scale */
  --space-1: 0.125rem;
  --space-2: 0.25rem;
  --space-3: 0.5rem;
  --space-4: 0.75rem;
  --space-5: 1rem;
  --space-6: 1.5rem;
}

* {
  -webkit-tap-highlight-color: transparent;
}
html {
  background: var(--color-surface);
  overscroll-behavior: none;
}
body {
  font-family: system-ui, -apple-system, sans-serif;
  max-width: 650px;
  margin: 0 auto;
  padding: 0 var(--space-5);
  padding-top: env(safe-area-inset-top, 0);
  padding-bottom: env(safe-area-inset-bottom, 0);
  padding-left: max(var(--space-5), env(safe-area-inset-left, 0));
  padding-right: max(var(--space-5), env(safe-area-inset-right, 0));
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  min-height: 100dvh;
  color: var(--color-text);
  background: var(--color-bg);
  border-left: 1px solid var(--color-border-lighter);
  border-right: 1px solid var(--color-border-lighter);
  overscroll-behavior: none;
}

/* --- Home screen --- */
.home-screen {
  display: flex;
  flex-direction: column;
  min-height: 100dvh;
  padding: var(--space-5);
}
.home-screen.hidden {
  display: none;
}
.home-header {
  text-align: center;
  padding: var(--space-6) 0 var(--space-4);
}
.home-title {
  font-size: var(--text-2xl);
  font-weight: 700;
  color: var(--color-text);
  margin: 0;
}
.home-modes {
  flex: 1;
}
.home-group-label {
  font-size: var(--text-xs);
  font-weight: 600;
  text-transform: uppercase;
  color: var(--color-text-muted);
  letter-spacing: 0.05em;
  margin-top: var(--space-5);
  margin-bottom: var(--space-2);
  padding-left: var(--space-2);
}
.home-group-label:first-child {
  margin-top: 0;
}
.home-mode-btn {
  display: flex;
  flex-direction: column;
  width: 100%;
  text-align: left;
  padding: var(--space-4) var(--space-4);
  background: var(--color-bg);
  border: 1px solid var(--color-border-lighter);
  border-radius: 8px;
  margin-bottom: var(--space-2);
  cursor: pointer;
}
.home-mode-btn:hover {
  background: var(--color-surface);
}
.home-mode-btn:active {
  background: var(--color-surface-pressed);
}
.home-mode-name {
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--color-text);
}
.home-mode-desc {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}
.home-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4) 0;
  border-top: 1px solid var(--color-border-lighter);
  margin-top: var(--space-4);
}
.home-settings-btn {
  background: none;
  border: 1px solid var(--color-border-light);
  border-radius: 6px;
  padding: var(--space-2) var(--space-4);
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  cursor: pointer;
  margin: 0;
  min-height: 44px;
  display: flex;
  align-items: center;
}
.home-settings-btn:hover {
  background: var(--color-surface-hover);
}
.home-settings-btn:active {
  background: var(--color-surface-pressed);
}
.version {
  font-size: var(--text-xs);
  color: var(--color-text-light);
}

/* --- Mode top bar --- */
.mode-top-bar {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) 0;
  margin-bottom: var(--space-3);
}
.mode-back-btn {
  background: none;
  border: none;
  font-size: var(--text-xl);
  cursor: pointer;
  padding: var(--space-2);
  min-width: 44px;
  min-height: 44px;
  color: var(--color-text-muted);
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
}
.mode-back-btn:hover {
  background: var(--color-surface-hover);
}
.mode-back-btn:active {
  background: var(--color-surface-pressed);
}
.mode-title {
  margin: 0;
  font-size: var(--text-lg);
  font-weight: 600;
  flex: 1;
}
/* Hide back button during active quiz and calibration; keep title visible */
.phase-active .mode-back-btn,
.phase-calibration .mode-back-btn,
.phase-round-complete .mode-back-btn {
  display: none;
}
.phase-active .mode-top-bar,
.phase-calibration .mode-top-bar,
.phase-round-complete .mode-top-bar {
  margin-bottom: 0;
}

/* --- Settings modal --- */
.settings-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--color-overlay);
  z-index: 200;
  justify-content: center;
  align-items: center;
}
.settings-overlay.open {
  display: flex;
}
.settings-modal {
  background: var(--color-bg);
  border-radius: 12px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
  width: 280px;
  max-width: 90vw;
  overflow: hidden;
}
.settings-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-4) var(--space-5);
  border-bottom: 1px solid var(--color-border);
}
.settings-title {
  font-weight: 600;
  font-size: var(--text-base);
}
.settings-close-btn {
  background: none;
  border: none;
  font-size: var(--text-xl);
  cursor: pointer;
  color: var(--color-text);
  padding: 0;
  line-height: 1;
  opacity: 0.6;
}
.settings-close-btn:hover {
  opacity: 1;
}
.settings-close-btn:active {
  opacity: 0.4;
}
.settings-body {
  padding: var(--space-5);
}
.settings-field {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}
.settings-label {
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--color-text-muted);
}
.settings-toggle-group {
  display: flex;
  gap: 0;
  border-radius: 8px;
  overflow: hidden;
  border: 1px solid var(--color-border);
}
.settings-toggle-btn {
  flex: 1;
  padding: var(--space-3) var(--space-4);
  border: none;
  background: var(--color-surface);
  cursor: pointer;
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--color-text);
  transition: background 0.15s ease, color 0.15s ease;
}
.settings-toggle-btn + .settings-toggle-btn {
  border-left: 1px solid var(--color-border);
}
.settings-toggle-btn.active {
  background: var(--color-brand);
  color: white;
}
.settings-toggle-btn:hover:not(.active) {
  background: var(--color-surface-hover);
}
.settings-toggle-btn:active {
  opacity: 0.8;
}

/* --- Mode screens --- */
.mode-screen {
  display: none;
  padding-top: var(--space-3);
  flex: 1;
}
.mode-screen.mode-active {
  display: block;
}

/* --- Phase-driven visibility --- */
.quiz-session {
  position: relative;
}
.phase-idle .quiz-session {
  display: none;
}

/* Hide tabs and tab content during non-idle phases */
/* .tab-content.active needs explicit override (higher specificity than .tab-content.active display:block) */
.phase-active .mode-tabs,
.phase-active .tab-content,
.phase-active .tab-content.active,
.phase-calibration .mode-tabs,
.phase-calibration .tab-content,
.phase-calibration .tab-content.active,
.phase-round-complete .mode-tabs,
.phase-round-complete .tab-content,
.phase-round-complete .tab-content.active {
  display: none;
}

/* Element-level visibility (replaces inline style="display: none;") */
.mastery-message {
  display: none;
}
.mastery-message.mastery-visible {
  display: block;
}
.round-complete {
  display: none;
}
.phase-round-complete .round-complete {
  display: block;
}
.stats-container.stats-hidden {
  display: none;
}
.fretboard-wrapper.fretboard-hidden {
  display: none;
}

/* --- Mode tabs (Practice / Progress) --- */
.mode-tabs {
  display: flex;
  gap: 0;
  border-bottom: 2px solid var(--color-border-lighter);
  margin-bottom: var(--space-5);
}
.mode-tab {
  flex: 1;
  padding: var(--space-3) var(--space-5);
  border: none;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  background: none;
  font-size: var(--text-base);
  font-weight: 500;
  color: var(--color-text-muted);
  cursor: pointer;
  transition: color 0.15s ease, border-color 0.15s ease;
}
.mode-tab:hover {
  color: var(--color-text);
}
.mode-tab.active {
  color: var(--color-brand-dark);
  border-bottom-color: var(--color-brand);
  font-weight: 600;
}
.tab-content {
  display: none;
}
.tab-content.active {
  display: block;
}

/* --- Practice card --- */
.practice-card {
  margin-bottom: var(--space-4);
  padding: var(--space-4) var(--space-5);
  background: var(--color-surface);
  border-radius: 8px;
}
.practice-zone + .practice-zone {
  margin-top: var(--space-5);
  padding-top: var(--space-5);
  border-top: 1px solid var(--color-border-lighter);
}
.practice-status {
  margin-bottom: var(--space-3);
}
.practice-status:empty,
.practice-status-label:empty + .practice-status-detail:empty {
  display: none;
}
.practice-status-label {
  font-weight: 600;
  font-size: var(--text-base);
  color: var(--color-text);
}
.practice-status-detail {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  margin-left: var(--space-3);
}
.practice-recommendation {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  flex-wrap: wrap;
}
.practice-recommendation:empty,
.practice-rec-text:empty ~ .practice-rec-btn {
  display: none;
}
.practice-rec-text {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}
.practice-rec-text:empty {
  display: none;
}
.practice-rec-btn {
  font-size: var(--text-xs);
  font-weight: 500;
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--color-brand);
  border-radius: 6px;
  background: var(--color-brand-bg);
  color: var(--color-brand-dark);
  cursor: pointer;
  margin: 0;
  transition: background 0.15s ease;
}
.practice-rec-btn:hover {
  background: var(--color-brand);
  color: white;
}
.practice-rec-btn.hidden {
  display: none;
}

/* --- Practice scope (inside practice card) --- */
.practice-scope {
  margin-top: var(--space-4);
}
.practice-scope .settings-row {
  margin-bottom: 0;
}

/* --- Practice action zone (inside practice card) --- */
.practice-zone-action {
  text-align: center;
}
.session-summary-text {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  margin-bottom: var(--space-3);
}
.session-summary-text:empty {
  display: none;
}

/* --- Baseline info (Progress tab) --- */
.baseline-info {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  text-align: center;
  padding: var(--space-3) var(--space-4);
  margin-bottom: var(--space-3);
}
.baseline-info:empty {
  display: none;
}
.baseline-default-tag {
  font-style: italic;
  color: var(--color-text-light);
}
.baseline-rerun-btn {
  background: none;
  border: 1px solid var(--color-border-light);
  border-radius: 6px;
  padding: var(--space-2) var(--space-4);
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--color-text-muted);
  cursor: pointer;
  margin: 0;
  margin-left: var(--space-2);
  transition: background 0.15s ease, border-color 0.15s ease;
}
.baseline-rerun-btn:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-border);
}
.baseline-rerun-btn:active {
  background: var(--color-surface-pressed);
}

/* --- Progress tab stats controls (within tab) --- */
.tab-content .stats-controls {
  text-align: center;
  margin: var(--space-3) 0;
  padding-bottom: var(--space-2);
}

/* --- Fretboard --- */
.fretboard-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}
.string-toggles {
  display: flex;
  flex-direction: row;
  gap: var(--space-1);
  justify-content: center;
}
.string-toggle {
  width: 36px;
  height: 36px;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  background: var(--color-surface);
  color: var(--color-border);
  font-size: var(--text-sm);
  font-weight: 500;
  cursor: pointer;
  padding: 0;
  margin: 0;
  transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
}
.string-toggle:hover {
  background: var(--color-surface-hover);
}
.string-toggle.active {
  background: var(--color-toggle-active);
  color: white;
  border-color: var(--color-toggle-active);
}
.string-toggle.recommended {
  box-shadow: 0 0 0 2px var(--color-toggle-recommended);
}
.string-toggle.active.recommended {
  border-color: var(--color-toggle-recommended);
}
.distance-toggles {
  display: flex;
  flex-direction: row;
  gap: var(--space-1);
  justify-content: center;
}
.distance-toggle {
  height: 36px;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  background: var(--color-surface);
  color: var(--color-border);
  font-size: var(--text-xs);
  font-weight: 500;
  cursor: pointer;
  padding: 0 0.4rem;
  margin: 0;
  transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
}
.distance-toggle:hover {
  background: var(--color-surface-hover);
}
.distance-toggle.active {
  background: var(--color-toggle-active);
  color: white;
  border-color: var(--color-toggle-active);
}
.distance-toggle.recommended {
  box-shadow: 0 0 0 2px var(--color-toggle-recommended);
}
.distance-toggle.active.recommended {
  border-color: var(--color-toggle-recommended);
}
.notes-toggles {
  display: flex;
  flex-direction: row;
  gap: var(--space-1);
  justify-content: center;
}
.notes-toggle {
  height: 36px;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  background: var(--color-surface);
  color: var(--color-border);
  font-size: var(--text-xs);
  font-weight: 500;
  cursor: pointer;
  padding: 0 0.6rem;
  margin: 0;
  transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
}
.notes-toggle:hover {
  background: var(--color-surface-hover);
}
.notes-toggle.active {
  background: var(--color-toggle-active);
  color: white;
  border-color: var(--color-toggle-active);
}
.fretboard-container {
  position: relative;
  width: 100%;
  min-width: 0;
  max-width: 1200px;
}
.fretboard {
  width: 100%;
  height: auto;
  display: block;
  background: var(--color-bg);
  touch-action: manipulation;
}
/* SVG fretboard — new circle-based design */
.fb-string {
  stroke: hsl(30, 8%, 72%);
}
.fb-fret {
  stroke: hsl(30, 5%, 82%);
}
.fb-nut {
  fill: hsl(30, 8%, 48%);
}
.fb-marker {
  fill: hsl(30, 5%, 62%);
}
.fb-pos {
  fill: hsl(30, 5%, 90%);
  stroke: none;
  cursor: pointer;
  transition: fill 0.15s;
}

/* Hover card */
.hover-card {
  position: absolute;
  pointer-events: none;
  z-index: 10;
  opacity: 0;
  transition: opacity 0.12s;
}
.hover-card.visible {
  opacity: 1;
}
.hc-inner {
  background: var(--color-bg);
  border: 1px solid var(--color-border-light);
  border-radius: 8px;
  padding: 0.35rem 0.5rem;
  min-width: 65px;
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12);
  text-align: center;
}
.hc-note {
  font-size: var(--text-sm);
  font-weight: 700;
  color: var(--color-text);
}
.hc-string-fret {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: 0.05rem;
}
.hc-detail {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  margin-top: 0.12rem;
}
.hc-bar {
  height: 3px;
  border-radius: 2px;
  background: hsl(30, 5%, 90%);
  margin-top: 0.25rem;
  overflow: hidden;
}
.hc-bar-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.2s;
}

.settings-row {
  display: flex;
  align-items: center;
  gap: var(--space-5);
  justify-content: center;
  margin-bottom: var(--space-3);
}
button {
  padding: var(--space-3) var(--space-6);
  font-size: var(--text-base);
  cursor: pointer;
  margin: 0 var(--space-3);
}
.mastery-message {
  background: var(--color-success-bg);
  color: var(--color-success-text);
  font-weight: bold;
  font-size: var(--text-base);
  padding: var(--space-3) var(--space-5);
  margin-bottom: var(--space-3);
  border-radius: 6px;
  text-align: center;
}

/* --- Primary CTA (Start Quiz) --- */
.start-btn {
  background: var(--color-brand);
  color: white;
  border: 2px solid var(--color-brand);
  border-radius: 8px;
  font-weight: 600;
  font-size: var(--text-md);
  padding: var(--space-4) var(--space-6);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
  transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
}
.start-btn:hover {
  background: var(--color-brand-dark);
  border-color: var(--color-brand-dark);
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.18);
}
.start-btn:active {
  transform: scale(0.98);
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}

/* --- Quiz countdown row — bar + timer side by side --- */
.quiz-countdown-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  margin-bottom: var(--space-2);
}
.quiz-countdown-bar {
  flex: 1;
  height: 4px;
  background: var(--color-surface-alt);
  margin-left: calc(-1 * var(--space-5));
}
.quiz-countdown-fill {
  height: 100%;
  background: var(--color-brand);
  transition: width 0.2s linear;
  width: 100%;
}
.round-timer-warning .quiz-countdown-fill,
.last-question .quiz-countdown-fill {
  background: var(--color-error);
}
.quiz-info-time {
  font-size: var(--text-xs);
  font-variant-numeric: tabular-nums;
  color: var(--color-text-muted);
  white-space: nowrap;
}

/* --- Quiz session info — single compact row --- */
.quiz-session-info {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  padding: 0 var(--space-6) var(--space-2) 0;
}
.quiz-info-context {
  flex: 1;
}
.quiz-info-count {
  font-variant-numeric: tabular-nums;
}
.quiz-header-close {
  position: absolute;
  top: var(--space-3);
  right: 0;
  background: none;
  border: none;
  font-size: var(--text-xl);
  color: var(--color-text-light);
  cursor: pointer;
  padding: 0 var(--space-2);
  line-height: 1;
  margin: 0;
  border-radius: 4px;
  transition: color 0.15s ease, background 0.15s ease;
  z-index: 1;
}
.quiz-header-close:hover {
  color: var(--color-text);
  background: var(--color-surface-hover);
}

/* --- Progress bar --- */
.progress-bar {
  width: 100%;
  max-width: 300px;
  height: 20px;
  background: var(--color-surface-alt);
  border-radius: 10px;
  margin: 0 auto var(--space-4);
  overflow: hidden;
  position: relative;
}
.phase-active .progress-bar,
.phase-round-complete .progress-bar {
  display: none;
}
.progress-fill {
  height: 100%;
  background: var(--color-success);
  border-radius: 10px;
  transition: width 0.3s ease;
  min-width: 0;
}
.progress-text {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--color-text);
  pointer-events: none;
}

/* --- Quiz-active visual focus --- */
.phase-active,
.phase-round-complete,
.phase-calibration {
  background: var(--color-surface);
  margin: 0 calc(-1 * var(--space-5));
  padding: 0 var(--space-5);
}
/* --- Quiz area (subtle card containment) --- */
/* Phase-driven visibility: shown during active, round-complete, calibration */
.quiz-area {
  display: none;
  text-align: center;
  margin: var(--space-5) 0;
  border: 2px solid transparent;
}
.phase-active .quiz-area,
.phase-round-complete .quiz-area,
.phase-calibration .quiz-area {
  display: block;
  background: var(--color-surface);
  border-radius: 12px;
  padding: var(--space-5);
}
.phase-active .quiz-area {
  border: 1px solid var(--color-border-lighter);
  padding: var(--space-3) var(--space-3);
}
/* --- Round complete --- */
.round-complete {
  text-align: center;
  padding: var(--space-6) 0;
}
.round-complete-context {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
}
.round-complete-heading {
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: var(--space-3);
}
.round-complete-stats {
  margin: var(--space-3) 0 var(--space-5);
}
.round-stat-line {
  font-size: var(--text-base);
  color: var(--color-text);
  line-height: 1.6;
}
.round-complete-actions {
  display: flex;
  gap: var(--space-3);
  justify-content: center;
}
.round-complete-continue {
  padding: var(--space-3) var(--space-5);
  background: var(--color-brand);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: var(--text-base);
  font-weight: 600;
  cursor: pointer;
}
.round-complete-continue:hover {
  opacity: 0.9;
}
.round-complete-continue:active {
  opacity: 0.8;
  transform: scale(0.98);
}
.round-complete-stop {
  padding: var(--space-3) var(--space-5);
  background: none;
  color: var(--color-text-muted);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  font-size: var(--text-base);
  cursor: pointer;
}
.round-complete-stop:hover {
  background: var(--color-surface-hover);
}
.round-complete-stop:active {
  background: var(--color-surface-pressed);
}
/* Hide quiz prompt, answer buttons, and feedback during round-complete */
.phase-round-complete .quiz-prompt-row,
.phase-round-complete .answer-buttons,
.phase-round-complete .note-buttons,
.phase-round-complete .chord-slots,
.phase-round-complete .feedback,
.phase-round-complete .hint,
.phase-round-complete .time-display,
.phase-round-complete .speed-tap-status,
.phase-round-complete .fretboard-wrapper,
.phase-round-complete .quiz-countdown-row,
.phase-round-complete .quiz-session-info,
.phase-round-complete .quiz-header-close {
  display: none;
}

/* --- Note buttons (piano-style layout) --- */
.note-buttons {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  margin: var(--space-3) auto;
}
.note-row-naturals,
.note-row-accidentals {
  display: grid;
  grid-template-columns: repeat(14, 1fr);
  column-gap: 2px; /* sub-column separator; --space-1 too wide for 14-col grid */
}
.note-row-accidentals.hidden {
  display: none;
}
/* Natural notes: each spans 2 of 14 sub-columns */
.note-row-naturals .note-btn:nth-child(1) {
  grid-column: 1 / 3;
}
.note-row-naturals .note-btn:nth-child(2) {
  grid-column: 3 / 5;
}
.note-row-naturals .note-btn:nth-child(3) {
  grid-column: 5 / 7;
}
.note-row-naturals .note-btn:nth-child(4) {
  grid-column: 7 / 9;
}
.note-row-naturals .note-btn:nth-child(5) {
  grid-column: 9 / 11;
}
.note-row-naturals .note-btn:nth-child(6) {
  grid-column: 11 / 13;
}
.note-row-naturals .note-btn:nth-child(7) {
  grid-column: 13 / 15;
}
/* Accidentals: piano black-key positioning between naturals */
.note-row-accidentals .note-btn:nth-child(1) {
  grid-column: 2 / 4;
}
.note-row-accidentals .note-btn:nth-child(2) {
  grid-column: 4 / 6;
}
.note-row-accidentals .note-btn:nth-child(3) {
  grid-column: 8 / 10;
}
.note-row-accidentals .note-btn:nth-child(4) {
  grid-column: 10 / 12;
}
.note-row-accidentals .note-btn:nth-child(5) {
  grid-column: 12 / 14;
}
.note-btn {
  min-width: 0;
  height: 48px;
  font-size: var(--text-md);
  font-weight: 500;
  border: 2px solid var(--color-text-muted);
  border-radius: 8px;
  background: var(--color-bg);
  cursor: pointer;
  padding: 0;
  touch-action: manipulation;
  transition:
    background 0.15s ease,
    border-color 0.15s ease,
    transform 0.1s ease;
}
.note-btn:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-text);
}
.note-btn.accidental {
  background: var(--color-surface-accent);
}
.note-btn.accidental:hover {
  background: var(--color-surface-pressed);
}
.note-btn:active {
  background: var(--color-surface-pressed);
  transform: scale(0.97);
}
.note-btn:disabled {
  opacity: 0.5;
  cursor: default;
}
.note-btn:disabled:hover {
  background: var(--color-bg);
  border-color: var(--color-text-muted);
  transform: none;
}
.note-btn.hidden {
  display: none;
}

/* --- Quiz prompt (text modes) --- */
.quiz-prompt-row {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: var(--space-2);
  margin: var(--space-5) 0;
  min-height: 2.5rem;
}
.quiz-prompt {
  font-size: var(--text-2xl);
  font-weight: 600;
}
.quiz-prompt:empty {
  display: none;
}
.quiz-last-question {
  font-size: var(--text-sm);
  color: var(--color-error);
  font-weight: 500;
}
.quiz-last-question:empty {
  display: none;
}

/* --- Answer buttons grid (shared by new modes) --- */
.answer-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 0.4rem;
  max-width: 360px;
  margin: var(--space-3) auto;
}
.answer-btn {
  height: 48px;
  font-size: var(--text-md);
  font-weight: 500;
  border: 2px solid var(--color-text-muted);
  border-radius: 8px;
  background: var(--color-bg);
  cursor: pointer;
  padding: 0 var(--space-2);
  touch-action: manipulation;
  transition:
    background 0.15s ease,
    border-color 0.15s ease,
    transform 0.1s ease;
}
.answer-btn:hover {
  background: var(--color-surface-hover);
  border-color: var(--color-text);
}
.answer-btn:active {
  background: var(--color-surface-pressed);
  transform: scale(0.97);
}
.answer-btn:disabled {
  opacity: 0.5;
  cursor: default;
}
.answer-btn:disabled:hover {
  background: var(--color-bg);
  border-color: var(--color-text-muted);
  transform: none;
}
.answer-buttons-intervals {
  grid-template-columns: repeat(3, 1fr);
}

/* --- Answer group visibility (toggled by mode JS for bidirectional questions) --- */
.answer-group-hidden {
  display: none;
}

/* --- Calibration overlay: inside quiz-area, hide non-calibration content --- */
.phase-calibration .answer-buttons:not(.calibration-active),
.phase-calibration .note-buttons:not(.calibration-active) {
  display: none;
}
.phase-calibration .answer-buttons.calibration-active {
  display: grid;
}
.phase-calibration .note-buttons.calibration-active {
  display: flex;
}
.phase-calibration .speed-tap-status,
.phase-calibration .fretboard-wrapper {
  display: none;
}
.phase-calibration .chord-slots {
  display: none;
}
/* Calibration: hide quiz info (progress bar shows trial count instead) */
.phase-calibration .quiz-session-info {
  display: none;
}
/* Intro + results: hide buttons and progress */
.phase-calibration.calibration-intro .calibration-active,
.phase-calibration.calibration-results .calibration-active {
  display: none;
}
.phase-calibration.calibration-intro .progress-bar,
.phase-calibration.calibration-results .progress-bar {
  display: none;
}

/* --- Calibration highlight --- */
.calibration-target {
  background: var(--color-success) !important;
  border-color: var(--color-success-dark) !important;
  color: white !important;
  box-shadow: 0 0 12px rgba(76, 175, 80, 0.6);
}
.calibration-progress {
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  margin-top: var(--space-3);
}
.calibration-action-btn {
  display: block;
  margin: var(--space-6) auto 0;
  padding: var(--space-4) 2.5rem;
  font-size: var(--text-md);
  font-weight: 600;
  background: var(--color-brand);
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.15s ease;
}
.calibration-action-btn:hover {
  background: var(--color-brand-dark);
}
.calibration-action-btn:active {
  background: var(--color-brand-dark);
}
.calibration-results {
  text-align: center;
  margin: var(--space-5) auto;
  max-width: 420px;
}
.calibration-baseline {
  font-size: var(--text-md);
  font-weight: 600;
  margin: var(--space-3) 0 var(--space-5);
}
.calibration-thresholds {
  border-collapse: collapse;
  margin: 0 auto var(--space-5);
  font-size: var(--text-sm);
  width: 100%;
}
.calibration-thresholds th,
.calibration-thresholds td {
  border: 1px solid var(--color-border-light);
  padding: 0.35rem var(--space-3);
  text-align: left;
}
.calibration-thresholds th {
  background: var(--color-surface);
  font-weight: 600;
}
.calibration-thresholds td:first-child {
  font-weight: 600;
  white-space: nowrap;
}
.calibration-thresholds td:nth-child(2) {
  white-space: nowrap;
  font-variant-numeric: tabular-nums;
}

/* --- Feedback --- */
.feedback {
  font-size: var(--text-xl);
  margin: var(--space-5) 0;
  min-height: 2rem;
}
.correct {
  color: var(--color-success);
}
.incorrect {
  color: var(--color-error);
}
.time-display {
  color: var(--color-text-muted);
  font-size: var(--text-sm);
  margin-top: var(--space-3);
}
.hint {
  color: var(--color-text-muted);
  font-size: var(--text-base);
  margin-top: var(--space-5);
}
.stats {
  margin-top: var(--space-5);
  font-size: var(--text-sm);
  color: var(--color-text-muted);
}

/* --- Heatmap legends --- */
.heatmap-legend {
  display: none;
  justify-content: center;
  gap: var(--space-3);
  flex-wrap: wrap;
  margin: var(--space-4) 0;
}
.heatmap-legend.active {
  display: flex;
}
.legend-item {
  display: flex;
  align-items: center;
  gap: 0.2rem;
  font-size: var(--text-xs);
  color: var(--color-text-muted);
}
.legend-swatch {
  width: 12px;
  height: 12px;
  border-radius: 3px;
  border: 1px solid var(--color-border);
}
.setting-group {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  font-size: var(--text-sm);
  color: var(--color-text-muted);
  cursor: pointer;
}
.toggle-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
}
.toggle-group-label {
  font-size: var(--text-xs);
  color: var(--color-text-muted);
  font-weight: 500;
}

/* --- Stats tables (lookup modes) --- */
.stats-container {
  text-align: center;
  margin: var(--space-3) 0;
}
.stats-table {
  border-collapse: collapse;
  margin: var(--space-3) auto;
  font-size: var(--text-sm);
}
.stats-table th, .stats-table td {
  border: 1px solid var(--color-border-light);
  padding: 0.4rem 0.7rem;
  text-align: center;
}
.stats-table th {
  background: var(--color-surface);
  font-weight: 600;
}
.stats-cell {
  width: 40px;
  height: 28px;
  border-radius: 4px;
  padding: 0;
  box-sizing: border-box;
}

/* --- Stats grids (math modes) --- */
.stats-grid-wrapper {
  overflow-x: auto;
  margin: var(--space-3) 0;
}
.stats-grid {
  border-collapse: collapse;
  margin: 0 auto;
  font-size: var(--text-sm);
}
.stats-grid th, .stats-grid td {
  border: 1px solid var(--color-border-light);
  padding: 0.2rem 0.3rem;
  text-align: center;
}
.stats-grid th {
  background: var(--color-surface);
  font-weight: 600;
  font-size: var(--text-xs);
}
.stats-grid .stats-cell {
  width: 30px;
  height: 24px;
}
.stats-grid-row-label {
  font-weight: 600;
  background: var(--color-surface);
  padding: 0.2rem 0.4rem;
}

/* --- Speed Tap mode --- */
.speed-tap-status {
  display: flex;
  justify-content: center;
  gap: var(--space-6);
  font-size: var(--text-lg);
  margin: var(--space-3) 0;
}
.speed-tap-progress {
  font-weight: 500;
}
.speed-tap-stats {
  font-size: var(--text-xs);
}
.speed-tap-stats th, .speed-tap-stats td {
  padding: 0.2rem 0.3rem;
}
.speed-tap-stats .stats-cell {
  width: 24px;
  height: 20px;
}

/* --- Stats controls (toggle above chart) --- */
.stats-controls {
  text-align: center;
  margin: var(--space-3) 0;
  padding-bottom: var(--space-2);
}

/* --- Stats mode toggle (Recall / Speed) --- */
.stats-toggle {
  display: inline-flex;
  border: 2px solid var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}
.stats-toggle-btn {
  padding: 0.35rem var(--space-5);
  font-size: var(--text-sm);
  font-weight: 500;
  border: none;
  border-radius: 0;
  background: var(--color-bg);
  color: var(--color-text-muted);
  cursor: pointer;
  margin: 0;
  transition: background 0.15s ease, color 0.15s ease;
}
.stats-toggle-btn + .stats-toggle-btn {
  border-left: 1px solid var(--color-border-light);
}
.stats-toggle-btn.active {
  background: var(--color-brand);
  color: white;
}
.stats-toggle-btn:not(.active):hover {
  background: var(--color-surface-hover);
}

/* --- Key signature answer buttons --- */
.answer-buttons-keysig {
  grid-template-columns: repeat(4, 1fr);
}

/* --- Degree answer buttons --- */
.answer-buttons-degrees {
  grid-template-columns: repeat(4, 1fr);
}

/* --- Roman numeral answer buttons --- */
.answer-buttons-numerals {
  grid-template-columns: repeat(4, 1fr);
}

/* --- Chord spelling slots --- */
.chord-slots {
  display: flex;
  justify-content: center;
  gap: var(--space-3);
  margin: var(--space-4) 0;
  min-height: 2.5rem;
}
.chord-slot {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 3rem;
  height: 2.5rem;
  border: 2px solid var(--color-border);
  border-radius: 6px;
  font-size: var(--text-md);
  font-weight: 600;
  background: var(--color-surface);
  transition: border-color 0.15s ease, background 0.15s ease;
}
.chord-slot.active {
  border-color: var(--color-focus);
  background: var(--color-focus-bg);
}
.chord-slot.correct {
  border-color: var(--color-success);
  background: var(--color-success-bg);
  color: var(--color-success-text);
}
.chord-slot.wrong {
  border-color: var(--color-error);
  background: var(--color-error-bg);
  color: var(--color-error-text);
}

/* --- Focus-visible (keyboard navigation) --- */
:focus-visible {
  outline: 2px solid var(--color-brand);
  outline-offset: 2px;
}
/* Remove default outline for mouse/touch users */
:focus:not(:focus-visible) {
  outline: none;
}
/* Specific overrides for elements that need different focus styling */
.start-btn:focus-visible {
  outline-color: var(--color-brand-dark);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12), 0 0 0 4px rgba(209, 147, 27, 0.3);
}
.home-mode-btn:focus-visible {
  outline-offset: -2px;
}

/* --- Reduced motion --- */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Mobile layout */
@media (max-width: 599px) {
  body {
    margin: 0;
    padding: 0 var(--space-1);
    padding-top: env(safe-area-inset-top, 0);
    padding-bottom: env(safe-area-inset-bottom, 0);
    padding-left: max(var(--space-1), env(safe-area-inset-left, 0));
    padding-right: max(var(--space-1), env(safe-area-inset-right, 0));
    border-left: none;
    border-right: none;
  }

  .quiz-countdown-bar {
    margin-left: calc(-1 * var(--space-1));
  }

  .phase-active,
  .phase-round-complete,
  .phase-calibration {
    margin: 0 calc(-1 * var(--space-1));
    padding: 0 var(--space-1);
  }

  .fretboard-container {
    width: 100%;
    max-width: none;
  }

  .answer-buttons {
    grid-template-columns: repeat(3, 1fr);
    max-width: 280px;
  }

  .quiz-prompt {
    font-size: 1.6rem;
  }

  /* Prevent iOS zoom on input focus */
  input, button {
    font-size: 16px;
  }
}

  </style>
</head>
<body>
  <div id="app">
  <div class="home-screen" id="home-screen">
    <div class="home-header">
      <h1 class="home-title">Music Reps</h1>
    </div>
    <div class="home-modes">
      <div class="home-group-label">Fretboard</div>
      <button data-mode="fretboard" class="home-mode-btn">
        <span class="home-mode-name">Guitar Fretboard</span>
        <span class="home-mode-desc">Name notes on the guitar neck</span>
      </button>
      <button data-mode="ukulele" class="home-mode-btn">
        <span class="home-mode-name">Ukulele Fretboard</span>
        <span class="home-mode-desc">Name notes on the ukulele</span>
      </button>
      <button data-mode="speedTap" class="home-mode-btn">
        <span class="home-mode-name">Speed Tap</span>
        <span class="home-mode-desc">Find all positions of a note</span>
      </button>
      <div class="home-group-label">Theory Lookup</div>
      <button data-mode="noteSemitones" class="home-mode-btn">
        <span class="home-mode-name">Note ↔ Semitones</span>
        <span class="home-mode-desc">Convert between notes and semitone numbers</span>
      </button>
      <button data-mode="intervalSemitones" class="home-mode-btn">
        <span class="home-mode-name">Interval ↔ Semitones</span>
        <span class="home-mode-desc">Convert between intervals and semitone counts</span>
      </button>
      <div class="home-group-label">Calculation</div>
      <button data-mode="semitoneMath" class="home-mode-btn">
        <span class="home-mode-name">Semitone Math</span>
        <span class="home-mode-desc">Add or subtract semitones from a note</span>
      </button>
      <button data-mode="intervalMath" class="home-mode-btn">
        <span class="home-mode-name">Interval Math</span>
        <span class="home-mode-desc">Apply intervals up or down from a note</span>
      </button>
      <div class="home-group-label">Keys &amp; Chords</div>
      <button data-mode="keySignatures" class="home-mode-btn">
        <span class="home-mode-name">Key Signatures</span>
        <span class="home-mode-desc">Match keys to their sharps and flats</span>
      </button>
      <button data-mode="scaleDegrees" class="home-mode-btn">
        <span class="home-mode-name">Scale Degrees</span>
        <span class="home-mode-desc">Name notes by scale degree in any key</span>
      </button>
      <button data-mode="diatonicChords" class="home-mode-btn">
        <span class="home-mode-name">Diatonic Chords</span>
        <span class="home-mode-desc">Identify chords built on each scale degree</span>
      </button>
      <button data-mode="chordSpelling" class="home-mode-btn">
        <span class="home-mode-name">Chord Spelling</span>
        <span class="home-mode-desc">Spell out the notes in any chord</span>
      </button>
    </div>
    <div class="home-footer">
      <button class="home-settings-btn" type="button">Settings</button>
      <span class="version">v8.5</span>
    </div>
  </div>

  <!-- Guitar Fretboard mode -->
  <div class="mode-screen phase-idle" id="mode-fretboard">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Guitar Fretboard</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group">
          <span class="toggle-group-label">Strings</span>
          <div class="string-toggles">
            <button class="string-toggle" data-string="0" data-string-note="e">e</button>
            <button class="string-toggle" data-string="1" data-string-note="B">B</button>
            <button class="string-toggle" data-string="2" data-string-note="G">G</button>
            <button class="string-toggle" data-string="3" data-string-note="D">D</button>
            <button class="string-toggle" data-string="4" data-string-note="A">A</button>
            <button class="string-toggle active" data-string="5" data-string-note="E">E</button>
          </div>
        </div>
          <div class="toggle-group">
            <span class="toggle-group-label">Notes</span>
            <div class="notes-toggles">
              <button class="notes-toggle active" data-notes="natural">natural</button>
              <button class="notes-toggle" data-notes="sharps-flats">sharps &amp; flats</button>
            </div>
          </div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      <div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard" viewBox="0 0 600 226">
          <!-- Fret marker dots (inlays) -->
          <circle class="fb-marker" cx="210" cy="113" r="4"/>
      <circle class="fb-marker" cx="312" cy="113" r="4"/>
      <circle class="fb-marker" cx="402" cy="113" r="4"/>
      <circle class="fb-marker" cx="481.5" cy="113" r="4"/>
      <circle class="fb-marker" cx="584" cy="75" r="4"/><circle class="fb-marker" cx="584" cy="151" r="4"/>
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="63" y="0" width="4" height="226" rx="1"/>
          <!-- Frets (vertical lines) -->
          <line class="fb-fret" x1="126" y1="0" x2="126" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="183" y1="0" x2="183" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="237" y1="0" x2="237" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="288" y1="0" x2="288" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="336" y1="0" x2="336" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="381" y1="0" x2="381" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="423" y1="0" x2="423" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="463" y1="0" x2="463" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="500" y1="0" x2="500" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="535" y1="0" x2="535" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="568" y1="0" x2="568" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="600" y1="0" x2="600" y2="226" stroke-width="1"/>
          <!-- Strings (horizontal lines) -->
          <line class="fb-string" x1="0" y1="18" x2="600" y2="18" stroke-width="1"/>
      <line class="fb-string" x1="0" y1="56" x2="600" y2="56" stroke-width="1.4"/>
      <line class="fb-string" x1="0" y1="94" x2="600" y2="94" stroke-width="1.8"/>
      <line class="fb-string" x1="0" y1="132" x2="600" y2="132" stroke-width="2.2"/>
      <line class="fb-string" x1="0" y1="170" x2="600" y2="170" stroke-width="2.6"/>
      <line class="fb-string" x1="0" y1="208" x2="600" y2="208" stroke-width="3"/>
          <!-- Position circles -->
          <circle class="fb-pos" data-string="0" data-fret="0" cx="32.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="1" cx="95.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="2" cx="154.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="3" cx="210" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="4" cx="262.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="5" cx="312" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="6" cx="358.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="7" cx="402" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="8" cx="443" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="9" cx="481.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="10" cx="517.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="11" cx="551.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="12" cx="584" cy="18" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="0" cx="32.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="1" cx="95.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="2" cx="154.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="3" cx="210" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="4" cx="262.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="5" cx="312" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="6" cx="358.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="7" cx="402" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="8" cx="443" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="9" cx="481.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="10" cx="517.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="11" cx="551.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="12" cx="584" cy="56" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="0" cx="32.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="1" cx="95.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="2" cx="154.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="3" cx="210" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="4" cx="262.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="5" cx="312" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="6" cx="358.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="7" cx="402" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="8" cx="443" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="9" cx="481.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="10" cx="517.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="11" cx="551.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="12" cx="584" cy="94" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="0" cx="32.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="1" cx="95.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="2" cx="154.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="3" cx="210" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="4" cx="262.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="5" cx="312" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="6" cx="358.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="7" cx="402" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="8" cx="443" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="9" cx="481.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="10" cx="517.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="11" cx="551.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="12" cx="584" cy="132" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="0" cx="32.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="1" cx="95.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="2" cx="154.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="3" cx="210" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="4" cx="262.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="5" cx="312" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="6" cx="358.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="7" cx="402" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="8" cx="443" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="9" cx="481.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="10" cx="517.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="11" cx="551.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="12" cx="584" cy="170" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="0" cx="32.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="1" cx="95.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="2" cx="154.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="3" cx="210" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="4" cx="262.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="5" cx="312" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="6" cx="358.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="7" cx="402" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="8" cx="443" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="9" cx="481.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="10" cx="517.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="11" cx="551.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="12" cx="584" cy="208" r="10"/>
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard" viewBox="0 0 600 226">
          <!-- Fret marker dots (inlays) -->
          <circle class="fb-marker" cx="210" cy="113" r="4"/>
      <circle class="fb-marker" cx="312" cy="113" r="4"/>
      <circle class="fb-marker" cx="402" cy="113" r="4"/>
      <circle class="fb-marker" cx="481.5" cy="113" r="4"/>
      <circle class="fb-marker" cx="584" cy="75" r="4"/><circle class="fb-marker" cx="584" cy="151" r="4"/>
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="63" y="0" width="4" height="226" rx="1"/>
          <!-- Frets (vertical lines) -->
          <line class="fb-fret" x1="126" y1="0" x2="126" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="183" y1="0" x2="183" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="237" y1="0" x2="237" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="288" y1="0" x2="288" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="336" y1="0" x2="336" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="381" y1="0" x2="381" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="423" y1="0" x2="423" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="463" y1="0" x2="463" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="500" y1="0" x2="500" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="535" y1="0" x2="535" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="568" y1="0" x2="568" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="600" y1="0" x2="600" y2="226" stroke-width="1"/>
          <!-- Strings (horizontal lines) -->
          <line class="fb-string" x1="0" y1="18" x2="600" y2="18" stroke-width="1"/>
      <line class="fb-string" x1="0" y1="56" x2="600" y2="56" stroke-width="1.4"/>
      <line class="fb-string" x1="0" y1="94" x2="600" y2="94" stroke-width="1.8"/>
      <line class="fb-string" x1="0" y1="132" x2="600" y2="132" stroke-width="2.2"/>
      <line class="fb-string" x1="0" y1="170" x2="600" y2="170" stroke-width="2.6"/>
      <line class="fb-string" x1="0" y1="208" x2="600" y2="208" stroke-width="3"/>
          <!-- Position circles -->
          <circle class="fb-pos" data-string="0" data-fret="0" cx="32.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="1" cx="95.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="2" cx="154.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="3" cx="210" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="4" cx="262.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="5" cx="312" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="6" cx="358.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="7" cx="402" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="8" cx="443" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="9" cx="481.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="10" cx="517.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="11" cx="551.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="12" cx="584" cy="18" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="0" cx="32.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="1" cx="95.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="2" cx="154.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="3" cx="210" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="4" cx="262.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="5" cx="312" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="6" cx="358.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="7" cx="402" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="8" cx="443" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="9" cx="481.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="10" cx="517.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="11" cx="551.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="12" cx="584" cy="56" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="0" cx="32.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="1" cx="95.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="2" cx="154.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="3" cx="210" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="4" cx="262.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="5" cx="312" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="6" cx="358.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="7" cx="402" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="8" cx="443" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="9" cx="481.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="10" cx="517.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="11" cx="551.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="12" cx="584" cy="94" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="0" cx="32.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="1" cx="95.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="2" cx="154.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="3" cx="210" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="4" cx="262.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="5" cx="312" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="6" cx="358.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="7" cx="402" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="8" cx="443" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="9" cx="481.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="10" cx="517.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="11" cx="551.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="12" cx="584" cy="132" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="0" cx="32.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="1" cx="95.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="2" cx="154.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="3" cx="210" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="4" cx="262.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="5" cx="312" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="6" cx="358.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="7" cx="402" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="8" cx="443" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="9" cx="481.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="10" cx="517.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="11" cx="551.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="12" cx="584" cy="170" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="0" cx="32.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="1" cx="95.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="2" cx="154.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="3" cx="210" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="4" cx="262.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="5" cx="312" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="6" cx="358.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="7" cx="402" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="8" cx="443" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="9" cx="481.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="10" cx="517.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="11" cx="551.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="12" cx="584" cy="208" r="10"/>
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>
      <div class="note-buttons">
        <div class="note-row-accidentals">
          <button class="note-btn accidental" data-note="C#">C#</button>
          <button class="note-btn accidental" data-note="D#">D#</button>
          <button class="note-btn accidental" data-note="F#">F#</button>
          <button class="note-btn accidental" data-note="G#">G#</button>
          <button class="note-btn accidental" data-note="A#">A#</button>
        </div>
        <div class="note-row-naturals">
          <button class="note-btn" data-note="C">C</button>
          <button class="note-btn" data-note="D">D</button>
          <button class="note-btn" data-note="E">E</button>
          <button class="note-btn" data-note="F">F</button>
          <button class="note-btn" data-note="G">G</button>
          <button class="note-btn" data-note="A">A</button>
          <button class="note-btn" data-note="B">B</button>
        </div>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ukulele Fretboard mode -->
  <div class="mode-screen phase-idle" id="mode-ukulele">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Ukulele Fretboard</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group">
          <span class="toggle-group-label">Strings</span>
          <div class="string-toggles">
            <button class="string-toggle" data-string="0" data-string-note="A">A</button>
            <button class="string-toggle" data-string="1" data-string-note="E">E</button>
            <button class="string-toggle active" data-string="2" data-string-note="C">C</button>
            <button class="string-toggle" data-string="3" data-string-note="G">G</button>
          </div>
        </div>
          <div class="toggle-group">
            <span class="toggle-group-label">Notes</span>
            <div class="notes-toggles">
              <button class="notes-toggle active" data-notes="natural">natural</button>
              <button class="notes-toggle" data-notes="sharps-flats">sharps &amp; flats</button>
            </div>
          </div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      <div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard" viewBox="0 0 600 150">
          <!-- Fret marker dots (inlays) -->
          <circle class="fb-marker" cx="210" cy="75" r="4"/>
      <circle class="fb-marker" cx="312" cy="75" r="4"/>
      <circle class="fb-marker" cx="402" cy="75" r="4"/>
      <circle class="fb-marker" cx="517.5" cy="75" r="4"/>
      <circle class="fb-marker" cx="584" cy="56" r="4"/><circle class="fb-marker" cx="584" cy="94" r="4"/>
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="63" y="0" width="4" height="150" rx="1"/>
          <!-- Frets (vertical lines) -->
          <line class="fb-fret" x1="126" y1="0" x2="126" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="183" y1="0" x2="183" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="237" y1="0" x2="237" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="288" y1="0" x2="288" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="336" y1="0" x2="336" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="381" y1="0" x2="381" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="423" y1="0" x2="423" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="463" y1="0" x2="463" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="500" y1="0" x2="500" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="535" y1="0" x2="535" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="568" y1="0" x2="568" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="600" y1="0" x2="600" y2="150" stroke-width="1"/>
          <!-- Strings (horizontal lines) -->
          <line class="fb-string" x1="0" y1="18" x2="600" y2="18" stroke-width="1"/>
      <line class="fb-string" x1="0" y1="56" x2="600" y2="56" stroke-width="1.4"/>
      <line class="fb-string" x1="0" y1="94" x2="600" y2="94" stroke-width="1.8"/>
      <line class="fb-string" x1="0" y1="132" x2="600" y2="132" stroke-width="2.2"/>
          <!-- Position circles -->
          <circle class="fb-pos" data-string="0" data-fret="0" cx="32.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="1" cx="95.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="2" cx="154.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="3" cx="210" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="4" cx="262.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="5" cx="312" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="6" cx="358.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="7" cx="402" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="8" cx="443" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="9" cx="481.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="10" cx="517.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="11" cx="551.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="12" cx="584" cy="18" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="0" cx="32.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="1" cx="95.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="2" cx="154.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="3" cx="210" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="4" cx="262.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="5" cx="312" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="6" cx="358.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="7" cx="402" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="8" cx="443" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="9" cx="481.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="10" cx="517.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="11" cx="551.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="12" cx="584" cy="56" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="0" cx="32.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="1" cx="95.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="2" cx="154.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="3" cx="210" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="4" cx="262.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="5" cx="312" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="6" cx="358.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="7" cx="402" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="8" cx="443" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="9" cx="481.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="10" cx="517.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="11" cx="551.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="12" cx="584" cy="94" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="0" cx="32.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="1" cx="95.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="2" cx="154.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="3" cx="210" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="4" cx="262.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="5" cx="312" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="6" cx="358.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="7" cx="402" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="8" cx="443" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="9" cx="481.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="10" cx="517.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="11" cx="551.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="12" cx="584" cy="132" r="10"/>
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard" viewBox="0 0 600 150">
          <!-- Fret marker dots (inlays) -->
          <circle class="fb-marker" cx="210" cy="75" r="4"/>
      <circle class="fb-marker" cx="312" cy="75" r="4"/>
      <circle class="fb-marker" cx="402" cy="75" r="4"/>
      <circle class="fb-marker" cx="517.5" cy="75" r="4"/>
      <circle class="fb-marker" cx="584" cy="56" r="4"/><circle class="fb-marker" cx="584" cy="94" r="4"/>
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="63" y="0" width="4" height="150" rx="1"/>
          <!-- Frets (vertical lines) -->
          <line class="fb-fret" x1="126" y1="0" x2="126" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="183" y1="0" x2="183" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="237" y1="0" x2="237" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="288" y1="0" x2="288" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="336" y1="0" x2="336" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="381" y1="0" x2="381" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="423" y1="0" x2="423" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="463" y1="0" x2="463" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="500" y1="0" x2="500" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="535" y1="0" x2="535" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="568" y1="0" x2="568" y2="150" stroke-width="1"/>
      <line class="fb-fret" x1="600" y1="0" x2="600" y2="150" stroke-width="1"/>
          <!-- Strings (horizontal lines) -->
          <line class="fb-string" x1="0" y1="18" x2="600" y2="18" stroke-width="1"/>
      <line class="fb-string" x1="0" y1="56" x2="600" y2="56" stroke-width="1.4"/>
      <line class="fb-string" x1="0" y1="94" x2="600" y2="94" stroke-width="1.8"/>
      <line class="fb-string" x1="0" y1="132" x2="600" y2="132" stroke-width="2.2"/>
          <!-- Position circles -->
          <circle class="fb-pos" data-string="0" data-fret="0" cx="32.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="1" cx="95.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="2" cx="154.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="3" cx="210" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="4" cx="262.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="5" cx="312" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="6" cx="358.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="7" cx="402" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="8" cx="443" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="9" cx="481.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="10" cx="517.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="11" cx="551.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="12" cx="584" cy="18" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="0" cx="32.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="1" cx="95.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="2" cx="154.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="3" cx="210" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="4" cx="262.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="5" cx="312" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="6" cx="358.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="7" cx="402" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="8" cx="443" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="9" cx="481.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="10" cx="517.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="11" cx="551.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="12" cx="584" cy="56" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="0" cx="32.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="1" cx="95.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="2" cx="154.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="3" cx="210" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="4" cx="262.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="5" cx="312" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="6" cx="358.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="7" cx="402" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="8" cx="443" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="9" cx="481.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="10" cx="517.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="11" cx="551.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="12" cx="584" cy="94" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="0" cx="32.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="1" cx="95.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="2" cx="154.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="3" cx="210" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="4" cx="262.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="5" cx="312" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="6" cx="358.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="7" cx="402" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="8" cx="443" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="9" cx="481.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="10" cx="517.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="11" cx="551.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="12" cx="584" cy="132" r="10"/>
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>
      <div class="note-buttons">
        <div class="note-row-accidentals">
          <button class="note-btn accidental" data-note="C#">C#</button>
          <button class="note-btn accidental" data-note="D#">D#</button>
          <button class="note-btn accidental" data-note="F#">F#</button>
          <button class="note-btn accidental" data-note="G#">G#</button>
          <button class="note-btn accidental" data-note="A#">A#</button>
        </div>
        <div class="note-row-naturals">
          <button class="note-btn" data-note="C">C</button>
          <button class="note-btn" data-note="D">D</button>
          <button class="note-btn" data-note="E">E</button>
          <button class="note-btn" data-note="F">F</button>
          <button class="note-btn" data-note="G">G</button>
          <button class="note-btn" data-note="A">A</button>
          <button class="note-btn" data-note="B">B</button>
        </div>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Speed Tap mode -->
  <div class="mode-screen phase-idle" id="mode-speedTap">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Speed Tap</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group">
            <span class="toggle-group-label">Notes</span>
            <div class="notes-toggles">
              <button class="notes-toggle active" data-notes="natural">natural</button>
              <button class="notes-toggle" data-notes="sharps-flats">sharps &amp; flats</button>
            </div>
          </div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="speed-tap-status">
        <span class="speed-tap-progress"></span>
      </div>
      <div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard" viewBox="0 0 600 226">
          <!-- Fret marker dots (inlays) -->
          <circle class="fb-marker" cx="210" cy="113" r="4"/>
      <circle class="fb-marker" cx="312" cy="113" r="4"/>
      <circle class="fb-marker" cx="402" cy="113" r="4"/>
      <circle class="fb-marker" cx="481.5" cy="113" r="4"/>
      <circle class="fb-marker" cx="584" cy="75" r="4"/><circle class="fb-marker" cx="584" cy="151" r="4"/>
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="63" y="0" width="4" height="226" rx="1"/>
          <!-- Frets (vertical lines) -->
          <line class="fb-fret" x1="126" y1="0" x2="126" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="183" y1="0" x2="183" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="237" y1="0" x2="237" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="288" y1="0" x2="288" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="336" y1="0" x2="336" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="381" y1="0" x2="381" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="423" y1="0" x2="423" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="463" y1="0" x2="463" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="500" y1="0" x2="500" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="535" y1="0" x2="535" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="568" y1="0" x2="568" y2="226" stroke-width="1"/>
      <line class="fb-fret" x1="600" y1="0" x2="600" y2="226" stroke-width="1"/>
          <!-- Strings (horizontal lines) -->
          <line class="fb-string" x1="0" y1="18" x2="600" y2="18" stroke-width="1"/>
      <line class="fb-string" x1="0" y1="56" x2="600" y2="56" stroke-width="1.4"/>
      <line class="fb-string" x1="0" y1="94" x2="600" y2="94" stroke-width="1.8"/>
      <line class="fb-string" x1="0" y1="132" x2="600" y2="132" stroke-width="2.2"/>
      <line class="fb-string" x1="0" y1="170" x2="600" y2="170" stroke-width="2.6"/>
      <line class="fb-string" x1="0" y1="208" x2="600" y2="208" stroke-width="3"/>
          <!-- Position circles -->
          <circle class="fb-pos" data-string="0" data-fret="0" cx="32.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="1" cx="95.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="2" cx="154.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="3" cx="210" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="4" cx="262.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="5" cx="312" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="6" cx="358.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="7" cx="402" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="8" cx="443" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="9" cx="481.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="10" cx="517.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="11" cx="551.5" cy="18" r="10"/>
      <circle class="fb-pos" data-string="0" data-fret="12" cx="584" cy="18" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="0" cx="32.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="1" cx="95.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="2" cx="154.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="3" cx="210" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="4" cx="262.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="5" cx="312" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="6" cx="358.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="7" cx="402" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="8" cx="443" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="9" cx="481.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="10" cx="517.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="11" cx="551.5" cy="56" r="10"/>
      <circle class="fb-pos" data-string="1" data-fret="12" cx="584" cy="56" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="0" cx="32.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="1" cx="95.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="2" cx="154.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="3" cx="210" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="4" cx="262.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="5" cx="312" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="6" cx="358.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="7" cx="402" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="8" cx="443" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="9" cx="481.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="10" cx="517.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="11" cx="551.5" cy="94" r="10"/>
      <circle class="fb-pos" data-string="2" data-fret="12" cx="584" cy="94" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="0" cx="32.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="1" cx="95.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="2" cx="154.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="3" cx="210" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="4" cx="262.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="5" cx="312" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="6" cx="358.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="7" cx="402" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="8" cx="443" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="9" cx="481.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="10" cx="517.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="11" cx="551.5" cy="132" r="10"/>
      <circle class="fb-pos" data-string="3" data-fret="12" cx="584" cy="132" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="0" cx="32.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="1" cx="95.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="2" cx="154.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="3" cx="210" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="4" cx="262.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="5" cx="312" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="6" cx="358.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="7" cx="402" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="8" cx="443" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="9" cx="481.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="10" cx="517.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="11" cx="551.5" cy="170" r="10"/>
      <circle class="fb-pos" data-string="4" data-fret="12" cx="584" cy="170" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="0" cx="32.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="1" cx="95.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="2" cx="154.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="3" cx="210" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="4" cx="262.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="5" cx="312" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="6" cx="358.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="7" cx="402" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="8" cx="443" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="9" cx="481.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="10" cx="517.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="11" cx="551.5" cy="208" r="10"/>
      <circle class="fb-pos" data-string="5" data-fret="12" cx="584" cy="208" r="10"/>
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>
      <div class="answer-buttons answer-buttons-notes answer-group-hidden">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Note Semitones mode -->
  <div class="mode-screen phase-idle" id="mode-noteSemitones">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Note ↔ Semitones</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="answer-buttons answer-buttons-numbers">
        <button class="answer-btn answer-btn-num" data-num="0">0</button>
        <button class="answer-btn answer-btn-num" data-num="1">1</button>
        <button class="answer-btn answer-btn-num" data-num="2">2</button>
        <button class="answer-btn answer-btn-num" data-num="3">3</button>
        <button class="answer-btn answer-btn-num" data-num="4">4</button>
        <button class="answer-btn answer-btn-num" data-num="5">5</button>
        <button class="answer-btn answer-btn-num" data-num="6">6</button>
        <button class="answer-btn answer-btn-num" data-num="7">7</button>
        <button class="answer-btn answer-btn-num" data-num="8">8</button>
        <button class="answer-btn answer-btn-num" data-num="9">9</button>
        <button class="answer-btn answer-btn-num" data-num="10">10</button>
        <button class="answer-btn answer-btn-num" data-num="11">11</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Interval Semitones mode -->
  <div class="mode-screen phase-idle" id="mode-intervalSemitones">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Interval ↔ Semitones</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-intervals">
        <button class="answer-btn answer-btn-interval" data-interval="m2">m2</button>
        <button class="answer-btn answer-btn-interval" data-interval="M2">M2</button>
        <button class="answer-btn answer-btn-interval" data-interval="m3">m3</button>
        <button class="answer-btn answer-btn-interval" data-interval="M3">M3</button>
        <button class="answer-btn answer-btn-interval" data-interval="P4">P4</button>
        <button class="answer-btn answer-btn-interval" data-interval="TT">TT</button>
        <button class="answer-btn answer-btn-interval" data-interval="P5">P5</button>
        <button class="answer-btn answer-btn-interval" data-interval="m6">m6</button>
        <button class="answer-btn answer-btn-interval" data-interval="M6">M6</button>
        <button class="answer-btn answer-btn-interval" data-interval="m7">m7</button>
        <button class="answer-btn answer-btn-interval" data-interval="M7">M7</button>
        <button class="answer-btn answer-btn-interval" data-interval="P8">P8</button>
      </div>
      <div class="answer-buttons answer-buttons-numbers">
        <button class="answer-btn answer-btn-num" data-num="1">1</button>
        <button class="answer-btn answer-btn-num" data-num="2">2</button>
        <button class="answer-btn answer-btn-num" data-num="3">3</button>
        <button class="answer-btn answer-btn-num" data-num="4">4</button>
        <button class="answer-btn answer-btn-num" data-num="5">5</button>
        <button class="answer-btn answer-btn-num" data-num="6">6</button>
        <button class="answer-btn answer-btn-num" data-num="7">7</button>
        <button class="answer-btn answer-btn-num" data-num="8">8</button>
        <button class="answer-btn answer-btn-num" data-num="9">9</button>
        <button class="answer-btn answer-btn-num" data-num="10">10</button>
        <button class="answer-btn answer-btn-num" data-num="11">11</button>
        <button class="answer-btn answer-btn-num" data-num="12">12</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Semitone Math mode -->
  <div class="mode-screen phase-idle" id="mode-semitoneMath">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Semitone Math</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Interval Math mode -->
  <div class="mode-screen phase-idle" id="mode-intervalMath">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Interval Math</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Key Signatures mode -->
  <div class="mode-screen phase-idle" id="mode-keySignatures">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Key Signatures</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-keysig">
        <button class="answer-btn answer-btn-keysig" data-sig="0">0</button>
        <button class="answer-btn answer-btn-keysig" data-sig="1#">1#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="2#">2#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="3#">3#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="4#">4#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="5#">5#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="6#">6#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="7#">7#</button>
        <button class="answer-btn answer-btn-keysig" data-sig="1b">1b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="2b">2b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="3b">3b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="4b">4b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="5b">5b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="6b">6b</button>
        <button class="answer-btn answer-btn-keysig" data-sig="7b">7b</button>
      </div>
      <div class="answer-buttons answer-buttons-notes answer-group-hidden">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scale Degrees mode -->
  <div class="mode-screen phase-idle" id="mode-scaleDegrees">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Scale Degrees</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="answer-buttons answer-buttons-degrees answer-group-hidden">
        <button class="answer-btn answer-btn-degree" data-degree="1">1st</button>
        <button class="answer-btn answer-btn-degree" data-degree="2">2nd</button>
        <button class="answer-btn answer-btn-degree" data-degree="3">3rd</button>
        <button class="answer-btn answer-btn-degree" data-degree="4">4th</button>
        <button class="answer-btn answer-btn-degree" data-degree="5">5th</button>
        <button class="answer-btn answer-btn-degree" data-degree="6">6th</button>
        <button class="answer-btn answer-btn-degree" data-degree="7">7th</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Diatonic Chords mode -->
  <div class="mode-screen phase-idle" id="mode-diatonicChords">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Diatonic Chords</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="answer-buttons answer-buttons-numerals answer-group-hidden">
        <button class="answer-btn answer-btn-numeral" data-numeral="I">I</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="ii">ii</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="iii">iii</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="IV">IV</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="V">V</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="vi">vi</button>
        <button class="answer-btn answer-btn-numeral" data-numeral="vii°">vii°</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chord Spelling mode -->
  <div class="mode-screen phase-idle" id="mode-chordSpelling">
    <div class="mode-top-bar">
      <button class="mode-back-btn" aria-label="Back to home">←</button>
      <h1 class="mode-title">Chord Spelling</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" data-tab="practice">Practice</button>
      <button class="mode-tab" data-tab="progress">Progress</button>
    </div>
    <div class="tab-content tab-practice active">
      <div class="practice-card">
        <div class="practice-zone practice-zone-status">
          <div class="practice-status">
            <span class="practice-status-label"></span>
            <span class="practice-status-detail"></span>
          </div>
        </div>
        <div class="practice-zone practice-zone-scope">
          <div class="practice-recommendation">
            <span class="practice-rec-text"></span>
            <button class="practice-rec-btn">Use suggestion</button>
          </div>
      <div class="practice-scope">
        <div class="settings-row">
          <div class="toggle-group"><span class="toggle-group-label">Groups</span><div class="distance-toggles"></div></div>
        </div>
      </div>
          <div class="mastery-message">Looks like you've got this!</div>
        </div>
        <div class="practice-zone practice-zone-action">
          <div class="session-summary-text"></div>
          <button class="start-btn">Start Quiz</button>
        </div>
      </div>
    </div>
    <div class="tab-content tab-progress">
      
      <div class="baseline-info"></div>
      <div class="stats-controls">
        <div class="stats-toggle"><button class="stats-toggle-btn active" data-mode="retention">Recall</button><button class="stats-toggle-btn" data-mode="speed">Speed</button></div>
        <span class="stats"></span>
      </div>
      <div class="stats-container"></div>
    </div>
    <div class="quiz-session">
      <div class="quiz-countdown-row">
        <div class="quiz-countdown-bar">
          <div class="quiz-countdown-fill"></div>
        </div>
        <span class="quiz-info-time"></span>
      </div>
      <div class="quiz-session-info">
        <span class="quiz-info-context"></span>
        <span class="quiz-info-count"></span>
      </div>
      <button class="quiz-header-close" aria-label="Stop quiz">×</button>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
        <div class="progress-text">0 / 0 fluent</div>
      </div>
    </div>
    <div class="quiz-area">
      <div class="quiz-prompt-row">
        <div class="quiz-prompt"></div>
        <div class="quiz-last-question"></div>
      </div>
      <div class="chord-slots"></div>
      <div class="answer-buttons answer-buttons-notes">
        <button class="answer-btn answer-btn-note" data-note="C">C</button>
        <button class="answer-btn answer-btn-note" data-note="C#">C#</button>
        <button class="answer-btn answer-btn-note" data-note="D">D</button>
        <button class="answer-btn answer-btn-note" data-note="D#">D#</button>
        <button class="answer-btn answer-btn-note" data-note="E">E</button>
        <button class="answer-btn answer-btn-note" data-note="F">F</button>
        <button class="answer-btn answer-btn-note" data-note="F#">F#</button>
        <button class="answer-btn answer-btn-note" data-note="G">G</button>
        <button class="answer-btn answer-btn-note" data-note="G#">G#</button>
        <button class="answer-btn answer-btn-note" data-note="A">A</button>
        <button class="answer-btn answer-btn-note" data-note="A#">A#</button>
        <button class="answer-btn answer-btn-note" data-note="B">B</button>
      </div>
      <div class="feedback"></div>
      <div class="time-display"></div>
      <div class="hint"></div>
      <div class="round-complete">
        <div class="round-complete-context"></div>
        <div class="round-complete-heading"></div>
        <div class="round-complete-stats">
          <div class="round-stat-line round-stat-correct"></div>
          <div class="round-stat-line round-stat-median"></div>
        </div>
        <div class="round-complete-actions">
          <button class="round-complete-continue">Keep Going</button>
          <button class="round-complete-stop">Stop</button>
        </div>
      </div>
    </div>
  </div>
  </div>

  <script>
(() => {
  // node_modules/preact/dist/preact.module.js
  var n;
  var l;
  var u;
  var t;
  var i;
  var r;
  var o;
  var e;
  var f;
  var c;
  var s;
  var a;
  var h;
  var p = {};
  var v = [];
  var y = /acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;
  var d = Array.isArray;
  function w(n2, l3) {
    for (var u4 in l3) n2[u4] = l3[u4];
    return n2;
  }
  function g(n2) {
    n2 && n2.parentNode && n2.parentNode.removeChild(n2);
  }
  function _(l3, u4, t3) {
    var i3, r3, o3, e3 = {};
    for (o3 in u4) "key" == o3 ? i3 = u4[o3] : "ref" == o3 ? r3 = u4[o3] : e3[o3] = u4[o3];
    if (arguments.length > 2 && (e3.children = arguments.length > 3 ? n.call(arguments, 2) : t3), "function" == typeof l3 && null != l3.defaultProps) for (o3 in l3.defaultProps) void 0 === e3[o3] && (e3[o3] = l3.defaultProps[o3]);
    return m(l3, e3, i3, r3, null);
  }
  function m(n2, t3, i3, r3, o3) {
    var e3 = { type: n2, props: t3, key: i3, ref: r3, __k: null, __: null, __b: 0, __e: null, __c: null, constructor: void 0, __v: null == o3 ? ++u : o3, __i: -1, __u: 0 };
    return null == o3 && null != l.vnode && l.vnode(e3), e3;
  }
  function k(n2) {
    return n2.children;
  }
  function x(n2, l3) {
    this.props = n2, this.context = l3;
  }
  function S(n2, l3) {
    if (null == l3) return n2.__ ? S(n2.__, n2.__i + 1) : null;
    for (var u4; l3 < n2.__k.length; l3++) if (null != (u4 = n2.__k[l3]) && null != u4.__e) return u4.__e;
    return "function" == typeof n2.type ? S(n2) : null;
  }
  function C(n2) {
    if (n2.__P && n2.__d) {
      var u4 = n2.__v, t3 = u4.__e, i3 = [], r3 = [], o3 = w({}, u4);
      o3.__v = u4.__v + 1, l.vnode && l.vnode(o3), z(n2.__P, o3, u4, n2.__n, n2.__P.namespaceURI, 32 & u4.__u ? [t3] : null, i3, null == t3 ? S(u4) : t3, !!(32 & u4.__u), r3), o3.__v = u4.__v, o3.__.__k[o3.__i] = o3, V(i3, o3, r3), u4.__e = u4.__ = null, o3.__e != t3 && M(o3);
    }
  }
  function M(n2) {
    if (null != (n2 = n2.__) && null != n2.__c) return n2.__e = n2.__c.base = null, n2.__k.some(function(l3) {
      if (null != l3 && null != l3.__e) return n2.__e = n2.__c.base = l3.__e;
    }), M(n2);
  }
  function $(n2) {
    (!n2.__d && (n2.__d = true) && i.push(n2) && !I.__r++ || r != l.debounceRendering) && ((r = l.debounceRendering) || o)(I);
  }
  function I() {
    for (var n2, l3 = 1; i.length; ) i.length > l3 && i.sort(e), n2 = i.shift(), l3 = i.length, C(n2);
    I.__r = 0;
  }
  function P(n2, l3, u4, t3, i3, r3, o3, e3, f4, c3, s3) {
    var a3, h3, y3, d3, w3, g2, _3, m3 = t3 && t3.__k || v, b = l3.length;
    for (f4 = A(u4, l3, m3, f4, b), a3 = 0; a3 < b; a3++) null != (y3 = u4.__k[a3]) && (h3 = -1 != y3.__i && m3[y3.__i] || p, y3.__i = a3, g2 = z(n2, y3, h3, i3, r3, o3, e3, f4, c3, s3), d3 = y3.__e, y3.ref && h3.ref != y3.ref && (h3.ref && D(h3.ref, null, y3), s3.push(y3.ref, y3.__c || d3, y3)), null == w3 && null != d3 && (w3 = d3), (_3 = !!(4 & y3.__u)) || h3.__k === y3.__k ? f4 = H(y3, f4, n2, _3) : "function" == typeof y3.type && void 0 !== g2 ? f4 = g2 : d3 && (f4 = d3.nextSibling), y3.__u &= -7);
    return u4.__e = w3, f4;
  }
  function A(n2, l3, u4, t3, i3) {
    var r3, o3, e3, f4, c3, s3 = u4.length, a3 = s3, h3 = 0;
    for (n2.__k = new Array(i3), r3 = 0; r3 < i3; r3++) null != (o3 = l3[r3]) && "boolean" != typeof o3 && "function" != typeof o3 ? ("string" == typeof o3 || "number" == typeof o3 || "bigint" == typeof o3 || o3.constructor == String ? o3 = n2.__k[r3] = m(null, o3, null, null, null) : d(o3) ? o3 = n2.__k[r3] = m(k, { children: o3 }, null, null, null) : void 0 === o3.constructor && o3.__b > 0 ? o3 = n2.__k[r3] = m(o3.type, o3.props, o3.key, o3.ref ? o3.ref : null, o3.__v) : n2.__k[r3] = o3, f4 = r3 + h3, o3.__ = n2, o3.__b = n2.__b + 1, e3 = null, -1 != (c3 = o3.__i = T(o3, u4, f4, a3)) && (a3--, (e3 = u4[c3]) && (e3.__u |= 2)), null == e3 || null == e3.__v ? (-1 == c3 && (i3 > s3 ? h3-- : i3 < s3 && h3++), "function" != typeof o3.type && (o3.__u |= 4)) : c3 != f4 && (c3 == f4 - 1 ? h3-- : c3 == f4 + 1 ? h3++ : (c3 > f4 ? h3-- : h3++, o3.__u |= 4))) : n2.__k[r3] = null;
    if (a3) for (r3 = 0; r3 < s3; r3++) null != (e3 = u4[r3]) && 0 == (2 & e3.__u) && (e3.__e == t3 && (t3 = S(e3)), E(e3, e3));
    return t3;
  }
  function H(n2, l3, u4, t3) {
    var i3, r3;
    if ("function" == typeof n2.type) {
      for (i3 = n2.__k, r3 = 0; i3 && r3 < i3.length; r3++) i3[r3] && (i3[r3].__ = n2, l3 = H(i3[r3], l3, u4, t3));
      return l3;
    }
    n2.__e != l3 && (t3 && (l3 && n2.type && !l3.parentNode && (l3 = S(n2)), u4.insertBefore(n2.__e, l3 || null)), l3 = n2.__e);
    do {
      l3 = l3 && l3.nextSibling;
    } while (null != l3 && 8 == l3.nodeType);
    return l3;
  }
  function T(n2, l3, u4, t3) {
    var i3, r3, o3, e3 = n2.key, f4 = n2.type, c3 = l3[u4], s3 = null != c3 && 0 == (2 & c3.__u);
    if (null === c3 && null == e3 || s3 && e3 == c3.key && f4 == c3.type) return u4;
    if (t3 > (s3 ? 1 : 0)) {
      for (i3 = u4 - 1, r3 = u4 + 1; i3 >= 0 || r3 < l3.length; ) if (null != (c3 = l3[o3 = i3 >= 0 ? i3-- : r3++]) && 0 == (2 & c3.__u) && e3 == c3.key && f4 == c3.type) return o3;
    }
    return -1;
  }
  function j(n2, l3, u4) {
    "-" == l3[0] ? n2.setProperty(l3, null == u4 ? "" : u4) : n2[l3] = null == u4 ? "" : "number" != typeof u4 || y.test(l3) ? u4 : u4 + "px";
  }
  function F(n2, l3, u4, t3, i3) {
    var r3, o3;
    n: if ("style" == l3) if ("string" == typeof u4) n2.style.cssText = u4;
    else {
      if ("string" == typeof t3 && (n2.style.cssText = t3 = ""), t3) for (l3 in t3) u4 && l3 in u4 || j(n2.style, l3, "");
      if (u4) for (l3 in u4) t3 && u4[l3] == t3[l3] || j(n2.style, l3, u4[l3]);
    }
    else if ("o" == l3[0] && "n" == l3[1]) r3 = l3 != (l3 = l3.replace(f, "$1")), o3 = l3.toLowerCase(), l3 = o3 in n2 || "onFocusOut" == l3 || "onFocusIn" == l3 ? o3.slice(2) : l3.slice(2), n2.l || (n2.l = {}), n2.l[l3 + r3] = u4, u4 ? t3 ? u4.u = t3.u : (u4.u = c, n2.addEventListener(l3, r3 ? a : s, r3)) : n2.removeEventListener(l3, r3 ? a : s, r3);
    else {
      if ("http://www.w3.org/2000/svg" == i3) l3 = l3.replace(/xlink(H|:h)/, "h").replace(/sName$/, "s");
      else if ("width" != l3 && "height" != l3 && "href" != l3 && "list" != l3 && "form" != l3 && "tabIndex" != l3 && "download" != l3 && "rowSpan" != l3 && "colSpan" != l3 && "role" != l3 && "popover" != l3 && l3 in n2) try {
        n2[l3] = null == u4 ? "" : u4;
        break n;
      } catch (n3) {
      }
      "function" == typeof u4 || (null == u4 || false === u4 && "-" != l3[4] ? n2.removeAttribute(l3) : n2.setAttribute(l3, "popover" == l3 && 1 == u4 ? "" : u4));
    }
  }
  function O(n2) {
    return function(u4) {
      if (this.l) {
        var t3 = this.l[u4.type + n2];
        if (null == u4.t) u4.t = c++;
        else if (u4.t < t3.u) return;
        return t3(l.event ? l.event(u4) : u4);
      }
    };
  }
  function z(n2, u4, t3, i3, r3, o3, e3, f4, c3, s3) {
    var a3, h3, p3, y3, _3, m3, b, S2, C3, M2, $2, I2, A3, H2, L, T3 = u4.type;
    if (void 0 !== u4.constructor) return null;
    128 & t3.__u && (c3 = !!(32 & t3.__u), o3 = [f4 = u4.__e = t3.__e]), (a3 = l.__b) && a3(u4);
    n: if ("function" == typeof T3) try {
      if (S2 = u4.props, C3 = "prototype" in T3 && T3.prototype.render, M2 = (a3 = T3.contextType) && i3[a3.__c], $2 = a3 ? M2 ? M2.props.value : a3.__ : i3, t3.__c ? b = (h3 = u4.__c = t3.__c).__ = h3.__E : (C3 ? u4.__c = h3 = new T3(S2, $2) : (u4.__c = h3 = new x(S2, $2), h3.constructor = T3, h3.render = G), M2 && M2.sub(h3), h3.state || (h3.state = {}), h3.__n = i3, p3 = h3.__d = true, h3.__h = [], h3._sb = []), C3 && null == h3.__s && (h3.__s = h3.state), C3 && null != T3.getDerivedStateFromProps && (h3.__s == h3.state && (h3.__s = w({}, h3.__s)), w(h3.__s, T3.getDerivedStateFromProps(S2, h3.__s))), y3 = h3.props, _3 = h3.state, h3.__v = u4, p3) C3 && null == T3.getDerivedStateFromProps && null != h3.componentWillMount && h3.componentWillMount(), C3 && null != h3.componentDidMount && h3.__h.push(h3.componentDidMount);
      else {
        if (C3 && null == T3.getDerivedStateFromProps && S2 !== y3 && null != h3.componentWillReceiveProps && h3.componentWillReceiveProps(S2, $2), u4.__v == t3.__v || !h3.__e && null != h3.shouldComponentUpdate && false === h3.shouldComponentUpdate(S2, h3.__s, $2)) {
          u4.__v != t3.__v && (h3.props = S2, h3.state = h3.__s, h3.__d = false), u4.__e = t3.__e, u4.__k = t3.__k, u4.__k.some(function(n3) {
            n3 && (n3.__ = u4);
          }), v.push.apply(h3.__h, h3._sb), h3._sb = [], h3.__h.length && e3.push(h3);
          break n;
        }
        null != h3.componentWillUpdate && h3.componentWillUpdate(S2, h3.__s, $2), C3 && null != h3.componentDidUpdate && h3.__h.push(function() {
          h3.componentDidUpdate(y3, _3, m3);
        });
      }
      if (h3.context = $2, h3.props = S2, h3.__P = n2, h3.__e = false, I2 = l.__r, A3 = 0, C3) h3.state = h3.__s, h3.__d = false, I2 && I2(u4), a3 = h3.render(h3.props, h3.state, h3.context), v.push.apply(h3.__h, h3._sb), h3._sb = [];
      else do {
        h3.__d = false, I2 && I2(u4), a3 = h3.render(h3.props, h3.state, h3.context), h3.state = h3.__s;
      } while (h3.__d && ++A3 < 25);
      h3.state = h3.__s, null != h3.getChildContext && (i3 = w(w({}, i3), h3.getChildContext())), C3 && !p3 && null != h3.getSnapshotBeforeUpdate && (m3 = h3.getSnapshotBeforeUpdate(y3, _3)), H2 = null != a3 && a3.type === k && null == a3.key ? q(a3.props.children) : a3, f4 = P(n2, d(H2) ? H2 : [H2], u4, t3, i3, r3, o3, e3, f4, c3, s3), h3.base = u4.__e, u4.__u &= -161, h3.__h.length && e3.push(h3), b && (h3.__E = h3.__ = null);
    } catch (n3) {
      if (u4.__v = null, c3 || null != o3) if (n3.then) {
        for (u4.__u |= c3 ? 160 : 128; f4 && 8 == f4.nodeType && f4.nextSibling; ) f4 = f4.nextSibling;
        o3[o3.indexOf(f4)] = null, u4.__e = f4;
      } else {
        for (L = o3.length; L--; ) g(o3[L]);
        N(u4);
      }
      else u4.__e = t3.__e, u4.__k = t3.__k, n3.then || N(u4);
      l.__e(n3, u4, t3);
    }
    else null == o3 && u4.__v == t3.__v ? (u4.__k = t3.__k, u4.__e = t3.__e) : f4 = u4.__e = B(t3.__e, u4, t3, i3, r3, o3, e3, c3, s3);
    return (a3 = l.diffed) && a3(u4), 128 & u4.__u ? void 0 : f4;
  }
  function N(n2) {
    n2 && (n2.__c && (n2.__c.__e = true), n2.__k && n2.__k.some(N));
  }
  function V(n2, u4, t3) {
    for (var i3 = 0; i3 < t3.length; i3++) D(t3[i3], t3[++i3], t3[++i3]);
    l.__c && l.__c(u4, n2), n2.some(function(u5) {
      try {
        n2 = u5.__h, u5.__h = [], n2.some(function(n3) {
          n3.call(u5);
        });
      } catch (n3) {
        l.__e(n3, u5.__v);
      }
    });
  }
  function q(n2) {
    return "object" != typeof n2 || null == n2 || n2.__b > 0 ? n2 : d(n2) ? n2.map(q) : w({}, n2);
  }
  function B(u4, t3, i3, r3, o3, e3, f4, c3, s3) {
    var a3, h3, v3, y3, w3, _3, m3, b = i3.props || p, k3 = t3.props, x2 = t3.type;
    if ("svg" == x2 ? o3 = "http://www.w3.org/2000/svg" : "math" == x2 ? o3 = "http://www.w3.org/1998/Math/MathML" : o3 || (o3 = "http://www.w3.org/1999/xhtml"), null != e3) {
      for (a3 = 0; a3 < e3.length; a3++) if ((w3 = e3[a3]) && "setAttribute" in w3 == !!x2 && (x2 ? w3.localName == x2 : 3 == w3.nodeType)) {
        u4 = w3, e3[a3] = null;
        break;
      }
    }
    if (null == u4) {
      if (null == x2) return document.createTextNode(k3);
      u4 = document.createElementNS(o3, x2, k3.is && k3), c3 && (l.__m && l.__m(t3, e3), c3 = false), e3 = null;
    }
    if (null == x2) b === k3 || c3 && u4.data == k3 || (u4.data = k3);
    else {
      if (e3 = e3 && n.call(u4.childNodes), !c3 && null != e3) for (b = {}, a3 = 0; a3 < u4.attributes.length; a3++) b[(w3 = u4.attributes[a3]).name] = w3.value;
      for (a3 in b) w3 = b[a3], "dangerouslySetInnerHTML" == a3 ? v3 = w3 : "children" == a3 || a3 in k3 || "value" == a3 && "defaultValue" in k3 || "checked" == a3 && "defaultChecked" in k3 || F(u4, a3, null, w3, o3);
      for (a3 in k3) w3 = k3[a3], "children" == a3 ? y3 = w3 : "dangerouslySetInnerHTML" == a3 ? h3 = w3 : "value" == a3 ? _3 = w3 : "checked" == a3 ? m3 = w3 : c3 && "function" != typeof w3 || b[a3] === w3 || F(u4, a3, w3, b[a3], o3);
      if (h3) c3 || v3 && (h3.__html == v3.__html || h3.__html == u4.innerHTML) || (u4.innerHTML = h3.__html), t3.__k = [];
      else if (v3 && (u4.innerHTML = ""), P("template" == t3.type ? u4.content : u4, d(y3) ? y3 : [y3], t3, i3, r3, "foreignObject" == x2 ? "http://www.w3.org/1999/xhtml" : o3, e3, f4, e3 ? e3[0] : i3.__k && S(i3, 0), c3, s3), null != e3) for (a3 = e3.length; a3--; ) g(e3[a3]);
      c3 || (a3 = "value", "progress" == x2 && null == _3 ? u4.removeAttribute("value") : null != _3 && (_3 !== u4[a3] || "progress" == x2 && !_3 || "option" == x2 && _3 != b[a3]) && F(u4, a3, _3, b[a3], o3), a3 = "checked", null != m3 && m3 != u4[a3] && F(u4, a3, m3, b[a3], o3));
    }
    return u4;
  }
  function D(n2, u4, t3) {
    try {
      if ("function" == typeof n2) {
        var i3 = "function" == typeof n2.__u;
        i3 && n2.__u(), i3 && null == u4 || (n2.__u = n2(u4));
      } else n2.current = u4;
    } catch (n3) {
      l.__e(n3, t3);
    }
  }
  function E(n2, u4, t3) {
    var i3, r3;
    if (l.unmount && l.unmount(n2), (i3 = n2.ref) && (i3.current && i3.current != n2.__e || D(i3, null, u4)), null != (i3 = n2.__c)) {
      if (i3.componentWillUnmount) try {
        i3.componentWillUnmount();
      } catch (n3) {
        l.__e(n3, u4);
      }
      i3.base = i3.__P = null;
    }
    if (i3 = n2.__k) for (r3 = 0; r3 < i3.length; r3++) i3[r3] && E(i3[r3], u4, t3 || "function" != typeof n2.type);
    t3 || g(n2.__e), n2.__c = n2.__ = n2.__e = void 0;
  }
  function G(n2, l3, u4) {
    return this.constructor(n2, u4);
  }
  function J(u4, t3, i3) {
    var r3, o3, e3, f4;
    t3 == document && (t3 = document.documentElement), l.__ && l.__(u4, t3), o3 = (r3 = "function" == typeof i3) ? null : i3 && i3.__k || t3.__k, e3 = [], f4 = [], z(t3, u4 = (!r3 && i3 || t3).__k = _(k, null, [u4]), o3 || p, p, t3.namespaceURI, !r3 && i3 ? [i3] : o3 ? null : t3.firstChild ? n.call(t3.childNodes) : null, e3, !r3 && i3 ? i3 : o3 ? o3.__e : t3.firstChild, r3, f4), V(e3, u4, f4);
  }
  n = v.slice, l = { __e: function(n2, l3, u4, t3) {
    for (var i3, r3, o3; l3 = l3.__; ) if ((i3 = l3.__c) && !i3.__) try {
      if ((r3 = i3.constructor) && null != r3.getDerivedStateFromError && (i3.setState(r3.getDerivedStateFromError(n2)), o3 = i3.__d), null != i3.componentDidCatch && (i3.componentDidCatch(n2, t3 || {}), o3 = i3.__d), o3) return i3.__E = i3;
    } catch (l4) {
      n2 = l4;
    }
    throw n2;
  } }, u = 0, t = function(n2) {
    return null != n2 && void 0 === n2.constructor;
  }, x.prototype.setState = function(n2, l3) {
    var u4;
    u4 = null != this.__s && this.__s != this.state ? this.__s : this.__s = w({}, this.state), "function" == typeof n2 && (n2 = n2(w({}, u4), this.props)), n2 && w(u4, n2), null != n2 && this.__v && (l3 && this._sb.push(l3), $(this));
  }, x.prototype.forceUpdate = function(n2) {
    this.__v && (this.__e = true, n2 && this.__h.push(n2), $(this));
  }, x.prototype.render = k, i = [], o = "function" == typeof Promise ? Promise.prototype.then.bind(Promise.resolve()) : setTimeout, e = function(n2, l3) {
    return n2.__v.__b - l3.__v.__b;
  }, I.__r = 0, f = /(PointerCapture)$|Capture$/i, c = 0, s = O(false), a = O(true), h = 0;

  // src/music-data.ts
  var NOTES = [
    { name: "C", displayName: "C", num: 0, accepts: ["c"] },
    { name: "C#", displayName: "C#/Db", num: 1, accepts: ["c#", "db"] },
    { name: "D", displayName: "D", num: 2, accepts: ["d"] },
    { name: "D#", displayName: "D#/Eb", num: 3, accepts: ["d#", "eb"] },
    { name: "E", displayName: "E", num: 4, accepts: ["e"] },
    { name: "F", displayName: "F", num: 5, accepts: ["f"] },
    { name: "F#", displayName: "F#/Gb", num: 6, accepts: ["f#", "gb"] },
    { name: "G", displayName: "G", num: 7, accepts: ["g"] },
    { name: "G#", displayName: "G#/Ab", num: 8, accepts: ["g#", "ab"] },
    { name: "A", displayName: "A", num: 9, accepts: ["a"] },
    { name: "A#", displayName: "A#/Bb", num: 10, accepts: ["a#", "bb"] },
    { name: "B", displayName: "B", num: 11, accepts: ["b"] }
  ];
  var NATURAL_NOTES = ["C", "D", "E", "F", "G", "A", "B"];
  var INTERVALS = [
    { name: "minor 2nd", num: 1, abbrev: "m2" },
    { name: "Major 2nd", num: 2, abbrev: "M2" },
    { name: "minor 3rd", num: 3, abbrev: "m3" },
    { name: "Major 3rd", num: 4, abbrev: "M3" },
    { name: "Perfect 4th", num: 5, abbrev: "P4" },
    { name: "Tritone", num: 6, abbrev: "TT", altAbbrevs: ["A4", "d5"] },
    { name: "Perfect 5th", num: 7, abbrev: "P5" },
    { name: "minor 6th", num: 8, abbrev: "m6" },
    { name: "Major 6th", num: 9, abbrev: "M6" },
    { name: "minor 7th", num: 10, abbrev: "m7" },
    { name: "Major 7th", num: 11, abbrev: "M7" },
    { name: "Octave", num: 12, abbrev: "P8" }
  ];
  function noteByNum(num) {
    return NOTES[(num % 12 + 12) % 12];
  }
  function noteAdd(noteNum, semitones) {
    return noteByNum(noteNum + semitones);
  }
  function noteSub(noteNum, semitones) {
    return noteByNum(noteNum - semitones);
  }
  function pickAccidentalName(displayName, useFlats) {
    if (!displayName.includes("/")) return displayName;
    const [sharp, flat] = displayName.split("/");
    return useFlats ? flat : sharp;
  }
  function pickRandomAccidental(displayName) {
    if (!displayName.includes("/")) return displayName;
    const [sharp, flat] = displayName.split("/");
    return Math.random() < 0.5 ? sharp : flat;
  }
  function noteMatchesInput(note, input) {
    return note.accepts.includes(input.toLowerCase());
  }
  function intervalMatchesInput(interval, input) {
    if (input === interval.abbrev) return true;
    if (interval.altAbbrevs && interval.altAbbrevs.includes(input)) return true;
    return false;
  }
  var LETTER_NAMES = ["C", "D", "E", "F", "G", "A", "B"];
  var NATURAL_SEMITONES = {
    C: 0,
    D: 2,
    E: 4,
    F: 5,
    G: 7,
    A: 9,
    B: 11
  };
  var MAJOR_SCALE_STEPS = [0, 2, 4, 5, 7, 9, 11];
  function parseSpelledNote(name) {
    if (!name) return { letter: "", accidental: 0 };
    const letter = name[0].toUpperCase();
    let acc = 0;
    for (let i3 = 1; i3 < name.length; i3++) {
      if (name[i3] === "#") acc++;
      else if (name[i3] === "b") acc--;
    }
    return { letter, accidental: acc };
  }
  function spelledNoteName(letter, accidental) {
    if (accidental === 0) return letter;
    if (accidental > 0) return letter + "#".repeat(accidental);
    return letter + "b".repeat(-accidental);
  }
  function spelledNoteSemitone(name) {
    const { letter, accidental } = parseSpelledNote(name);
    return ((NATURAL_SEMITONES[letter] + accidental) % 12 + 12) % 12;
  }
  function getScaleDegreeNote(keyRoot, degree) {
    const root = parseSpelledNote(keyRoot);
    const rootLetterIdx = LETTER_NAMES.indexOf(root.letter);
    const rootSemitone = ((NATURAL_SEMITONES[root.letter] + root.accidental) % 12 + 12) % 12;
    const targetLetterIdx = (rootLetterIdx + degree - 1) % 7;
    const targetLetter = LETTER_NAMES[targetLetterIdx];
    const targetSemitone = (rootSemitone + MAJOR_SCALE_STEPS[degree - 1]) % 12;
    const naturalSemitone = NATURAL_SEMITONES[targetLetter];
    let acc = (targetSemitone - naturalSemitone + 12) % 12;
    if (acc > 6) acc -= 12;
    return spelledNoteName(targetLetter, acc);
  }
  var MAJOR_KEYS = [
    {
      root: "C",
      sharps: 0,
      flats: 0,
      accidentalCount: 0,
      accidentalType: "none"
    },
    {
      root: "G",
      sharps: 1,
      flats: 0,
      accidentalCount: 1,
      accidentalType: "sharps"
    },
    {
      root: "D",
      sharps: 2,
      flats: 0,
      accidentalCount: 2,
      accidentalType: "sharps"
    },
    {
      root: "A",
      sharps: 3,
      flats: 0,
      accidentalCount: 3,
      accidentalType: "sharps"
    },
    {
      root: "E",
      sharps: 4,
      flats: 0,
      accidentalCount: 4,
      accidentalType: "sharps"
    },
    {
      root: "B",
      sharps: 5,
      flats: 0,
      accidentalCount: 5,
      accidentalType: "sharps"
    },
    {
      root: "F#",
      sharps: 6,
      flats: 0,
      accidentalCount: 6,
      accidentalType: "sharps"
    },
    {
      root: "F",
      sharps: 0,
      flats: 1,
      accidentalCount: 1,
      accidentalType: "flats"
    },
    {
      root: "Bb",
      sharps: 0,
      flats: 2,
      accidentalCount: 2,
      accidentalType: "flats"
    },
    {
      root: "Eb",
      sharps: 0,
      flats: 3,
      accidentalCount: 3,
      accidentalType: "flats"
    },
    {
      root: "Ab",
      sharps: 0,
      flats: 4,
      accidentalCount: 4,
      accidentalType: "flats"
    },
    {
      root: "Db",
      sharps: 0,
      flats: 5,
      accidentalCount: 5,
      accidentalType: "flats"
    }
  ];
  function keySignatureLabel(key) {
    if (key.accidentalCount === 0) return "0";
    if (key.accidentalType === "sharps") return key.accidentalCount + "#";
    return key.accidentalCount + "b";
  }
  var DIATONIC_CHORDS = [
    { degree: 1, numeral: "I", quality: "major", qualityLabel: "" },
    { degree: 2, numeral: "ii", quality: "minor", qualityLabel: "m" },
    { degree: 3, numeral: "iii", quality: "minor", qualityLabel: "m" },
    { degree: 4, numeral: "IV", quality: "major", qualityLabel: "" },
    { degree: 5, numeral: "V", quality: "major", qualityLabel: "" },
    { degree: 6, numeral: "vi", quality: "minor", qualityLabel: "m" },
    {
      degree: 7,
      numeral: "vii\xB0",
      quality: "diminished",
      qualityLabel: "dim"
    }
  ];
  var ROMAN_NUMERALS = DIATONIC_CHORDS.map((c3) => c3.numeral);
  var DEGREE_LETTER_OFFSETS = {
    "R": 0,
    "2": 1,
    "b3": 2,
    "3": 2,
    "4": 3,
    "b5": 4,
    "5": 4,
    "#5": 4,
    "6": 5,
    "b7": 6,
    "7": 6
  };
  var CHORD_TYPES = [
    {
      name: "major",
      symbol: "",
      intervals: [0, 4, 7],
      degrees: ["R", "3", "5"],
      group: 0
    },
    {
      name: "minor",
      symbol: "m",
      intervals: [0, 3, 7],
      degrees: ["R", "b3", "5"],
      group: 1
    },
    {
      name: "dom7",
      symbol: "7",
      intervals: [0, 4, 7, 10],
      degrees: ["R", "3", "5", "b7"],
      group: 2
    },
    {
      name: "maj7",
      symbol: "maj7",
      intervals: [0, 4, 7, 11],
      degrees: ["R", "3", "5", "7"],
      group: 3
    },
    {
      name: "min7",
      symbol: "m7",
      intervals: [0, 3, 7, 10],
      degrees: ["R", "b3", "5", "b7"],
      group: 4
    },
    {
      name: "dim",
      symbol: "dim",
      intervals: [0, 3, 6],
      degrees: ["R", "b3", "b5"],
      group: 5
    },
    {
      name: "aug",
      symbol: "aug",
      intervals: [0, 4, 8],
      degrees: ["R", "3", "#5"],
      group: 5
    },
    {
      name: "halfdim",
      symbol: "m7b5",
      intervals: [0, 3, 6, 10],
      degrees: ["R", "b3", "b5", "b7"],
      group: 5
    },
    {
      name: "sus2",
      symbol: "sus2",
      intervals: [0, 2, 7],
      degrees: ["R", "2", "5"],
      group: 6
    },
    {
      name: "sus4",
      symbol: "sus4",
      intervals: [0, 5, 7],
      degrees: ["R", "4", "5"],
      group: 6
    },
    {
      name: "6",
      symbol: "6",
      intervals: [0, 4, 7, 9],
      degrees: ["R", "3", "5", "6"],
      group: 6
    }
  ];
  var CHORD_ROOTS = [
    "C",
    "Db",
    "D",
    "Eb",
    "E",
    "F",
    "F#",
    "G",
    "Ab",
    "A",
    "Bb",
    "B"
  ];
  function getChordTones(rootName, chordType) {
    const root = parseSpelledNote(rootName);
    const rootLetterIdx = LETTER_NAMES.indexOf(root.letter);
    const rootSemitone = ((NATURAL_SEMITONES[root.letter] + root.accidental) % 12 + 12) % 12;
    return chordType.intervals.map((interval, i3) => {
      const degreeLabel = chordType.degrees[i3];
      const letterOffset = DEGREE_LETTER_OFFSETS[degreeLabel];
      const targetLetter = LETTER_NAMES[(rootLetterIdx + letterOffset) % 7];
      const targetSemitone = (rootSemitone + interval) % 12;
      const naturalSemitone = NATURAL_SEMITONES[targetLetter];
      let acc = (targetSemitone - naturalSemitone + 12) % 12;
      if (acc > 6) acc -= 12;
      return spelledNoteName(targetLetter, acc);
    });
  }
  function spelledNoteMatchesInput(expectedName, input) {
    const expected = parseSpelledNote(expectedName);
    const given = parseSpelledNote(input);
    return given.letter.toUpperCase() === expected.letter.toUpperCase() && given.accidental === expected.accidental;
  }
  function spelledNoteMatchesSemitone(expectedName, input) {
    return spelledNoteSemitone(expectedName) === spelledNoteSemitone(input);
  }
  var GUITAR = {
    id: "fretboard",
    // mode ID (preserved for backward compat)
    name: "Guitar Fretboard",
    storageNamespace: "fretboard",
    stringCount: 6,
    fretCount: 13,
    // frets 0–12
    stringNames: ["e", "B", "G", "D", "A", "E"],
    stringOffsets: [4, 11, 7, 2, 9, 4],
    // semitones from C per string
    defaultString: 5,
    // low E
    fretMarkers: [3, 5, 7, 9, 12]
  };
  var UKULELE = {
    id: "ukulele",
    name: "Ukulele Fretboard",
    storageNamespace: "ukulele",
    stringCount: 4,
    fretCount: 13,
    // frets 0–12
    stringNames: ["A", "E", "C", "G"],
    // 1st (top) to 4th (bottom)
    stringOffsets: [9, 4, 0, 7],
    // A=9, E=4, C=0, G=7
    defaultString: 2,
    // C string (lowest pitch)
    fretMarkers: [3, 5, 7, 10, 12]
  };
  var STRING_NAMES = GUITAR.stringNames;
  var STRING_OFFSETS = GUITAR.stringOffsets;
  var SOLFEGE_MAP = {
    C: "Do",
    D: "Re",
    E: "Mi",
    F: "Fa",
    G: "Sol",
    A: "La",
    B: "Si"
  };
  var _useSolfege = false;
  function getUseSolfege() {
    return _useSolfege;
  }
  function setUseSolfege(v3) {
    _useSolfege = v3;
    try {
      localStorage.setItem("fretboard_notation", v3 ? "solfege" : "letter");
    } catch (_3) {
    }
  }
  try {
    _useSolfege = localStorage.getItem("fretboard_notation") === "solfege";
  } catch (_3) {
  }
  function displayNote(name) {
    if (!name) return name;
    const letter = name[0].toUpperCase();
    const acc = name.slice(1).replace(/#/g, "\u266F").replace(/b/g, "\u266D");
    if (!_useSolfege) {
      return name[0] + acc;
    }
    const syl = SOLFEGE_MAP[letter];
    if (!syl) return name[0] + acc;
    const out = name[0] === name[0].toLowerCase() ? syl.toLowerCase() : syl;
    return out + acc;
  }

  // src/navigation.ts
  function createNavigation() {
    const LAST_MODE_KEY = "fretboard_lastMode";
    const modes = {};
    let currentModeId = null;
    const homeScreen = document.getElementById("home-screen");
    function registerMode(id, modeController) {
      modes[id] = modeController;
    }
    function navigateHome() {
      if (currentModeId && modes[currentModeId]) {
        modes[currentModeId].deactivate();
        const currentScreen = document.getElementById("mode-" + currentModeId);
        if (currentScreen) currentScreen.classList.remove("mode-active");
      }
      currentModeId = null;
      if (homeScreen) homeScreen.classList.remove("hidden");
    }
    function switchTo(modeId) {
      if (!modes[modeId]) return;
      if (homeScreen) homeScreen.classList.add("hidden");
      if (currentModeId && modes[currentModeId]) {
        modes[currentModeId].deactivate();
        const currentScreen = document.getElementById("mode-" + currentModeId);
        if (currentScreen) currentScreen.classList.remove("mode-active");
      }
      currentModeId = modeId;
      const newScreen = document.getElementById("mode-" + modeId);
      if (newScreen) newScreen.classList.add("mode-active");
      modes[modeId].activate();
      localStorage.setItem(LAST_MODE_KEY, modeId);
    }
    function init() {
      if (homeScreen) {
        homeScreen.querySelectorAll(".home-mode-btn").forEach(
          function(btn) {
            btn.addEventListener("click", function() {
              switchTo(btn.dataset.mode);
            });
          }
        );
      }
      document.querySelectorAll(".mode-back-btn").forEach(
        function(btn) {
          btn.addEventListener("click", function() {
            navigateHome();
          });
        }
      );
      document.addEventListener("keydown", function(e3) {
        if (e3.key !== "Escape" || !currentModeId) return;
        if (document.querySelector(".settings-overlay.open")) return;
        const modeScreen = document.getElementById("mode-" + currentModeId);
        if (modeScreen && !modeScreen.classList.contains("phase-idle")) return;
        navigateHome();
      });
      for (const id of Object.keys(modes)) {
        modes[id].init();
      }
      const lastMode = localStorage.getItem(LAST_MODE_KEY);
      if (lastMode && modes[lastMode]) {
        switchTo(lastMode);
      } else {
        navigateHome();
      }
    }
    return { registerMode, switchTo, navigateHome, init };
  }

  // src/settings.ts
  function createSettingsModal(options) {
    const onNotationChange = options.onNotationChange || function() {
    };
    const overlay = document.createElement("div");
    overlay.className = "settings-overlay";
    const modal = document.createElement("div");
    modal.className = "settings-modal";
    modal.innerHTML = '<div class="settings-header"><span class="settings-title">Settings</span><button class="settings-close-btn" aria-label="Close">\xD7</button></div><div class="settings-body"><div class="settings-field"><div class="settings-label">Note names</div><div class="settings-toggle-group"><button class="settings-toggle-btn" data-notation="letter">A B C</button><button class="settings-toggle-btn" data-notation="solfege">Do Re Mi</button></div></div></div>';
    overlay.appendChild(modal);
    document.body.appendChild(overlay);
    const closeBtn = modal.querySelector(".settings-close-btn");
    const toggleBtns = modal.querySelectorAll(".settings-toggle-btn");
    function updateToggleState() {
      const current = getUseSolfege() ? "solfege" : "letter";
      toggleBtns.forEach(function(btn) {
        btn.classList.toggle("active", btn.dataset.notation === current);
      });
    }
    function open() {
      updateToggleState();
      overlay.classList.add("open");
    }
    function close() {
      overlay.classList.remove("open");
    }
    closeBtn.addEventListener("click", close);
    overlay.addEventListener("click", function(e3) {
      if (e3.target === overlay) close();
    });
    document.addEventListener("keydown", function(e3) {
      if (e3.key === "Escape" && overlay.classList.contains("open")) {
        close();
      }
    });
    toggleBtns.forEach(function(btn) {
      btn.addEventListener("click", function() {
        const wantSolfege = btn.dataset.notation === "solfege";
        if (wantSolfege !== getUseSolfege()) {
          setUseSolfege(wantSolfege);
          updateToggleState();
          onNotationChange();
        }
      });
    });
    return { open, close };
  }

  // src/quiz-engine.ts
  function createNoteKeyHandler(submitAnswer, allowAccidentals = () => true) {
    let pendingNote = null;
    let pendingTimeout = null;
    function reset() {
      if (pendingTimeout) clearTimeout(pendingTimeout);
      pendingNote = null;
      pendingTimeout = null;
    }
    function handleKey(e3) {
      const key = e3.key.toUpperCase();
      if (pendingNote && allowAccidentals()) {
        if (e3.key === "#" || e3.key === "s" || e3.key === "S" || e3.shiftKey && e3.key === "3") {
          e3.preventDefault();
          if (pendingTimeout) clearTimeout(pendingTimeout);
          submitAnswer(pendingNote + "#");
          pendingNote = null;
          pendingTimeout = null;
          return true;
        }
        if (e3.key === "b" || e3.key === "B") {
          e3.preventDefault();
          if (pendingTimeout) clearTimeout(pendingTimeout);
          submitAnswer(pendingNote + "b");
          pendingNote = null;
          pendingTimeout = null;
          return true;
        }
      }
      if ("CDEFGAB".includes(key)) {
        e3.preventDefault();
        if (pendingTimeout) clearTimeout(pendingTimeout);
        if (!allowAccidentals()) {
          submitAnswer(key);
        } else {
          pendingNote = key;
          pendingTimeout = setTimeout(() => {
            submitAnswer(pendingNote);
            pendingNote = null;
            pendingTimeout = null;
          }, 400);
        }
        return true;
      }
      return false;
    }
    return { handleKey, reset };
  }
  function createSolfegeKeyHandler(submitAnswer, allowAccidentals = () => true) {
    const SOLFEGE_TO_NOTE = {
      "do": "C",
      "re": "D",
      "mi": "E",
      "fa": "F",
      "so": "G",
      "la": "A",
      "si": "B"
    };
    const FIRST_CHARS = /* @__PURE__ */ new Set(["d", "r", "m", "f", "s", "l"]);
    let buffer = "";
    let pendingNote = null;
    let pendingTimeout = null;
    function reset() {
      buffer = "";
      if (pendingTimeout) clearTimeout(pendingTimeout);
      pendingTimeout = null;
      pendingNote = null;
    }
    function submitPending() {
      if (pendingNote) {
        if (pendingTimeout) clearTimeout(pendingTimeout);
        submitAnswer(pendingNote);
        pendingNote = null;
        pendingTimeout = null;
      }
    }
    function handleKey(e3) {
      const key = e3.key.toLowerCase();
      if (pendingNote && allowAccidentals()) {
        if (e3.key === "#" || e3.shiftKey && e3.key === "3") {
          e3.preventDefault();
          if (pendingTimeout) clearTimeout(pendingTimeout);
          submitAnswer(pendingNote + "#");
          pendingNote = null;
          pendingTimeout = null;
          return true;
        }
        if (key === "b") {
          e3.preventDefault();
          if (pendingTimeout) clearTimeout(pendingTimeout);
          submitAnswer(pendingNote + "b");
          pendingNote = null;
          pendingTimeout = null;
          return true;
        }
      }
      if (pendingNote && FIRST_CHARS.has(key)) {
        submitPending();
      }
      if (buffer.length > 0) {
        e3.preventDefault();
        buffer += key;
        const note = SOLFEGE_TO_NOTE[buffer];
        if (note) {
          buffer = "";
          if (!allowAccidentals()) {
            submitAnswer(note);
          } else {
            pendingNote = note;
            pendingTimeout = setTimeout(() => {
              submitAnswer(pendingNote);
              pendingNote = null;
              pendingTimeout = null;
            }, 400);
          }
        } else if (buffer.length >= 2) {
          buffer = "";
        }
        return true;
      }
      if (FIRST_CHARS.has(key)) {
        e3.preventDefault();
        submitPending();
        buffer = key;
        return true;
      }
      return false;
    }
    return { handleKey, reset };
  }
  function createAdaptiveKeyHandler(submitAnswer, allowAccidentals = () => true) {
    const letterHandler = createNoteKeyHandler(submitAnswer, allowAccidentals);
    const solfegeHandler = createSolfegeKeyHandler(
      submitAnswer,
      allowAccidentals
    );
    return {
      handleKey(e3) {
        return getUseSolfege() ? solfegeHandler.handleKey(e3) : letterHandler.handleKey(e3);
      },
      reset() {
        letterHandler.reset();
        solfegeHandler.reset();
      }
    };
  }
  function refreshNoteButtonLabels(container) {
    container.querySelectorAll(".answer-btn-note").forEach(
      function(btn) {
        const note = NOTES.find(function(n2) {
          return n2.name === btn.dataset.note;
        });
        if (note) btn.textContent = displayNote(note.name);
      }
    );
    container.querySelectorAll(".note-btn").forEach(
      function(btn) {
        const noteName = btn.dataset.note;
        if (noteName) btn.textContent = displayNote(noteName);
      }
    );
    container.querySelectorAll(".string-toggle").forEach(
      function(btn) {
        const stringNote = btn.dataset.stringNote;
        if (stringNote) btn.textContent = displayNote(stringNote);
      }
    );
  }

  // node_modules/preact/hooks/dist/hooks.module.js
  var t2;
  var r2;
  var u2;
  var i2;
  var o2 = 0;
  var f2 = [];
  var c2 = l;
  var e2 = c2.__b;
  var a2 = c2.__r;
  var v2 = c2.diffed;
  var l2 = c2.__c;
  var m2 = c2.unmount;
  var s2 = c2.__;
  function p2(n2, t3) {
    c2.__h && c2.__h(r2, n2, o2 || t3), o2 = 0;
    var u4 = r2.__H || (r2.__H = { __: [], __h: [] });
    return n2 >= u4.__.length && u4.__.push({}), u4.__[n2];
  }
  function d2(n2) {
    return o2 = 1, h2(D2, n2);
  }
  function h2(n2, u4, i3) {
    var o3 = p2(t2++, 2);
    if (o3.t = n2, !o3.__c && (o3.__ = [i3 ? i3(u4) : D2(void 0, u4), function(n3) {
      var t3 = o3.__N ? o3.__N[0] : o3.__[0], r3 = o3.t(t3, n3);
      t3 !== r3 && (o3.__N = [r3, o3.__[1]], o3.__c.setState({}));
    }], o3.__c = r2, !r2.__f)) {
      var f4 = function(n3, t3, r3) {
        if (!o3.__c.__H) return true;
        var u5 = o3.__c.__H.__.filter(function(n4) {
          return n4.__c;
        });
        if (u5.every(function(n4) {
          return !n4.__N;
        })) return !c3 || c3.call(this, n3, t3, r3);
        var i4 = o3.__c.props !== n3;
        return u5.some(function(n4) {
          if (n4.__N) {
            var t4 = n4.__[0];
            n4.__ = n4.__N, n4.__N = void 0, t4 !== n4.__[0] && (i4 = true);
          }
        }), c3 && c3.call(this, n3, t3, r3) || i4;
      };
      r2.__f = true;
      var c3 = r2.shouldComponentUpdate, e3 = r2.componentWillUpdate;
      r2.componentWillUpdate = function(n3, t3, r3) {
        if (this.__e) {
          var u5 = c3;
          c3 = void 0, f4(n3, t3, r3), c3 = u5;
        }
        e3 && e3.call(this, n3, t3, r3);
      }, r2.shouldComponentUpdate = f4;
    }
    return o3.__N || o3.__;
  }
  function y2(n2, u4) {
    var i3 = p2(t2++, 3);
    !c2.__s && C2(i3.__H, u4) && (i3.__ = n2, i3.u = u4, r2.__H.__h.push(i3));
  }
  function _2(n2, u4) {
    var i3 = p2(t2++, 4);
    !c2.__s && C2(i3.__H, u4) && (i3.__ = n2, i3.u = u4, r2.__h.push(i3));
  }
  function A2(n2) {
    return o2 = 5, T2(function() {
      return { current: n2 };
    }, []);
  }
  function T2(n2, r3) {
    var u4 = p2(t2++, 7);
    return C2(u4.__H, r3) && (u4.__ = n2(), u4.__H = r3, u4.__h = n2), u4.__;
  }
  function q2(n2, t3) {
    return o2 = 8, T2(function() {
      return n2;
    }, t3);
  }
  function j2() {
    for (var n2; n2 = f2.shift(); ) {
      var t3 = n2.__H;
      if (n2.__P && t3) try {
        t3.__h.some(z2), t3.__h.some(B2), t3.__h = [];
      } catch (r3) {
        t3.__h = [], c2.__e(r3, n2.__v);
      }
    }
  }
  c2.__b = function(n2) {
    r2 = null, e2 && e2(n2);
  }, c2.__ = function(n2, t3) {
    n2 && t3.__k && t3.__k.__m && (n2.__m = t3.__k.__m), s2 && s2(n2, t3);
  }, c2.__r = function(n2) {
    a2 && a2(n2), t2 = 0;
    var i3 = (r2 = n2.__c).__H;
    i3 && (u2 === r2 ? (i3.__h = [], r2.__h = [], i3.__.some(function(n3) {
      n3.__N && (n3.__ = n3.__N), n3.u = n3.__N = void 0;
    })) : (i3.__h.some(z2), i3.__h.some(B2), i3.__h = [], t2 = 0)), u2 = r2;
  }, c2.diffed = function(n2) {
    v2 && v2(n2);
    var t3 = n2.__c;
    t3 && t3.__H && (t3.__H.__h.length && (1 !== f2.push(t3) && i2 === c2.requestAnimationFrame || ((i2 = c2.requestAnimationFrame) || w2)(j2)), t3.__H.__.some(function(n3) {
      n3.u && (n3.__H = n3.u), n3.u = void 0;
    })), u2 = r2 = null;
  }, c2.__c = function(n2, t3) {
    t3.some(function(n3) {
      try {
        n3.__h.some(z2), n3.__h = n3.__h.filter(function(n4) {
          return !n4.__ || B2(n4);
        });
      } catch (r3) {
        t3.some(function(n4) {
          n4.__h && (n4.__h = []);
        }), t3 = [], c2.__e(r3, n3.__v);
      }
    }), l2 && l2(n2, t3);
  }, c2.unmount = function(n2) {
    m2 && m2(n2);
    var t3, r3 = n2.__c;
    r3 && r3.__H && (r3.__H.__.some(function(n3) {
      try {
        z2(n3);
      } catch (n4) {
        t3 = n4;
      }
    }), r3.__H = void 0, t3 && c2.__e(t3, r3.__v));
  };
  var k2 = "function" == typeof requestAnimationFrame;
  function w2(n2) {
    var t3, r3 = function() {
      clearTimeout(u4), k2 && cancelAnimationFrame(t3), setTimeout(n2);
    }, u4 = setTimeout(r3, 35);
    k2 && (t3 = requestAnimationFrame(r3));
  }
  function z2(n2) {
    var t3 = r2, u4 = n2.__c;
    "function" == typeof u4 && (n2.__c = void 0, u4()), r2 = t3;
  }
  function B2(n2) {
    var t3 = r2;
    n2.__c = n2.__(), r2 = t3;
  }
  function C2(n2, t3) {
    return !n2 || n2.length !== t3.length || t3.some(function(t4, r3) {
      return t4 !== n2[r3];
    });
  }
  function D2(n2, t3) {
    return "function" == typeof t3 ? t3(n2) : t3;
  }

  // src/mode-ui-state.ts
  function countFluent(itemIds, getAutomaticity, threshold) {
    let fluent = 0;
    let seen = 0;
    for (let i3 = 0; i3 < itemIds.length; i3++) {
      const auto = getAutomaticity(itemIds[i3]);
      if (auto !== null) {
        seen++;
        if (auto > threshold) fluent++;
      }
    }
    return { fluent, seen };
  }
  function statusLabelFromPct(pct) {
    if (pct >= 80) return "Strong";
    if (pct >= 50) return "Solid";
    if (pct >= 20) return "Building";
    return "Getting started";
  }
  function buildRecommendationText(result, getGroupLabel, extraParts) {
    if (result.recommended.size === 0) return "";
    const parts = [];
    if (result.consolidateIndices.length > 0) {
      const labels = result.consolidateIndices.slice().sort((a3, b) => a3 - b).map(getGroupLabel);
      parts.push(
        "solidify " + labels.join(", ") + " \u2014 " + result.consolidateDueCount + " slow item" + (result.consolidateDueCount !== 1 ? "s" : "")
      );
    }
    if (result.expandIndex !== null) {
      parts.push(
        "start " + getGroupLabel(result.expandIndex) + " \u2014 " + result.expandNewCount + " new item" + (result.expandNewCount !== 1 ? "s" : "")
      );
    }
    if (extraParts) {
      for (let i3 = 0; i3 < extraParts.length; i3++) {
        parts.push(extraParts[i3]);
      }
    }
    return parts.length > 0 ? "Suggestion: " + parts.join(", ") : "";
  }
  function computePracticeSummary(opts) {
    const threshold = opts.selector.getConfig().automaticityThreshold;
    const { fluent, seen } = countFluent(
      opts.allItemIds,
      (id) => opts.selector.getAutomaticity(id),
      threshold
    );
    const total = opts.allItemIds.length;
    let statusLabel;
    let statusDetail;
    if (seen === 0) {
      statusLabel = "Ready to start";
      statusDetail = total + " " + opts.itemNoun + " to learn";
    } else {
      const pct = total > 0 ? Math.round(fluent / total * 100) : 0;
      statusLabel = "Overall: " + statusLabelFromPct(pct);
      statusDetail = fluent + " of " + total + " " + opts.itemNoun + " fluent";
    }
    const hasRec = opts.recommendation !== null && opts.recommendation.recommended.size > 0;
    return {
      statusLabel,
      statusDetail,
      recommendationText: opts.recommendationText,
      showRecommendationButton: hasRec,
      sessionSummary: opts.sessionSummary,
      masteryText: opts.masteryText,
      showMastery: opts.showMastery,
      enabledItemCount: total
    };
  }

  // src/adaptive.ts
  var DEFAULT_CONFIG = {
    minTime: 1e3,
    unseenBoost: 3,
    ewmaAlpha: 0.3,
    maxStoredTimes: 10,
    maxResponseTime: 9e3,
    // Forgetting model
    initialStability: 4,
    // hours — half-life after first correct answer
    maxStability: 336,
    // hours (14 days) — stability ceiling
    stabilityGrowthBase: 2,
    // multiplier on each correct answer
    stabilityDecayOnWrong: 0.3,
    // multiplier on wrong answer
    recallThreshold: 0.5,
    // P(recall) below this = "due"
    expansionThreshold: 0.7,
    // fraction of seen items that must be retained before suggesting new strings
    speedBonusMax: 1.5,
    // fast answers grow stability up to this extra factor
    selfCorrectionThreshold: 1500,
    // ms — response time below this triggers self-correction
    automaticityTarget: 3e3,
    // ms — response time at which speedScore ≈ 0.5
    automaticityThreshold: 0.8
    // automaticity above this = "automatic" (matches stats heatmap)
  };
  function computeEwma(oldEwma, newTime, alpha) {
    return alpha * newTime + (1 - alpha) * oldEwma;
  }
  function computeRecall(stabilityHours, elapsedHours) {
    if (stabilityHours == null || elapsedHours == null) return null;
    if (stabilityHours <= 0) return 0;
    if (elapsedHours <= 0) return 1;
    return Math.pow(2, -elapsedHours / stabilityHours);
  }
  function computeSpeedScore(ewmaMs, cfg, responseCount = 1) {
    if (ewmaMs == null) return null;
    const effectiveTarget = cfg.automaticityTarget * responseCount;
    const effectiveMin = cfg.minTime * responseCount;
    const k3 = Math.LN2 / (effectiveTarget - effectiveMin);
    return Math.exp(-k3 * Math.max(0, ewmaMs - effectiveMin));
  }
  function computeAutomaticity(recall, speedScore) {
    if (recall == null || speedScore == null) return null;
    return recall * speedScore;
  }
  function computeAutomaticityForDisplay(recall, speedScore, hasSeen) {
    const value = computeAutomaticity(recall, speedScore);
    if (value == null && hasSeen) return 0;
    return value;
  }
  function updateStability(oldStability, responseTimeMs, elapsedHours, cfg) {
    if (oldStability == null) {
      return cfg.initialStability;
    }
    const range = cfg.maxResponseTime - cfg.minTime;
    const clamped = Math.max(
      cfg.minTime,
      Math.min(responseTimeMs, cfg.maxResponseTime)
    );
    const t3 = range > 0 ? (cfg.maxResponseTime - clamped) / range : 0.5;
    const speedFactor = 0.5 + t3 * (cfg.speedBonusMax - 0.5);
    let newStability = oldStability * cfg.stabilityGrowthBase * speedFactor;
    if (elapsedHours !== null && elapsedHours > 0 && responseTimeMs < cfg.selfCorrectionThreshold) {
      newStability = Math.max(newStability, elapsedHours * 1.5);
    }
    return Math.min(newStability, cfg.maxStability);
  }
  function computeStabilityAfterWrong(oldStability, cfg) {
    if (oldStability == null) return cfg.initialStability;
    return Math.max(
      cfg.initialStability,
      oldStability * cfg.stabilityDecayOnWrong
    );
  }
  function computeWeight(stats, cfg) {
    if (!stats) {
      return cfg.unseenBoost;
    }
    const speedWeight = Math.max(stats.ewma, cfg.minTime) / cfg.minTime;
    if (stats.stability != null && stats.lastCorrectAt != null) {
      const elapsedHours = (Date.now() - stats.lastCorrectAt) / 36e5;
      const recall = computeRecall(stats.stability, elapsedHours);
      const recallWeight = recall != null ? 1 + (1 - recall) : 1;
      return speedWeight * recallWeight;
    }
    return speedWeight;
  }
  function selectWeighted(items, weights, rand) {
    const totalWeight = weights.reduce((sum, w3) => sum + w3, 0);
    if (totalWeight === 0) {
      return items[Math.floor(rand * items.length)];
    }
    let remaining = rand * totalWeight;
    for (let i3 = 0; i3 < items.length; i3++) {
      remaining -= weights[i3];
      if (remaining <= 0) return items[i3];
    }
    return items[items.length - 1];
  }
  function deriveScaledConfig(motorBaseline, baseCfg = DEFAULT_CONFIG) {
    const scale = motorBaseline / 1e3;
    return {
      ...baseCfg,
      minTime: Math.round(baseCfg.minTime * scale),
      automaticityTarget: Math.round(baseCfg.automaticityTarget * scale),
      selfCorrectionThreshold: Math.round(
        baseCfg.selfCorrectionThreshold * scale
      ),
      maxResponseTime: Math.round(baseCfg.maxResponseTime * scale)
    };
  }
  function computeMedian(values) {
    if (values.length === 0) return null;
    const sorted = [...values].sort((a3, b) => a3 - b);
    const mid = Math.floor(sorted.length / 2);
    if (sorted.length % 2 === 1) return sorted[mid];
    return (sorted[mid - 1] + sorted[mid]) / 2;
  }
  function createAdaptiveSelector(storage, cfg = DEFAULT_CONFIG, randomFn = Math.random, responseCountFn = null) {
    function getResponseCount(itemId) {
      return responseCountFn ? responseCountFn(itemId) : 1;
    }
    function scaledConfig(itemId) {
      const rc = getResponseCount(itemId);
      if (rc <= 1) return cfg;
      return {
        ...cfg,
        minTime: cfg.minTime * rc,
        automaticityTarget: cfg.automaticityTarget * rc,
        maxResponseTime: cfg.maxResponseTime * rc,
        selfCorrectionThreshold: cfg.selfCorrectionThreshold * rc
      };
    }
    function recordResponse(itemId, timeMs, correct = true) {
      const itemCfg = scaledConfig(itemId);
      const clamped = Math.min(timeMs, itemCfg.maxResponseTime);
      const existing = storage.getStats(itemId);
      const now = Date.now();
      if (correct) {
        const elapsedHours = existing && existing.lastCorrectAt ? (now - existing.lastCorrectAt) / 36e5 : null;
        if (existing) {
          const newEwma = computeEwma(existing.ewma, clamped, cfg.ewmaAlpha);
          const newTimes = [...existing.recentTimes, clamped].slice(
            -cfg.maxStoredTimes
          );
          const newStability = updateStability(
            existing.stability ?? null,
            clamped,
            elapsedHours,
            itemCfg
          );
          storage.saveStats(itemId, {
            recentTimes: newTimes,
            ewma: newEwma,
            sampleCount: existing.sampleCount + 1,
            lastSeen: now,
            stability: newStability,
            lastCorrectAt: now
          });
        } else {
          storage.saveStats(itemId, {
            recentTimes: [clamped],
            ewma: clamped,
            sampleCount: 1,
            lastSeen: now,
            stability: cfg.initialStability,
            lastCorrectAt: now
          });
        }
      } else {
        if (existing) {
          const newStability = computeStabilityAfterWrong(
            existing.stability ?? null,
            cfg
          );
          storage.saveStats(itemId, {
            ...existing,
            lastSeen: now,
            stability: newStability
          });
        } else {
          storage.saveStats(itemId, {
            recentTimes: [],
            ewma: itemCfg.maxResponseTime,
            sampleCount: 0,
            lastSeen: now,
            stability: cfg.initialStability,
            lastCorrectAt: null
          });
        }
      }
    }
    function getWeight(itemId) {
      return computeWeight(storage.getStats(itemId), scaledConfig(itemId));
    }
    function getStats(itemId) {
      return storage.getStats(itemId);
    }
    function selectNext(validItems) {
      if (validItems.length === 0) {
        throw new Error("validItems cannot be empty");
      }
      if (validItems.length === 1) {
        storage.setLastSelected(validItems[0]);
        return validItems[0];
      }
      const lastSelected = storage.getLastSelected();
      const weights = validItems.map(
        (id) => id === lastSelected ? 0 : getWeight(id)
      );
      const selected = selectWeighted(validItems, weights, randomFn());
      storage.setLastSelected(selected);
      return selected;
    }
    function getRecall(itemId) {
      const stats = storage.getStats(itemId);
      if (!stats || stats.stability == null || stats.lastCorrectAt == null) {
        return null;
      }
      const elapsedHours = (Date.now() - stats.lastCorrectAt) / 36e5;
      return computeRecall(stats.stability, elapsedHours);
    }
    function getAutomaticity(itemId) {
      const stats = storage.getStats(itemId);
      if (!stats) return null;
      const recall = getRecall(itemId);
      const speed = computeSpeedScore(stats.ewma, scaledConfig(itemId));
      return computeAutomaticityForDisplay(recall, speed, true);
    }
    function getStringRecommendations(stringIndices, getItemIds) {
      const results = stringIndices.map((s3) => {
        const items = getItemIds(s3);
        let dueCount = 0;
        let unseenCount = 0;
        let masteredCount = 0;
        for (const id of items) {
          const recall = getRecall(id);
          if (recall === null) {
            unseenCount++;
          } else if (recall < cfg.recallThreshold) {
            dueCount++;
          } else {
            masteredCount++;
          }
        }
        return {
          string: s3,
          dueCount,
          unseenCount,
          masteredCount,
          totalCount: items.length
        };
      });
      results.sort(
        (a3, b) => b.dueCount + b.unseenCount - (a3.dueCount + a3.unseenCount)
      );
      return results;
    }
    function checkAllMastered(items) {
      for (const id of items) {
        const recall = getRecall(id);
        if (recall === null || recall < cfg.recallThreshold) return false;
      }
      return items.length > 0;
    }
    function checkAllAutomatic(items) {
      for (const id of items) {
        const auto = getAutomaticity(id);
        if (auto === null || auto <= cfg.automaticityThreshold) return false;
      }
      return items.length > 0;
    }
    function checkNeedsReview(items) {
      if (items.length === 0) return false;
      let hasDueItem = false;
      for (const id of items) {
        const stats = storage.getStats(id);
        if (!stats || stats.lastCorrectAt == null || stats.sampleCount < 2) {
          return false;
        }
        const rc = getResponseCount(id);
        const speed = computeSpeedScore(stats.ewma, cfg, rc);
        if (speed == null || speed < 0.5) return false;
        const recall = getRecall(id);
        if (recall !== null && recall < cfg.recallThreshold) hasDueItem = true;
      }
      return hasDueItem;
    }
    function updateConfig(newCfg) {
      cfg = { ...cfg, ...newCfg };
    }
    function getConfig() {
      return cfg;
    }
    return {
      recordResponse,
      selectNext,
      getStats,
      getWeight,
      getRecall,
      getAutomaticity,
      getStringRecommendations,
      checkAllMastered,
      checkAllAutomatic,
      checkNeedsReview,
      updateConfig,
      getConfig
    };
  }
  function createLocalStorageAdapter(namespace) {
    const cache = {};
    const mkKey = (itemId) => `adaptive_${namespace}_${itemId}`;
    const dlKey = (itemId) => `deadline_${namespace}_${itemId}`;
    const lastKey = `adaptive_${namespace}_lastSelected`;
    return {
      getStats(itemId) {
        const k3 = mkKey(itemId);
        if (!(k3 in cache)) {
          const data = localStorage.getItem(k3);
          try {
            cache[k3] = data ? JSON.parse(data) : null;
          } catch {
            cache[k3] = null;
          }
        }
        return cache[k3];
      },
      saveStats(itemId, stats) {
        const k3 = mkKey(itemId);
        cache[k3] = stats;
        localStorage.setItem(k3, JSON.stringify(stats));
      },
      getLastSelected() {
        return localStorage.getItem(lastKey);
      },
      setLastSelected(itemId) {
        localStorage.setItem(lastKey, itemId);
      },
      getDeadline(itemId) {
        const k3 = dlKey(itemId);
        if (!(k3 in cache)) {
          const data = localStorage.getItem(k3);
          cache[k3] = data ? Number(data) : null;
        }
        return cache[k3];
      },
      saveDeadline(itemId, deadline) {
        const k3 = dlKey(itemId);
        cache[k3] = deadline;
        localStorage.setItem(k3, String(deadline));
      },
      /** Pre-populate cache to avoid localStorage reads during gameplay. */
      preload(itemIds) {
        for (const itemId of itemIds) {
          this.getStats(itemId);
        }
      }
    };
  }

  // src/hooks/use-learner-model.ts
  function useLearnerModel(namespace, allItemIds, provider = "button", responseCountFn) {
    const storageRef = A2(null);
    const selectorRef = A2(null);
    const baselineRef = A2(null);
    const model = T2(() => {
      const storage = createLocalStorageAdapter(namespace);
      const rcFn = responseCountFn ?? null;
      const selector = createAdaptiveSelector(
        storage,
        DEFAULT_CONFIG,
        Math.random,
        rcFn
      );
      storageRef.current = storage;
      selectorRef.current = selector;
      return { storage, selector };
    }, [namespace]);
    y2(() => {
      model.storage.preload?.(allItemIds);
    }, [model.storage, allItemIds]);
    y2(() => {
      const baselineKey = "motorBaseline_" + provider;
      const legacyKey = "motorBaseline_" + namespace;
      let stored = localStorage.getItem(baselineKey);
      if (!stored && legacyKey !== baselineKey) {
        stored = localStorage.getItem(legacyKey);
        if (stored) localStorage.setItem(baselineKey, stored);
      }
      if (stored) {
        const parsed = parseInt(stored, 10);
        if (parsed > 0) {
          baselineRef.current = parsed;
          model.selector.updateConfig(deriveScaledConfig(parsed, DEFAULT_CONFIG));
        }
      }
    }, [model.selector, provider, namespace]);
    return {
      selector: model.selector,
      storage: model.storage,
      get motorBaseline() {
        return baselineRef.current;
      },
      applyBaseline(baseline) {
        baselineRef.current = baseline;
        localStorage.setItem("motorBaseline_" + provider, String(baseline));
        model.selector.updateConfig(
          deriveScaledConfig(baseline, DEFAULT_CONFIG)
        );
      },
      syncBaseline() {
        const stored = localStorage.getItem("motorBaseline_" + provider);
        if (stored) {
          const parsed = parseInt(stored, 10);
          if (parsed > 0 && parsed !== baselineRef.current) {
            baselineRef.current = parsed;
            model.selector.updateConfig(
              deriveScaledConfig(parsed, DEFAULT_CONFIG)
            );
          }
        }
      }
    };
  }

  // src/quiz-engine-state.ts
  function initialEngineState() {
    return {
      phase: "idle",
      // 'idle' | 'active' | 'round-complete' | 'calibration-intro' | 'calibrating' | 'calibration-results'
      currentItemId: null,
      answered: false,
      questionStartTime: null,
      // Session tracking
      questionCount: 0,
      quizStartTime: null,
      // Round tracking
      roundNumber: 0,
      roundAnswered: 0,
      roundCorrect: 0,
      roundTimerExpired: false,
      roundResponseTimes: [],
      roundDurationMs: 0,
      // Progress tracking
      masteredCount: 0,
      totalEnabledCount: 0,
      // Feedback
      feedbackText: "",
      feedbackClass: "feedback",
      timeDisplayText: "",
      hintText: "",
      // Mastery message
      masteryText: "",
      showMastery: false,
      // Calibration
      calibrationBaseline: null,
      // UI visibility
      quizActive: false,
      answersEnabled: false
    };
  }
  function engineStart(state) {
    return {
      ...state,
      phase: "active",
      questionCount: 0,
      quizStartTime: Date.now(),
      quizActive: true,
      showMastery: false,
      roundNumber: 1,
      roundAnswered: 0,
      roundCorrect: 0,
      roundTimerExpired: false,
      roundResponseTimes: []
    };
  }
  function engineNextQuestion(state, nextItemId, nowMs) {
    return {
      ...state,
      currentItemId: nextItemId,
      answered: false,
      questionStartTime: nowMs,
      questionCount: state.questionCount + 1,
      feedbackText: "",
      feedbackClass: "feedback",
      timeDisplayText: "",
      hintText: "",
      answersEnabled: true
    };
  }
  function engineSubmitAnswer(state, isCorrect, correctAnswer) {
    return {
      ...state,
      answered: true,
      answersEnabled: false,
      feedbackText: isCorrect ? "Correct!" : "Incorrect \u2014 " + correctAnswer,
      feedbackClass: isCorrect ? "feedback correct" : "feedback incorrect",
      timeDisplayText: "",
      hintText: "Tap anywhere or press Space for next",
      roundAnswered: state.roundAnswered + 1,
      roundCorrect: state.roundCorrect + (isCorrect ? 1 : 0)
    };
  }
  function engineRoundTimerExpired(state) {
    return {
      ...state,
      roundTimerExpired: true
    };
  }
  function engineRoundComplete(state) {
    return {
      ...state,
      phase: "round-complete",
      answered: false,
      answersEnabled: false,
      currentItemId: null,
      feedbackText: "",
      feedbackClass: "feedback",
      hintText: ""
    };
  }
  function engineContinueRound(state) {
    return {
      ...state,
      phase: "active",
      roundNumber: state.roundNumber + 1,
      roundAnswered: 0,
      roundCorrect: 0,
      roundTimerExpired: false,
      roundResponseTimes: []
    };
  }
  function engineStop(_state) {
    return initialEngineState();
  }
  function engineUpdateIdleMessage(state, allMastered, needsReview) {
    if (state.phase !== "idle") return state;
    if (allMastered) {
      return {
        ...state,
        masteryText: "Looks like you\u2019ve got this!",
        showMastery: true
      };
    }
    if (needsReview) {
      return { ...state, masteryText: "Time to review?", showMastery: true };
    }
    return { ...state, masteryText: "", showMastery: false };
  }
  function engineUpdateMasteryAfterAnswer(state, allMastered) {
    if (allMastered) {
      return {
        ...state,
        masteryText: "Looks like you\u2019ve got this!",
        showMastery: true
      };
    }
    return { ...state, showMastery: false };
  }
  function engineUpdateProgress(state, masteredCount, totalEnabledCount) {
    return { ...state, masteredCount, totalEnabledCount };
  }
  function engineRouteKey(state, key) {
    if (state.phase === "idle") return { action: "ignore" };
    if (key === "Escape") return { action: "stop" };
    if (state.phase === "round-complete") {
      if (key === " " || key === "Enter") return { action: "continue" };
      return { action: "ignore" };
    }
    if (state.phase !== "active") return { action: "ignore" };
    if ((key === " " || key === "Enter") && state.answered) {
      return { action: "next" };
    }
    if (!state.answered) return { action: "delegate" };
    return { action: "ignore" };
  }

  // src/hooks/use-quiz-engine.ts
  var ROUND_DURATION_MS = 6e4;
  var AUTO_ADVANCE_MS = 1e3;
  var TIMER_TICK_MS = 200;
  function formatRoundTime(ms) {
    const totalSec = Math.max(0, Math.ceil(ms / 1e3));
    const min = Math.floor(totalSec / 60);
    const sec = totalSec % 60;
    return min + ":" + (sec < 10 ? "0" : "") + sec;
  }
  function useQuizEngine(config, selector) {
    const [state, setState] = d2(initialEngineState);
    const [timerPct, setTimerPct] = d2(100);
    const [timerText, setTimerText] = d2("");
    const [timerWarning, setTimerWarning] = d2(false);
    const [timerLastQuestion, setTimerLastQuestion] = d2(false);
    const stateRef = A2(state);
    stateRef.current = state;
    const configRef = A2(config);
    configRef.current = config;
    const selectorRef = A2(selector);
    selectorRef.current = selector;
    const roundTimerRef = A2(null);
    const roundTimerStartRef = A2(null);
    const autoAdvanceRef = A2(null);
    const computeProgress = q2(() => {
      const items = configRef.current.getEnabledItems();
      let mastered = 0;
      const threshold = selectorRef.current.getConfig().automaticityThreshold;
      for (const id of items) {
        const auto = selectorRef.current.getAutomaticity(id);
        if (auto !== null && auto > threshold) mastered++;
      }
      return { masteredCount: mastered, totalEnabledCount: items.length };
    }, []);
    const stopRoundTimer = q2(() => {
      if (roundTimerRef.current) {
        clearInterval(roundTimerRef.current);
        roundTimerRef.current = null;
      }
      roundTimerStartRef.current = null;
      setTimerPct(100);
      setTimerText("");
      setTimerWarning(false);
      setTimerLastQuestion(false);
    }, []);
    const transitionToRoundCompleteRef = A2(null);
    const nextQuestionRef = A2(null);
    const transitionToRoundComplete = q2(() => {
      const roundDurationMs = roundTimerStartRef.current ? Date.now() - roundTimerStartRef.current : 0;
      stopRoundTimer();
      setState((prev) => {
        const s3 = engineRoundComplete(prev);
        return { ...s3, roundDurationMs };
      });
    }, [stopRoundTimer]);
    transitionToRoundCompleteRef.current = transitionToRoundComplete;
    const handleRoundTimerExpiry = q2(() => {
      if (stateRef.current.phase !== "active") return;
      setState((prev) => {
        const next = engineRoundTimerExpired(prev);
        if (next.answered) {
          setTimeout(() => transitionToRoundCompleteRef.current(), 0);
        } else {
          setTimerLastQuestion(true);
        }
        return next;
      });
    }, []);
    const startRoundTimer = q2(() => {
      if (roundTimerRef.current) clearInterval(roundTimerRef.current);
      roundTimerStartRef.current = Date.now();
      setTimerPct(100);
      setTimerText(formatRoundTime(ROUND_DURATION_MS));
      setTimerWarning(false);
      setTimerLastQuestion(false);
      roundTimerRef.current = setInterval(() => {
        const elapsed = Date.now() - roundTimerStartRef.current;
        const remaining = ROUND_DURATION_MS - elapsed;
        const pct = Math.max(0, remaining / ROUND_DURATION_MS * 100);
        setTimerPct(pct);
        setTimerText(formatRoundTime(remaining));
        setTimerWarning(remaining <= 1e4 && remaining > 0);
        if (remaining <= 0) {
          if (roundTimerRef.current) clearInterval(roundTimerRef.current);
          roundTimerRef.current = null;
          setTimerPct(0);
          setTimerText("0:00");
          setTimerWarning(false);
          handleRoundTimerExpiry();
        }
      }, TIMER_TICK_MS);
    }, [handleRoundTimerExpiry]);
    const nextQuestion = q2(() => {
      if (autoAdvanceRef.current) {
        clearTimeout(autoAdvanceRef.current);
        autoAdvanceRef.current = null;
      }
      if (stateRef.current.roundTimerExpired) {
        transitionToRoundCompleteRef.current();
        return;
      }
      const items = configRef.current.getEnabledItems();
      if (items.length === 0) return;
      const nextItemId = selectorRef.current.selectNext(items);
      setState((prev) => engineNextQuestion(prev, nextItemId, Date.now()));
      if (configRef.current.onPresent) {
        configRef.current.onPresent(nextItemId);
      }
    }, []);
    nextQuestionRef.current = nextQuestion;
    const submitAnswer = q2((input) => {
      const s3 = stateRef.current;
      if (s3.phase !== "active" || s3.answered) return;
      const responseTime = Date.now() - s3.questionStartTime;
      const result = configRef.current.checkAnswer(s3.currentItemId, input);
      selectorRef.current.recordResponse(
        s3.currentItemId,
        responseTime,
        result.correct
      );
      setState((prev) => {
        let next = engineSubmitAnswer(prev, result.correct, result.correctAnswer);
        next = {
          ...next,
          roundResponseTimes: [...next.roundResponseTimes, responseTime]
        };
        const allMastered = selectorRef.current.checkAllAutomatic(
          configRef.current.getEnabledItems()
        );
        next = engineUpdateMasteryAfterAnswer(next, allMastered);
        const progress = computeProgress();
        next = engineUpdateProgress(
          next,
          progress.masteredCount,
          progress.totalEnabledCount
        );
        return next;
      });
      if (configRef.current.onAnswer) {
        configRef.current.onAnswer(
          s3.currentItemId,
          result,
          responseTime
        );
      }
      if (stateRef.current.roundTimerExpired) {
        setTimeout(() => {
          if (stateRef.current.phase === "active") {
            transitionToRoundCompleteRef.current();
          }
        }, 600);
      } else {
        autoAdvanceRef.current = setTimeout(() => {
          if (stateRef.current.phase === "active" && stateRef.current.answered) {
            nextQuestionRef.current();
          }
        }, AUTO_ADVANCE_MS);
      }
    }, [computeProgress]);
    const start = q2(() => {
      if (configRef.current.onStart) configRef.current.onStart();
      setState((prev) => {
        let next = engineStart(prev);
        const progress = computeProgress();
        next = engineUpdateProgress(
          next,
          progress.masteredCount,
          progress.totalEnabledCount
        );
        return next;
      });
      startRoundTimer();
      setTimeout(() => nextQuestionRef.current(), 0);
    }, [startRoundTimer, computeProgress]);
    const continueQuiz = q2(() => {
      setState(engineContinueRound);
      startRoundTimer();
      setTimeout(() => nextQuestionRef.current(), 0);
    }, [startRoundTimer]);
    const stop = q2(() => {
      if (autoAdvanceRef.current) {
        clearTimeout(autoAdvanceRef.current);
        autoAdvanceRef.current = null;
      }
      stopRoundTimer();
      setState(engineStop);
      if (configRef.current.onStop) configRef.current.onStop();
    }, [stopRoundTimer]);
    const updateIdleMessage = q2(() => {
      if (stateRef.current.phase !== "idle") return;
      const items = configRef.current.getEnabledItems();
      setState(
        (prev) => engineUpdateIdleMessage(
          prev,
          selectorRef.current.checkAllAutomatic(items),
          selectorRef.current.checkNeedsReview(items)
        )
      );
    }, []);
    y2(() => {
      if (state.phase === "idle") return;
      function handleKeydown(e3) {
        const routed = engineRouteKey(stateRef.current, e3.key);
        switch (routed.action) {
          case "stop":
            e3.stopImmediatePropagation();
            stop();
            break;
          case "next":
            e3.preventDefault();
            if (autoAdvanceRef.current) {
              clearTimeout(autoAdvanceRef.current);
              autoAdvanceRef.current = null;
            }
            nextQuestionRef.current();
            break;
          case "continue":
            e3.preventDefault();
            continueQuiz();
            break;
          case "delegate":
            if (configRef.current.handleKey) {
              configRef.current.handleKey(e3, { submitAnswer });
            }
            break;
          case "ignore":
            break;
        }
      }
      document.addEventListener("keydown", handleKeydown);
      return () => document.removeEventListener("keydown", handleKeydown);
    }, [state.phase !== "idle", stop, continueQuiz, submitAnswer]);
    y2(() => {
      return () => {
        if (roundTimerRef.current) clearInterval(roundTimerRef.current);
        if (autoAdvanceRef.current) clearTimeout(autoAdvanceRef.current);
      };
    }, []);
    return {
      state,
      timerPct,
      timerText,
      timerWarning,
      timerLastQuestion,
      start,
      stop,
      submitAnswer,
      nextQuestion,
      continueQuiz,
      updateIdleMessage
    };
  }

  // src/hooks/use-phase-class.ts
  var PHASE_CLASSES = ["phase-idle", "phase-active", "phase-round-complete"];
  function usePhaseClass(container, phase) {
    y2(() => {
      const cls = phase === "idle" ? "phase-idle" : phase === "round-complete" ? "phase-round-complete" : "phase-active";
      container.classList.remove(...PHASE_CLASSES);
      container.classList.add(cls);
    }, [phase, container]);
  }

  // src/hooks/use-round-summary.ts
  function useStatsSelector(selector, enginePhase, statsMode) {
    return T2(() => ({
      getAutomaticity: (id) => selector.getAutomaticity(id),
      getStats: (id) => selector.getStats(id)
    }), [selector, enginePhase, statsMode]);
  }
  function useRoundSummary(engine, learner, practicingLabel) {
    const roundContext = T2(() => {
      const s3 = engine.state;
      const fluency = s3.masteredCount + " / " + s3.totalEnabledCount + " fluent";
      return practicingLabel + " \xB7 " + fluency;
    }, [
      engine.state.masteredCount,
      engine.state.totalEnabledCount,
      practicingLabel
    ]);
    const roundCorrect = T2(() => {
      const s3 = engine.state;
      const dur = Math.round((s3.roundDurationMs || 0) / 1e3);
      return s3.roundCorrect + " / " + s3.roundAnswered + " correct \xB7 " + dur + "s";
    }, [
      engine.state.roundCorrect,
      engine.state.roundAnswered,
      engine.state.roundDurationMs
    ]);
    const roundMedian = T2(() => {
      const times = engine.state.roundResponseTimes;
      const median = computeMedian(times);
      return median !== null ? (median / 1e3).toFixed(1) + "s median response time" : "";
    }, [engine.state.roundResponseTimes]);
    const baselineText = learner.motorBaseline ? "Response time baseline: " + (learner.motorBaseline / 1e3).toFixed(1) + "s" : "Response time baseline: 1s (default)";
    const answerCount = engine.state.roundAnswered;
    const countText = answerCount + (answerCount === 1 ? " answer" : " answers");
    return { roundContext, roundCorrect, roundMedian, baselineText, countText };
  }

  // node_modules/preact/jsx-runtime/dist/jsxRuntime.module.js
  var f3 = 0;
  function u3(e3, t3, n2, o3, i3, u4) {
    t3 || (t3 = {});
    var a3, c3, p3 = t3;
    if ("ref" in p3) for (c3 in p3 = {}, t3) "ref" == c3 ? a3 = t3[c3] : p3[c3] = t3[c3];
    var l3 = { type: e3, props: p3, key: n2, ref: a3, __k: null, __: null, __b: 0, __e: null, __c: null, constructor: void 0, __v: --f3, __i: -1, __u: 0, __source: i3, __self: u4 };
    if ("function" == typeof e3 && (a3 = e3.defaultProps)) for (c3 in a3) void 0 === p3[c3] && (p3[c3] = a3[c3]);
    return l.vnode && l.vnode(l3), l3;
  }

  // src/ui/buttons.tsx
  var ALL_NOTES = [
    "C",
    "C#",
    "D",
    "D#",
    "E",
    "F",
    "F#",
    "G",
    "G#",
    "A",
    "A#",
    "B"
  ];
  var ACCIDENTALS = ["C#", "D#", "F#", "G#", "A#"];
  var NATURALS = ["C", "D", "E", "F", "G", "A", "B"];
  var INTERVALS2 = [
    "m2",
    "M2",
    "m3",
    "M3",
    "P4",
    "TT",
    "P5",
    "m6",
    "M6",
    "m7",
    "M7",
    "P8"
  ];
  var KEYSIGS = [
    "0",
    "1#",
    "2#",
    "3#",
    "4#",
    "5#",
    "6#",
    "7#",
    "1b",
    "2b",
    "3b",
    "4b",
    "5b",
    "6b",
    "7b"
  ];
  var DEGREES = [
    ["1", "1st"],
    ["2", "2nd"],
    ["3", "3rd"],
    ["4", "4th"],
    ["5", "5th"],
    ["6", "6th"],
    ["7", "7th"]
  ];
  var NUMERALS = ["I", "ii", "iii", "IV", "V", "vi", "vii\xB0"];
  function NoteButtons({ onAnswer, hidden, useFlats }) {
    const cls = "answer-buttons answer-buttons-notes" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: ALL_NOTES.map((n2) => {
      let label;
      if (useFlats !== void 0) {
        const note = NOTES.find((x2) => x2.name === n2);
        label = note ? displayNote(pickAccidentalName(note.displayName, useFlats)) : displayNote(n2);
      } else {
        label = displayNote(n2);
      }
      return /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "answer-btn answer-btn-note",
          "data-note": n2,
          onClick: onAnswer ? () => onAnswer(n2) : void 0,
          children: label
        },
        n2
      );
    }) });
  }
  function PianoNoteButtons({ onAnswer, hideAccidentals }) {
    return /* @__PURE__ */ u3("div", { class: "note-buttons", children: [
      /* @__PURE__ */ u3("div", { class: "note-row-accidentals", children: ACCIDENTALS.map((n2) => /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "note-btn accidental" + (hideAccidentals ? " hidden" : ""),
          "data-note": n2,
          onClick: onAnswer ? () => onAnswer(n2) : void 0,
          children: displayNote(n2)
        },
        n2
      )) }),
      /* @__PURE__ */ u3("div", { class: "note-row-naturals", children: NATURALS.map((n2) => /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "note-btn",
          "data-note": n2,
          onClick: onAnswer ? () => onAnswer(n2) : void 0,
          children: displayNote(n2)
        },
        n2
      )) })
    ] });
  }
  function NumberButtons({ start, end, onAnswer, hidden }) {
    const nums = [];
    for (let i3 = start; i3 <= end; i3++) nums.push(i3);
    const cls = "answer-buttons answer-buttons-numbers" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: nums.map((i3) => /* @__PURE__ */ u3(
      "button",
      {
        type: "button",
        class: "answer-btn answer-btn-num",
        "data-num": String(i3),
        onClick: onAnswer ? () => onAnswer(i3) : void 0,
        children: i3
      },
      i3
    )) });
  }
  function IntervalButtons({ onAnswer, hidden }) {
    const cls = "answer-buttons answer-buttons-intervals" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: INTERVALS2.map((iv) => /* @__PURE__ */ u3(
      "button",
      {
        type: "button",
        class: "answer-btn answer-btn-interval",
        "data-interval": iv,
        onClick: onAnswer ? () => onAnswer(iv) : void 0,
        children: iv
      },
      iv
    )) });
  }
  function KeysigButtons({ onAnswer, hidden }) {
    const cls = "answer-buttons answer-buttons-keysig" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: KEYSIGS.map((s3) => /* @__PURE__ */ u3(
      "button",
      {
        type: "button",
        class: "answer-btn answer-btn-keysig",
        "data-sig": s3,
        onClick: onAnswer ? () => onAnswer(s3) : void 0,
        children: s3
      },
      s3
    )) });
  }
  function DegreeButtons({ onAnswer, hidden }) {
    const cls = "answer-buttons answer-buttons-degrees" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: DEGREES.map(([val, label]) => /* @__PURE__ */ u3(
      "button",
      {
        type: "button",
        class: "answer-btn answer-btn-degree",
        "data-degree": val,
        onClick: onAnswer ? () => onAnswer(val) : void 0,
        children: label
      },
      val
    )) });
  }
  function NumeralButtons({ onAnswer, hidden }) {
    const cls = "answer-buttons answer-buttons-numerals" + (hidden ? " answer-group-hidden" : "");
    return /* @__PURE__ */ u3("div", { class: cls, children: NUMERALS.map((n2) => /* @__PURE__ */ u3(
      "button",
      {
        type: "button",
        class: "answer-btn answer-btn-numeral",
        "data-numeral": n2,
        onClick: onAnswer ? () => onAnswer(n2) : void 0,
        children: n2
      },
      n2
    )) });
  }

  // src/ui/mode-screen.tsx
  function ModeTopBar({ title, onBack }) {
    return /* @__PURE__ */ u3("div", { class: "mode-top-bar", children: [
      /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "mode-back-btn",
          "aria-label": "Back to home",
          onClick: onBack,
          children: "\u2190"
        }
      ),
      /* @__PURE__ */ u3("h1", { class: "mode-title", children: title })
    ] });
  }
  function TabbedIdle({ activeTab, onTabSwitch, practiceContent, progressContent }) {
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3("div", { class: "mode-tabs", children: [
        /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: "mode-tab" + (activeTab === "practice" ? " active" : ""),
            "data-tab": "practice",
            onClick: () => onTabSwitch("practice"),
            children: "Practice"
          }
        ),
        /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: "mode-tab" + (activeTab === "progress" ? " active" : ""),
            "data-tab": "progress",
            onClick: () => onTabSwitch("progress"),
            children: "Progress"
          }
        )
      ] }),
      /* @__PURE__ */ u3(
        "div",
        {
          class: "tab-content tab-practice" + (activeTab === "practice" ? " active" : ""),
          children: practiceContent
        }
      ),
      /* @__PURE__ */ u3(
        "div",
        {
          class: "tab-content tab-progress" + (activeTab === "progress" ? " active" : ""),
          children: progressContent
        }
      )
    ] });
  }
  function PracticeCard({
    statusLabel,
    statusDetail,
    recommendation,
    mastery,
    scope,
    sessionSummary,
    onStart,
    onApplyRecommendation
  }) {
    const recBlock = recommendation ? /* @__PURE__ */ u3("div", { class: "practice-recommendation", children: [
      /* @__PURE__ */ u3("span", { class: "practice-rec-text", children: recommendation }),
      onApplyRecommendation ? /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "practice-rec-btn",
          onClick: onApplyRecommendation,
          children: "Use suggestion"
        }
      ) : null
    ] }) : null;
    const masteryBlock = mastery ? /* @__PURE__ */ u3("div", { class: "mastery-message visible", children: mastery }) : null;
    const statusExtra = !scope ? /* @__PURE__ */ u3(k, { children: [
      recBlock,
      masteryBlock
    ] }) : null;
    const scopeZone = scope ? /* @__PURE__ */ u3("div", { class: "practice-zone practice-zone-scope", children: [
      recBlock,
      /* @__PURE__ */ u3("div", { class: "practice-scope", children: /* @__PURE__ */ u3("div", { class: "settings-row", children: scope }) }),
      masteryBlock
    ] }) : null;
    return /* @__PURE__ */ u3("div", { class: "practice-card", children: [
      /* @__PURE__ */ u3("div", { class: "practice-zone practice-zone-status", children: [
        /* @__PURE__ */ u3("div", { class: "practice-status", children: [
          /* @__PURE__ */ u3("span", { class: "practice-status-label", children: statusLabel || "" }),
          /* @__PURE__ */ u3("span", { class: "practice-status-detail", children: statusDetail || "" })
        ] }),
        statusExtra
      ] }),
      scopeZone,
      /* @__PURE__ */ u3("div", { class: "practice-zone practice-zone-action", children: /* @__PURE__ */ u3(StartButton, { summary: sessionSummary, onStart }) })
    ] });
  }
  function StartButton({ summary, onStart }) {
    return /* @__PURE__ */ u3(k, { children: [
      summary ? /* @__PURE__ */ u3("div", { class: "session-summary-text", children: summary }) : null,
      /* @__PURE__ */ u3("button", { type: "button", class: "start-btn", onClick: onStart, children: "Start Quiz" })
    ] });
  }
  function QuizSession({
    timeLeft,
    context,
    count,
    fluent,
    total,
    isWarning,
    isLastQuestion,
    onClose
  }) {
    const pct = total ? Math.round((fluent || 0) / total * 100) : 0;
    return /* @__PURE__ */ u3("div", { class: "quiz-session", children: [
      /* @__PURE__ */ u3("div", { class: "quiz-countdown-row", children: [
        /* @__PURE__ */ u3(
          "div",
          {
            class: "quiz-countdown-bar" + (isWarning ? " round-timer-warning" : "") + (isLastQuestion ? " last-question" : ""),
            children: /* @__PURE__ */ u3("div", { class: "quiz-countdown-fill" })
          }
        ),
        /* @__PURE__ */ u3("span", { class: "quiz-info-time", children: timeLeft || "" })
      ] }),
      /* @__PURE__ */ u3(SessionInfo, { context, count }),
      /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "quiz-header-close",
          "aria-label": "Stop quiz",
          onClick: onClose,
          children: "\xD7"
        }
      ),
      /* @__PURE__ */ u3("div", { class: "progress-bar", children: [
        /* @__PURE__ */ u3("div", { class: "progress-fill", style: { width: `${pct}%` } }),
        /* @__PURE__ */ u3("div", { class: "progress-text", children: fluent != null && total != null ? `${fluent} / ${total} fluent` : "" })
      ] })
    ] });
  }
  function SessionInfo({ context, count }) {
    return /* @__PURE__ */ u3("div", { class: "quiz-session-info", children: [
      /* @__PURE__ */ u3("span", { class: "quiz-info-context", children: context || "" }),
      /* @__PURE__ */ u3("span", { class: "quiz-info-count", children: count || "" })
    ] });
  }
  function QuizArea({ prompt, lastQuestion, children }) {
    return /* @__PURE__ */ u3("div", { class: "quiz-area", children: [
      /* @__PURE__ */ u3("div", { class: "quiz-prompt-row", children: [
        /* @__PURE__ */ u3("div", { class: "quiz-prompt", children: prompt || "" }),
        /* @__PURE__ */ u3("div", { class: "quiz-last-question", children: lastQuestion || "" })
      ] }),
      children
    ] });
  }
  function RoundComplete({ context, heading, correct, median, onContinue, onStop }) {
    return /* @__PURE__ */ u3("div", { class: "round-complete", children: [
      /* @__PURE__ */ u3("div", { class: "round-complete-context", children: context || "" }),
      /* @__PURE__ */ u3("div", { class: "round-complete-heading", children: heading || "" }),
      /* @__PURE__ */ u3("div", { class: "round-complete-stats", children: [
        /* @__PURE__ */ u3("div", { class: "round-stat-line round-stat-correct", children: correct || "" }),
        /* @__PURE__ */ u3("div", { class: "round-stat-line round-stat-median", children: median || "" })
      ] }),
      /* @__PURE__ */ u3("div", { class: "round-complete-actions", children: [
        /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: "round-complete-continue",
            onClick: onContinue,
            children: "Keep Going"
          }
        ),
        /* @__PURE__ */ u3("button", { type: "button", class: "round-complete-stop", onClick: onStop, children: "Stop" })
      ] })
    ] });
  }

  // src/stats-display.ts
  var _heatmapColors = null;
  function cssVar(name) {
    try {
      const val = getComputedStyle(document.documentElement).getPropertyValue(
        name
      ).trim();
      if (val) return val;
    } catch (_3) {
    }
    return "";
  }
  function heatmapColors() {
    if (!_heatmapColors) {
      _heatmapColors = {
        none: cssVar("--heatmap-none") || "hsl(30, 4%, 85%)",
        level: [
          cssVar("--heatmap-1") || "hsl(12, 48%, 65%)",
          cssVar("--heatmap-2") || "hsl(30, 48%, 58%)",
          cssVar("--heatmap-3") || "hsl(50, 40%, 50%)",
          cssVar("--heatmap-4") || "hsl(72, 38%, 42%)",
          cssVar("--heatmap-5") || "hsl(90, 45%, 35%)"
        ]
      };
    }
    return _heatmapColors;
  }
  function heatmapNeedsLightText(color) {
    const m3 = color && color.match(/,\s*(\d+)%\s*\)/);
    return m3 ? parseInt(m3[1], 10) <= 50 : false;
  }
  var RETENTION_LABELS = [
    "Needs work (&lt;20%)",
    "Fading (&gt;20%)",
    "Getting there (&gt;40%)",
    "Solid (&gt;60%)",
    "Automatic (&gt;80%)"
  ];
  function getAutomaticityColor(auto) {
    const c3 = heatmapColors();
    if (auto === null) return c3.none;
    if (auto > 0.8) return c3.level[4];
    if (auto > 0.6) return c3.level[3];
    if (auto > 0.4) return c3.level[2];
    if (auto > 0.2) return c3.level[1];
    return c3.level[0];
  }
  function getSpeedHeatmapColor(ms, baseline) {
    const c3 = heatmapColors();
    if (ms === null) return c3.none;
    const b = baseline || 1e3;
    if (ms < b * 1.5) return c3.level[4];
    if (ms < b * 3) return c3.level[3];
    if (ms < b * 4.5) return c3.level[2];
    if (ms < b * 6) return c3.level[1];
    return c3.level[0];
  }
  function getStatsCellColor(selector, itemId, statsMode, baseline) {
    if (statsMode === "retention") {
      return getAutomaticityColor(selector.getAutomaticity(itemId));
    }
    const stats = selector.getStats(itemId);
    return getSpeedHeatmapColor(stats ? stats.ewma : null, baseline);
  }
  function getStatsCellColorMerged(selector, itemIds, statsMode, baseline) {
    if (typeof itemIds === "string") {
      return getStatsCellColor(selector, itemIds, statsMode, baseline);
    }
    if (statsMode === "retention") {
      let sum = 0, count = 0;
      for (let i3 = 0; i3 < itemIds.length; i3++) {
        const a3 = selector.getAutomaticity(itemIds[i3]);
        if (a3 !== null) {
          sum += a3;
          count++;
        }
      }
      return getAutomaticityColor(count > 0 ? sum / count : null);
    }
    let sum2 = 0, count2 = 0;
    for (let j3 = 0; j3 < itemIds.length; j3++) {
      const stats = selector.getStats(itemIds[j3]);
      if (stats && stats.ewma != null) {
        sum2 += stats.ewma;
        count2++;
      }
    }
    return getSpeedHeatmapColor(count2 > 0 ? sum2 / count2 : null, baseline);
  }
  function formatThreshold(ms) {
    const s3 = ms / 1e3;
    return s3 % 1 === 0 ? s3 + "s" : s3.toFixed(1) + "s";
  }
  function legendItem(color, label) {
    return '<div class="legend-item"><div class="legend-swatch" style="background:' + color + '"></div>' + label + "</div>";
  }
  function buildStatsLegend(statsMode, baseline) {
    const c3 = heatmapColors();
    let html = '<div class="heatmap-legend active">';
    html += legendItem(c3.none, "No data");
    if (statsMode === "retention") {
      for (let i3 = c3.level.length - 1; i3 >= 0; i3--) {
        html += legendItem(c3.level[i3], RETENTION_LABELS[i3]);
      }
    } else {
      const b = baseline || 1e3;
      const t1 = formatThreshold(b * 1.5);
      const t22 = formatThreshold(b * 3);
      const t3 = formatThreshold(b * 4.5);
      const t4 = formatThreshold(b * 6);
      html += legendItem(c3.level[4], "&lt; " + t1);
      html += legendItem(c3.level[3], t1 + "\u2013" + t22);
      html += legendItem(c3.level[2], t22 + "\u2013" + t3);
      html += legendItem(c3.level[1], t3 + "\u2013" + t4);
      html += legendItem(c3.level[0], "&ge; " + t4);
    }
    html += "</div>";
    return html;
  }

  // src/ui/stats.tsx
  function StatsTable({ selector, rows, fwdHeader, revHeader, statsMode, baseline }) {
    if (!rows || rows.length === 0) return null;
    return /* @__PURE__ */ u3("table", { class: "stats-table", children: [
      /* @__PURE__ */ u3("thead", { children: /* @__PURE__ */ u3("tr", { children: [
        /* @__PURE__ */ u3("th", { children: rows[0]._colHeader }),
        /* @__PURE__ */ u3("th", { children: "#" }),
        /* @__PURE__ */ u3("th", { children: fwdHeader }),
        /* @__PURE__ */ u3("th", { children: revHeader })
      ] }) }),
      /* @__PURE__ */ u3("tbody", { children: rows.map((row) => {
        const fwdColor = getStatsCellColor(
          selector,
          row.fwdItemId,
          statsMode,
          baseline
        );
        const revColor = getStatsCellColor(
          selector,
          row.revItemId,
          statsMode,
          baseline
        );
        return /* @__PURE__ */ u3("tr", { children: [
          /* @__PURE__ */ u3("td", { children: row.label }),
          /* @__PURE__ */ u3("td", { children: row.sublabel }),
          /* @__PURE__ */ u3(
            "td",
            {
              class: "stats-cell",
              style: { background: fwdColor }
            }
          ),
          /* @__PURE__ */ u3(
            "td",
            {
              class: "stats-cell",
              style: { background: revColor }
            }
          )
        ] }, row.fwdItemId);
      }) })
    ] });
  }
  function StatsGrid({ selector, colLabels, getItemId, statsMode, notes, baseline }) {
    const noteList = notes || NOTES;
    return /* @__PURE__ */ u3("table", { class: "stats-grid", children: [
      /* @__PURE__ */ u3("thead", { children: /* @__PURE__ */ u3("tr", { children: [
        /* @__PURE__ */ u3("th", {}),
        colLabels.map((c3) => /* @__PURE__ */ u3("th", { children: c3 }, c3))
      ] }) }),
      /* @__PURE__ */ u3("tbody", { children: noteList.map((note) => /* @__PURE__ */ u3("tr", { children: [
        /* @__PURE__ */ u3("td", { class: "stats-grid-row-label", children: displayNote(note.name || note.displayName) }),
        colLabels.map((_3, i3) => {
          const itemId = getItemId(note.name, i3);
          const color = Array.isArray(itemId) ? getStatsCellColorMerged(
            selector,
            itemId,
            statsMode,
            baseline
          ) : getStatsCellColor(selector, itemId, statsMode, baseline);
          const light = heatmapNeedsLightText(color);
          return /* @__PURE__ */ u3(
            "td",
            {
              class: "stats-cell",
              style: {
                background: color,
                color: light ? "white" : void 0
              }
            },
            i3
          );
        })
      ] }, note.name)) })
    ] });
  }
  function StatsToggle({ active, onToggle }) {
    return /* @__PURE__ */ u3("div", { class: "stats-toggle", children: [
      /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "stats-toggle-btn" + (active === "retention" ? " active" : ""),
          "data-mode": "retention",
          onClick: () => onToggle("retention"),
          children: "Recall"
        }
      ),
      /* @__PURE__ */ u3(
        "button",
        {
          type: "button",
          class: "stats-toggle-btn" + (active === "speed" ? " active" : ""),
          "data-mode": "speed",
          onClick: () => onToggle("speed"),
          children: "Speed"
        }
      )
    ] });
  }

  // src/ui/quiz-ui.tsx
  function FeedbackDisplay({ text, className, time, hint }) {
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3("div", { class: className, children: text }),
      time ? /* @__PURE__ */ u3("div", { class: "time-display", children: time }) : null,
      hint ? /* @__PURE__ */ u3("div", { class: "hint", children: hint }) : null
    ] });
  }

  // src/mode-utils.ts
  function buildBidirectionalIds(keys) {
    const ids = [];
    for (let i3 = 0; i3 < keys.length; i3++) {
      ids.push(keys[i3] + ":fwd", keys[i3] + ":rev");
    }
    return ids;
  }
  function buildMathIds(notes, values) {
    const ids = [];
    for (let i3 = 0; i3 < notes.length; i3++) {
      for (let j3 = 0; j3 < values.length; j3++) {
        ids.push(notes[i3] + "+" + values[j3], notes[i3] + "-" + values[j3]);
      }
    }
    return ids;
  }
  function parseMathId(id) {
    const match = id.match(/^([A-Ga-g][#b]?)([+-])(.+)$/);
    if (!match) {
      return { note: id, op: "+", value: "" };
    }
    return {
      note: match[1],
      op: match[2],
      value: match[3]
    };
  }

  // src/modes/note-semitones/logic.ts
  var ALL_ITEMS = buildBidirectionalIds(NOTES.map((n2) => n2.name));
  function getQuestion(itemId) {
    const [noteName, dir] = itemId.split(":");
    const note = NOTES.find((n2) => n2.name === noteName);
    return {
      noteName: note.name,
      noteNum: note.num,
      dir,
      accidentalChoice: pickRandomAccidental(note.displayName)
    };
  }
  function checkAnswer(q3, input) {
    if (q3.dir === "fwd") {
      const correct2 = parseInt(input, 10) === q3.noteNum;
      return { correct: correct2, correctAnswer: String(q3.noteNum) };
    }
    const note = NOTES.find((n2) => n2.name === q3.noteName);
    const correct = noteMatchesInput(note, input);
    return { correct, correctAnswer: displayNote(q3.accidentalChoice) };
  }
  function getStatsRows() {
    return NOTES.map((note) => ({
      label: displayNote(note.name),
      sublabel: String(note.num),
      _colHeader: "Note",
      fwdItemId: note.name + ":fwd",
      revItemId: note.name + ":rev"
    }));
  }

  // src/modes/note-semitones/note-semitones-mode.tsx
  function NoteSemitonesMode({ container, navigateHome, onMount }) {
    const learner = useLearnerModel("noteSemitones", ALL_ITEMS);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const pendingDigitRef = A2(null);
    const pendingTimeoutRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const engineConfig = T2(() => ({
      getEnabledItems: () => ALL_ITEMS,
      checkAnswer: (_itemId, input) => {
        const q3 = currentQRef.current;
        return checkAnswer(q3, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, ctx) => {
        const dir2 = currentQRef.current?.dir;
        if (dir2 === "rev") {
          return noteHandler.handleKey(e3);
        }
        if (e3.key >= "0" && e3.key <= "9") {
          e3.preventDefault();
          const d3 = parseInt(e3.key);
          if (pendingDigitRef.current !== null) {
            const num = pendingDigitRef.current * 10 + d3;
            clearTimeout(pendingTimeoutRef.current);
            pendingDigitRef.current = null;
            pendingTimeoutRef.current = null;
            if (num <= 11) ctx.submitAnswer(String(num));
            return true;
          }
          if (d3 >= 2) {
            ctx.submitAnswer(String(d3));
          } else {
            pendingDigitRef.current = d3;
            pendingTimeoutRef.current = setTimeout(() => {
              if (pendingDigitRef.current !== null) {
                ctx.submitAnswer(String(pendingDigitRef.current));
                pendingDigitRef.current = null;
                pendingTimeoutRef.current = null;
              }
            }, 400);
          }
          return true;
        }
        return false;
      },
      onStart: () => {
        noteHandler.reset();
        if (pendingTimeoutRef.current) clearTimeout(pendingTimeoutRef.current);
        pendingDigitRef.current = null;
      },
      onStop: () => {
        noteHandler.reset();
        if (pendingTimeoutRef.current) clearTimeout(pendingTimeoutRef.current);
        pendingDigitRef.current = null;
      },
      getPracticingLabel: () => "all items"
    }), [noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const round = useRoundSummary(engine, learner, "all items");
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS,
        selector: learner.selector,
        itemNoun: "items",
        recommendation: null,
        recommendationText: "",
        sessionSummary: ALL_ITEMS.length + " items \xB7 60s",
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const dir = currentQ?.dir ?? "fwd";
    const promptText = currentQ ? currentQ.dir === "fwd" ? displayNote(currentQ.accidentalChoice) : String(currentQ.noteNum) : "";
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    const handleNumAnswer = q2(
      (num) => engine.submitAnswer(String(num)),
      [engine.submitAnswer]
    );
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Note \u2194 Semitones", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              sessionSummary: summary.sessionSummary,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              onStart: engine.start
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsTable,
              {
                selector: statsSel,
                rows: getStatsRows(),
                fwdHeader: "N\u2192#",
                revHeader: "#\u2192N",
                statsMode,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: "all items",
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(NoteButtons, { hidden: dir === "fwd", onAnswer: handleNoteAnswer }),
            /* @__PURE__ */ u3(
              NumberButtons,
              {
                start: 0,
                end: 11,
                hidden: dir === "rev",
                onAnswer: handleNumAnswer
              }
            ),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/interval-semitones/logic.ts
  var ALL_ITEMS2 = buildBidirectionalIds(
    INTERVALS.map((i3) => i3.abbrev)
  );
  function getQuestion2(itemId) {
    const [abbrev, dir] = itemId.split(":");
    const interval = INTERVALS.find((i3) => i3.abbrev === abbrev);
    return {
      abbrev: interval.abbrev,
      name: interval.name,
      num: interval.num,
      dir
    };
  }
  function checkAnswer2(q3, input) {
    if (q3.dir === "fwd") {
      const correct2 = parseInt(input, 10) === q3.num;
      return { correct: correct2, correctAnswer: String(q3.num) };
    }
    const interval = INTERVALS.find((i3) => i3.abbrev === q3.abbrev);
    const correct = intervalMatchesInput(interval, input);
    return { correct, correctAnswer: q3.abbrev };
  }
  function getStatsRows2() {
    return INTERVALS.map((interval) => ({
      label: interval.abbrev,
      sublabel: String(interval.num),
      _colHeader: "Interval",
      fwdItemId: interval.abbrev + ":fwd",
      revItemId: interval.abbrev + ":rev"
    }));
  }

  // src/modes/interval-semitones/interval-semitones-mode.tsx
  function IntervalSemitonesMode({ container, navigateHome, onMount }) {
    const learner = useLearnerModel("intervalSemitones", ALL_ITEMS2);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const pendingDigitRef = A2(null);
    const pendingTimeoutRef = A2(null);
    const engineConfig = T2(() => ({
      getEnabledItems: () => ALL_ITEMS2,
      checkAnswer: (_itemId, input) => {
        const q3 = currentQRef.current;
        return checkAnswer2(q3, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion2(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, ctx) => {
        const dir2 = currentQRef.current?.dir;
        if (dir2 === "rev") {
          return false;
        }
        if (e3.key >= "0" && e3.key <= "9") {
          e3.preventDefault();
          const d3 = parseInt(e3.key);
          if (pendingDigitRef.current !== null) {
            const num = pendingDigitRef.current * 10 + d3;
            clearTimeout(pendingTimeoutRef.current);
            pendingDigitRef.current = null;
            pendingTimeoutRef.current = null;
            if (num >= 1 && num <= 12) ctx.submitAnswer(String(num));
            return true;
          }
          if (d3 >= 2 && d3 <= 9) {
            ctx.submitAnswer(String(d3));
          } else {
            pendingDigitRef.current = d3;
            pendingTimeoutRef.current = setTimeout(() => {
              if (pendingDigitRef.current !== null) {
                if (pendingDigitRef.current >= 1) {
                  ctx.submitAnswer(String(pendingDigitRef.current));
                }
                pendingDigitRef.current = null;
                pendingTimeoutRef.current = null;
              }
            }, 400);
          }
          return true;
        }
        return false;
      },
      onStart: () => {
        if (pendingTimeoutRef.current) clearTimeout(pendingTimeoutRef.current);
        pendingDigitRef.current = null;
      },
      onStop: () => {
        if (pendingTimeoutRef.current) clearTimeout(pendingTimeoutRef.current);
        pendingDigitRef.current = null;
      },
      getPracticingLabel: () => "all items"
    }), []);
    const engine = useQuizEngine(engineConfig, learner.selector);
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS2,
        selector: learner.selector,
        itemNoun: "items",
        recommendation: null,
        recommendationText: "",
        sessionSummary: ALL_ITEMS2.length + " items \xB7 60s",
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
        }
      });
    }, [engine, learner]);
    const dir = currentQ?.dir ?? "fwd";
    const promptText = currentQ ? currentQ.dir === "fwd" ? currentQ.name : String(currentQ.num) : "";
    const handleIntervalAnswer = q2(
      (interval) => engine.submitAnswer(interval),
      [engine.submitAnswer]
    );
    const handleNumAnswer = q2(
      (num) => engine.submitAnswer(String(num)),
      [engine.submitAnswer]
    );
    const round = useRoundSummary(engine, learner, "all items");
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Interval \u2194 Semitones", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              sessionSummary: summary.sessionSummary,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              onStart: engine.start
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsTable,
              {
                selector: statsSel,
                rows: getStatsRows2(),
                fwdHeader: "I\u2192#",
                revHeader: "#\u2192I",
                statsMode,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: "all items",
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(
              IntervalButtons,
              {
                hidden: dir === "fwd",
                onAnswer: handleIntervalAnswer
              }
            ),
            /* @__PURE__ */ u3(
              NumberButtons,
              {
                start: 1,
                end: 12,
                hidden: dir === "rev",
                onAnswer: handleNumAnswer
              }
            ),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/recommendations.ts
  function computeRecommendations(selector, allIndices, getItemIds, config, options) {
    const sortUnstarted = options && options.sortUnstarted;
    const recs = selector.getStringRecommendations(allIndices, getItemIds);
    const started = recs.filter((r3) => r3.unseenCount < r3.totalCount);
    const unstarted = recs.filter((r3) => r3.unseenCount === r3.totalCount);
    if (started.length === 0) {
      if (unstarted.length > 0) {
        const sorted = sortUnstarted ? [...unstarted].sort(sortUnstarted) : unstarted;
        const first = sorted[0];
        return {
          recommended: /* @__PURE__ */ new Set([first.string]),
          enabled: /* @__PURE__ */ new Set([first.string]),
          consolidateIndices: [],
          consolidateDueCount: 0,
          expandIndex: first.string,
          expandNewCount: first.totalCount
        };
      }
      return {
        recommended: /* @__PURE__ */ new Set(),
        enabled: null,
        consolidateIndices: [],
        consolidateDueCount: 0,
        expandIndex: null,
        expandNewCount: 0
      };
    }
    const totalSeen = started.reduce(
      (sum, r3) => sum + (r3.masteredCount + r3.dueCount),
      0
    );
    const totalMastered = started.reduce((sum, r3) => sum + r3.masteredCount, 0);
    const consolidatedRatio = totalSeen > 0 ? totalMastered / totalSeen : 0;
    const startedByWork = [...started].sort(
      (a3, b) => b.dueCount + b.unseenCount - (a3.dueCount + a3.unseenCount)
    );
    const workCounts = startedByWork.map((r3) => r3.dueCount + r3.unseenCount);
    const medianWork = workCounts[Math.floor(workCounts.length / 2)];
    const recommended = /* @__PURE__ */ new Set();
    const enabled = /* @__PURE__ */ new Set();
    const consolidateIndices = [];
    let consolidateDueCount = 0;
    for (const r3 of startedByWork) {
      if (r3.dueCount + r3.unseenCount > medianWork) {
        recommended.add(r3.string);
        enabled.add(r3.string);
        consolidateIndices.push(r3.string);
        consolidateDueCount += r3.dueCount + r3.unseenCount;
      }
    }
    if (enabled.size === 0) {
      const r3 = startedByWork[0];
      recommended.add(r3.string);
      enabled.add(r3.string);
      consolidateIndices.push(r3.string);
      consolidateDueCount += r3.dueCount + r3.unseenCount;
    }
    let expandIndex = null;
    let expandNewCount = 0;
    if (consolidatedRatio >= config.expansionThreshold && unstarted.length > 0) {
      const sorted = sortUnstarted ? [...unstarted].sort(sortUnstarted) : unstarted;
      expandIndex = sorted[0].string;
      expandNewCount = sorted[0].totalCount;
      recommended.add(expandIndex);
      enabled.add(expandIndex);
    }
    return {
      recommended,
      enabled,
      consolidateIndices,
      consolidateDueCount,
      expandIndex,
      expandNewCount
    };
  }

  // src/hooks/use-scope-state.ts
  function loadScope(spec) {
    if (spec.kind === "none") return { kind: "none" };
    if (spec.kind === "groups") {
      let enabled = new Set(spec.defaultEnabled);
      const saved = localStorage.getItem(spec.storageKey);
      if (saved) {
        try {
          enabled = new Set(JSON.parse(saved));
        } catch (_3) {
        }
      }
      return { kind: "groups", enabledGroups: enabled };
    }
    if (spec.kind === "fretboard") {
      const inst = spec.instrument;
      let enabledStrings = /* @__PURE__ */ new Set([inst.defaultString]);
      const saved = localStorage.getItem(
        inst.storageNamespace + "_enabledStrings"
      );
      if (saved) {
        try {
          enabledStrings = new Set(JSON.parse(saved));
        } catch (_3) {
        }
      }
      let noteFilter = "natural";
      const savedFilter = localStorage.getItem(
        inst.storageNamespace + "_noteFilter"
      );
      if (savedFilter === "natural" || savedFilter === "sharps-flats" || savedFilter === "all") {
        noteFilter = savedFilter;
      }
      return { kind: "fretboard", enabledStrings, noteFilter };
    }
    if (spec.kind === "note-filter") {
      let noteFilter = "natural";
      const saved = localStorage.getItem(spec.storageKey);
      if (saved === "natural" || saved === "sharps-flats" || saved === "all") {
        noteFilter = saved;
      }
      return { kind: "note-filter", noteFilter };
    }
    return { kind: "none" };
  }
  function saveScope(spec, scope) {
    if (spec.kind === "groups" && scope.kind === "groups") {
      localStorage.setItem(
        spec.storageKey,
        JSON.stringify([...scope.enabledGroups])
      );
    } else if (spec.kind === "fretboard" && scope.kind === "fretboard") {
      const inst = spec.instrument;
      localStorage.setItem(
        inst.storageNamespace + "_enabledStrings",
        JSON.stringify([...scope.enabledStrings])
      );
      try {
        localStorage.setItem(
          inst.storageNamespace + "_noteFilter",
          scope.noteFilter
        );
      } catch (_3) {
      }
    } else if (spec.kind === "note-filter" && scope.kind === "note-filter") {
      try {
        localStorage.setItem(spec.storageKey, scope.noteFilter);
      } catch (_3) {
      }
    }
  }
  function useScopeState(spec) {
    const [scope, setScopeRaw] = d2(() => loadScope(spec));
    const setScope = q2((next) => {
      setScopeRaw(next);
      saveScope(spec, next);
    }, [spec]);
    const toggleGroup = q2((index) => {
      setScopeRaw((prev) => {
        if (prev.kind !== "groups") return prev;
        const next = new Set(prev.enabledGroups);
        if (next.has(index)) {
          if (next.size > 1) next.delete(index);
        } else {
          next.add(index);
        }
        const updated = { kind: "groups", enabledGroups: next };
        saveScope(spec, updated);
        return updated;
      });
    }, [spec]);
    const toggleString = q2((index) => {
      setScopeRaw((prev) => {
        if (prev.kind !== "fretboard") return prev;
        const next = new Set(prev.enabledStrings);
        if (next.has(index)) {
          if (next.size > 1) next.delete(index);
        } else {
          next.add(index);
        }
        const updated = {
          kind: "fretboard",
          enabledStrings: next,
          noteFilter: prev.noteFilter
        };
        saveScope(spec, updated);
        return updated;
      });
    }, [spec]);
    const setNoteFilter = q2((filter) => {
      setScopeRaw((prev) => {
        if (prev.kind === "fretboard") {
          const updated = {
            kind: "fretboard",
            enabledStrings: prev.enabledStrings,
            noteFilter: filter
          };
          saveScope(spec, updated);
          return updated;
        }
        if (prev.kind === "note-filter") {
          const updated = { kind: "note-filter", noteFilter: filter };
          saveScope(spec, updated);
          return updated;
        }
        return prev;
      });
    }, [spec]);
    return [scope, { toggleGroup, toggleString, setNoteFilter, setScope }];
  }

  // src/ui/scope.tsx
  function GroupToggles({ labels, active, recommended, onToggle }) {
    return /* @__PURE__ */ u3("div", { class: "toggle-group", children: [
      /* @__PURE__ */ u3("span", { class: "toggle-group-label", children: "Groups" }),
      /* @__PURE__ */ u3("div", { class: "distance-toggles", children: labels.map((label, i3) => {
        let cls = "distance-toggle";
        if (active.has(i3)) cls += " active";
        if (recommended === i3) cls += " recommended";
        return /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: cls,
            "data-group": String(i3),
            onClick: () => onToggle(i3),
            children: label
          },
          i3
        );
      }) })
    ] });
  }
  function StringToggles({ stringNames, active, recommended, onToggle }) {
    return /* @__PURE__ */ u3("div", { class: "toggle-group", children: [
      /* @__PURE__ */ u3("span", { class: "toggle-group-label", children: "Strings" }),
      /* @__PURE__ */ u3("div", { class: "string-toggles", children: stringNames.map((name, i3) => {
        let cls = "string-toggle";
        if (active.has(i3)) cls += " active";
        if (recommended === i3) cls += " recommended";
        return /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: cls,
            "data-string": String(i3),
            "data-string-note": name,
            onClick: () => onToggle(i3),
            children: name
          },
          i3
        );
      }) })
    ] });
  }
  function NoteFilter({ mode, onChange }) {
    const naturalActive = mode === "natural" || mode === "all";
    const accActive = mode === "sharps-flats" || mode === "all";
    function toggle(which) {
      if (which === "natural") {
        if (naturalActive && accActive) onChange("sharps-flats");
        else if (!naturalActive) onChange(accActive ? "all" : "natural");
      } else {
        if (accActive && naturalActive) onChange("natural");
        else if (!accActive) onChange(naturalActive ? "all" : "sharps-flats");
      }
    }
    return /* @__PURE__ */ u3("div", { class: "toggle-group", children: [
      /* @__PURE__ */ u3("span", { class: "toggle-group-label", children: "Notes" }),
      /* @__PURE__ */ u3("div", { class: "notes-toggles", children: [
        /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: "notes-toggle" + (naturalActive ? " active" : ""),
            "data-notes": "natural",
            onClick: () => toggle("natural"),
            children: "natural"
          }
        ),
        /* @__PURE__ */ u3(
          "button",
          {
            type: "button",
            class: "notes-toggle" + (accActive ? " active" : ""),
            "data-notes": "sharps-flats",
            onClick: () => toggle("sharps-flats"),
            children: "sharps & flats"
          }
        )
      ] })
    ] });
  }

  // src/modes/semitone-math/logic.ts
  var DISTANCE_GROUPS = [
    { distances: [1, 2], label: "\xB11\u20132" },
    { distances: [3, 4], label: "\xB13\u20134" },
    { distances: [5, 6], label: "\xB15\u20136" },
    { distances: [7, 8], label: "\xB17\u20138" },
    { distances: [9, 10], label: "\xB19\u201310" },
    { distances: [11], label: "\xB111" }
  ];
  function getItemIdsForGroup(groupIndex) {
    const distances = DISTANCE_GROUPS[groupIndex].distances;
    const items = [];
    for (const note of NOTES) {
      for (const d3 of distances) {
        items.push(note.name + "+" + d3);
        items.push(note.name + "-" + d3);
      }
    }
    return items;
  }
  var ALL_ITEMS3 = buildMathIds(
    NOTES.map((n2) => n2.name),
    Array.from({ length: 11 }, (_3, i3) => i3 + 1)
  );
  var ALL_GROUP_INDICES = DISTANCE_GROUPS.map((_3, i3) => i3);
  function getQuestion3(itemId) {
    const parsed = parseMathId(itemId);
    const noteName = parsed.note;
    const op = parsed.op;
    const semitones = parseInt(parsed.value);
    const note = NOTES.find((n2) => n2.name === noteName);
    const answer = op === "+" ? noteAdd(note.num, semitones) : noteSub(note.num, semitones);
    const useFlats = op === "-";
    const promptNoteName = displayNote(
      pickAccidentalName(note.displayName, useFlats)
    );
    return {
      note,
      op,
      semitones,
      answer,
      useFlats,
      promptText: promptNoteName + " " + op + " " + semitones
    };
  }
  function checkAnswer3(q3, input) {
    const correct = noteMatchesInput(q3.answer, input);
    return {
      correct,
      correctAnswer: displayNote(
        pickAccidentalName(q3.answer.displayName, q3.useFlats)
      )
    };
  }
  var GRID_COL_LABELS = Array.from(
    { length: 11 },
    (_3, i3) => String(i3 + 1)
  );
  function getGridItemId(noteName, colIdx) {
    const n2 = colIdx + 1;
    return [noteName + "+" + n2, noteName + "-" + n2];
  }

  // src/modes/semitone-math/semitone-math-mode.tsx
  function SemitoneMathMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: DISTANCE_GROUPS.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup(i3)
      })),
      defaultEnabled: [0],
      storageKey: "semitoneMath_enabledGroups",
      label: "Distances",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
    const learner = useLearnerModel("semitoneMath", ALL_ITEMS3);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup(g2));
      }
      return items;
    }, [enabledGroups]);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES,
        getItemIdsForGroup,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => DISTANCE_GROUPS[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === DISTANCE_GROUPS.length) return "all distances";
      const labels = [...enabledGroups].sort((a3, b) => a3 - b).map((g2) => DISTANCE_GROUPS[g2].label);
      return labels.join(", ") + " semitones";
    }, [enabledGroups]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup(g2));
        }
        return items;
      },
      checkAnswer: (_itemId, input) => {
        const q3 = currentQRef.current;
        return checkAnswer3(q3, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion3(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, _ctx) => {
        return noteHandler.handleKey(e3);
      },
      onStart: () => {
        noteHandler.reset();
      },
      onStop: () => {
        noteHandler.reset();
      },
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        if (groups.size === DISTANCE_GROUPS.length) return "all distances";
        const labels = [...groups].sort((a3, b) => a3 - b).map((g2) => DISTANCE_GROUPS[g2].label);
        return labels.join(", ") + " semitones";
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS3,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const promptText = currentQ?.promptText ?? "";
    const useFlats = currentQ?.useFlats;
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    const round = useRoundSummary(engine, learner, practicingLabel);
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Semitone Math", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: DISTANCE_GROUPS.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsGrid,
              {
                selector: statsSel,
                colLabels: GRID_COL_LABELS,
                getItemId: getGridItemId,
                statsMode,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(NoteButtons, { onAnswer: handleNoteAnswer, useFlats }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/interval-math/logic.ts
  var MATH_INTERVALS = INTERVALS.filter(
    (i3) => i3.num >= 1 && i3.num <= 11
  );
  var DISTANCE_GROUPS2 = [
    { distances: [1, 2], label: "m2 M2" },
    { distances: [3, 4], label: "m3 M3" },
    { distances: [5, 6], label: "P4 TT" },
    { distances: [7, 8], label: "P5 m6" },
    { distances: [9, 10], label: "M6 m7" },
    { distances: [11], label: "M7" }
  ];
  function getItemIdsForGroup2(groupIndex) {
    const distances = DISTANCE_GROUPS2[groupIndex].distances;
    const intervals = MATH_INTERVALS.filter((i3) => distances.includes(i3.num));
    const items = [];
    for (const note of NOTES) {
      for (const interval of intervals) {
        items.push(note.name + "+" + interval.abbrev);
        items.push(note.name + "-" + interval.abbrev);
      }
    }
    return items;
  }
  var ALL_ITEMS4 = buildMathIds(
    NOTES.map((n2) => n2.name),
    MATH_INTERVALS.map((i3) => i3.abbrev)
  );
  var ALL_GROUP_INDICES2 = DISTANCE_GROUPS2.map((_3, i3) => i3);
  function getQuestion4(itemId) {
    const parsed = parseMathId(itemId);
    const noteName = parsed.note;
    const op = parsed.op;
    const abbrev = parsed.value;
    const note = NOTES.find((n2) => n2.name === noteName);
    const interval = MATH_INTERVALS.find((i3) => i3.abbrev === abbrev);
    const answer = op === "+" ? noteAdd(note.num, interval.num) : noteSub(note.num, interval.num);
    const useFlats = op === "-";
    const promptNoteName = displayNote(
      pickAccidentalName(note.displayName, useFlats)
    );
    return {
      note,
      op,
      interval,
      answer,
      useFlats,
      promptText: promptNoteName + " " + op + " " + interval.abbrev
    };
  }
  function checkAnswer4(q3, input) {
    const correct = noteMatchesInput(q3.answer, input);
    return {
      correct,
      correctAnswer: displayNote(
        pickAccidentalName(q3.answer.displayName, q3.useFlats)
      )
    };
  }
  var GRID_COL_LABELS2 = MATH_INTERVALS.map((i3) => i3.abbrev);
  function getGridItemId2(noteName, colIdx) {
    const abbrev = MATH_INTERVALS[colIdx].abbrev;
    return [noteName + "+" + abbrev, noteName + "-" + abbrev];
  }

  // src/modes/interval-math/interval-math-mode.tsx
  function IntervalMathMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: DISTANCE_GROUPS2.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup2(i3)
      })),
      defaultEnabled: [0],
      storageKey: "intervalMath_enabledGroups",
      label: "Intervals",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
    const learner = useLearnerModel("intervalMath", ALL_ITEMS4);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup2(g2));
      }
      return items;
    }, [enabledGroups]);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES2,
        getItemIdsForGroup2,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => DISTANCE_GROUPS2[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === DISTANCE_GROUPS2.length) return "all intervals";
      const labels = [...enabledGroups].sort((a3, b) => a3 - b).map((g2) => DISTANCE_GROUPS2[g2].label);
      return labels.join(", ") + " intervals";
    }, [enabledGroups]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup2(g2));
        }
        return items;
      },
      checkAnswer: (_itemId, input) => {
        const q3 = currentQRef.current;
        return checkAnswer4(q3, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion4(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, _ctx) => {
        return noteHandler.handleKey(e3);
      },
      onStart: () => {
        noteHandler.reset();
      },
      onStop: () => {
        noteHandler.reset();
      },
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        if (groups.size === DISTANCE_GROUPS2.length) return "all intervals";
        const labels = [...groups].sort((a3, b) => a3 - b).map((g2) => DISTANCE_GROUPS2[g2].label);
        return labels.join(", ") + " intervals";
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const round = useRoundSummary(engine, learner, practicingLabel);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS4,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const promptText = currentQ?.promptText ?? "";
    const useFlats = currentQ?.useFlats;
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Interval Math", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: DISTANCE_GROUPS2.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsGrid,
              {
                selector: statsSel,
                colLabels: GRID_COL_LABELS2,
                getItemId: getGridItemId2,
                statsMode,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(NoteButtons, { onAnswer: handleNoteAnswer, useFlats }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/key-signatures/logic.ts
  var KEY_GROUPS = [
    { keys: ["C", "G", "F"], label: "C G F" },
    { keys: ["D", "Bb"], label: "D B\u266D" },
    { keys: ["A", "Eb"], label: "A E\u266D" },
    { keys: ["E", "Ab"], label: "E A\u266D" },
    { keys: ["B", "Db", "F#"], label: "B D\u266D F\u266F" }
  ];
  function getItemIdsForGroup3(groupIndex) {
    const roots = KEY_GROUPS[groupIndex].keys;
    const items = [];
    for (const root of roots) {
      items.push(root + ":fwd");
      items.push(root + ":rev");
    }
    return items;
  }
  var ALL_ITEMS5 = [];
  for (const key of MAJOR_KEYS) {
    ALL_ITEMS5.push(key.root + ":fwd");
    ALL_ITEMS5.push(key.root + ":rev");
  }
  var ALL_GROUP_INDICES3 = KEY_GROUPS.map((_3, i3) => i3);
  function getQuestion5(itemId) {
    const [rootName, dir] = itemId.split(":");
    const key = MAJOR_KEYS.find((k3) => k3.root === rootName);
    return {
      root: key.root,
      dir,
      sigLabel: keySignatureLabel(key)
    };
  }
  function checkAnswer5(q3, input) {
    const key = MAJOR_KEYS.find((k3) => k3.root === q3.root);
    if (q3.dir === "fwd") {
      const expected = keySignatureLabel(key);
      return { correct: input === expected, correctAnswer: expected };
    }
    const correct = spelledNoteMatchesSemitone(q3.root, input);
    return { correct, correctAnswer: displayNote(q3.root) };
  }
  function getStatsRows3() {
    return MAJOR_KEYS.map((key) => ({
      label: displayNote(key.root) + " major",
      sublabel: keySignatureLabel(key),
      _colHeader: "Key",
      fwdItemId: key.root + ":fwd",
      revItemId: key.root + ":rev"
    }));
  }

  // src/modes/key-signatures/key-signatures-mode.tsx
  function KeySignaturesMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: KEY_GROUPS.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup3(i3)
      })),
      defaultEnabled: [0, 1],
      storageKey: "keySignatures_enabledGroups",
      label: "Keys",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0, 1]);
    const learner = useLearnerModel("keySignatures", ALL_ITEMS5);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup3(g2));
      }
      return items;
    }, [enabledGroups]);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const pendingSigDigitRef = A2(null);
    const pendingSigTimeoutRef = A2(
      null
    );
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES3,
        getItemIdsForGroup3,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => KEY_GROUPS[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === KEY_GROUPS.length) return "all keys";
      const keys = [...enabledGroups].sort((a3, b) => a3 - b).flatMap((g2) => KEY_GROUPS[g2].keys).map((k3) => displayNote(k3));
      return keys.join(", ");
    }, [enabledGroups]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0, 1]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup3(g2));
        }
        return items;
      },
      checkAnswer: (_itemId, input) => {
        const q3 = currentQRef.current;
        return checkAnswer5(q3, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion5(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, ctx) => {
        const dir2 = currentQRef.current?.dir;
        if (dir2 === "rev") {
          return noteHandler.handleKey(e3);
        }
        if (e3.key >= "0" && e3.key <= "7") {
          e3.preventDefault();
          if (pendingSigTimeoutRef.current) {
            clearTimeout(pendingSigTimeoutRef.current);
          }
          pendingSigDigitRef.current = e3.key;
          pendingSigTimeoutRef.current = setTimeout(() => {
            if (pendingSigDigitRef.current === "0") {
              ctx.submitAnswer("0");
            }
            pendingSigDigitRef.current = null;
            pendingSigTimeoutRef.current = null;
          }, 600);
          return true;
        }
        if (pendingSigDigitRef.current !== null && (e3.key === "#" || e3.key === "b")) {
          e3.preventDefault();
          clearTimeout(pendingSigTimeoutRef.current);
          const answer = pendingSigDigitRef.current + e3.key;
          pendingSigDigitRef.current = null;
          pendingSigTimeoutRef.current = null;
          ctx.submitAnswer(answer);
          return true;
        }
        return false;
      },
      onStart: () => {
        noteHandler.reset();
        if (pendingSigTimeoutRef.current) {
          clearTimeout(pendingSigTimeoutRef.current);
        }
        pendingSigDigitRef.current = null;
      },
      onStop: () => {
        noteHandler.reset();
        if (pendingSigTimeoutRef.current) {
          clearTimeout(pendingSigTimeoutRef.current);
        }
        pendingSigDigitRef.current = null;
      },
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0, 1]);
        if (groups.size === KEY_GROUPS.length) return "all keys";
        const keys = [...groups].sort((a3, b) => a3 - b).flatMap((g2) => KEY_GROUPS[g2].keys).map((k3) => displayNote(k3));
        return keys.join(", ");
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const round = useRoundSummary(engine, learner, practicingLabel);
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS5,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
          if (pendingSigTimeoutRef.current) {
            clearTimeout(pendingSigTimeoutRef.current);
          }
          pendingSigDigitRef.current = null;
        }
      });
    }, [engine, learner, noteHandler]);
    const dir = currentQ?.dir ?? "fwd";
    const promptText = currentQ ? currentQ.dir === "fwd" ? displayNote(currentQ.root) + " major" : currentQ.sigLabel + " major" : "";
    const handleSigAnswer = q2(
      (sig) => engine.submitAnswer(sig),
      [engine.submitAnswer]
    );
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Key Signatures", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: KEY_GROUPS.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsTable,
              {
                selector: statsSel,
                rows: getStatsRows3(),
                fwdHeader: "Key\u2192Sig",
                revHeader: "Sig\u2192Key",
                statsMode,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(KeysigButtons, { hidden: dir === "rev", onAnswer: handleSigAnswer }),
            /* @__PURE__ */ u3(NoteButtons, { hidden: dir === "fwd", onAnswer: handleNoteAnswer }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/scale-degrees/logic.ts
  var DEGREE_LABELS = ["1st", "2nd", "3rd", "4th", "5th", "6th", "7th"];
  var DEGREE_GROUPS = [
    { degrees: [1, 5], label: "1st,5th" },
    { degrees: [4], label: "4th" },
    { degrees: [3, 7], label: "3rd,7th" },
    { degrees: [2, 6], label: "2nd,6th" }
  ];
  function getItemIdsForGroup4(groupIndex) {
    const degrees = DEGREE_GROUPS[groupIndex].degrees;
    const items = [];
    for (const key of MAJOR_KEYS) {
      for (const d3 of degrees) {
        items.push(key.root + ":" + d3 + ":fwd");
        items.push(key.root + ":" + d3 + ":rev");
      }
    }
    return items;
  }
  var ALL_ITEMS6 = [];
  for (const key of MAJOR_KEYS) {
    for (let d3 = 1; d3 <= 7; d3++) {
      ALL_ITEMS6.push(key.root + ":" + d3 + ":fwd");
      ALL_ITEMS6.push(key.root + ":" + d3 + ":rev");
    }
  }
  var ALL_GROUP_INDICES4 = DEGREE_GROUPS.map((_3, i3) => i3);
  var GRID_NOTES = MAJOR_KEYS.map((k3) => ({
    name: k3.root,
    displayName: k3.root
  }));
  function getQuestion6(itemId) {
    const parts = itemId.split(":");
    const keyRoot = parts[0];
    const degree = parseInt(parts[1]);
    const dir = parts[2];
    const noteName = getScaleDegreeNote(keyRoot, degree);
    return { keyRoot, degree, dir, noteName };
  }
  function checkAnswer6(q3, input) {
    if (q3.dir === "fwd") {
      const correct = spelledNoteMatchesSemitone(q3.noteName, input);
      return { correct, correctAnswer: displayNote(q3.noteName) };
    }
    const expectedDegree = String(q3.degree);
    return {
      correct: input === expectedDegree,
      correctAnswer: DEGREE_LABELS[q3.degree - 1]
    };
  }
  function getGridItemId3(keyRoot, colIdx) {
    const d3 = colIdx + 1;
    return [keyRoot + ":" + d3 + ":fwd", keyRoot + ":" + d3 + ":rev"];
  }

  // src/modes/scale-degrees/scale-degrees-mode.tsx
  function ScaleDegreesMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: DEGREE_GROUPS.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup4(i3)
      })),
      defaultEnabled: [0],
      storageKey: "scaleDegrees_enabledGroups",
      label: "Degrees",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
    const learner = useLearnerModel("scaleDegrees", ALL_ITEMS6);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup4(g2));
      }
      return items;
    }, [enabledGroups]);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES4,
        getItemIdsForGroup4,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => DEGREE_GROUPS[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === DEGREE_GROUPS.length) return "all degrees";
      const degrees = [...enabledGroups].sort((a3, b) => a3 - b).flatMap((g2) => DEGREE_GROUPS[g2].degrees).sort((a3, b) => a3 - b);
      return degrees.map((d3) => DEGREE_LABELS[d3 - 1]).join(", ") + " degrees";
    }, [enabledGroups]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup4(g2));
        }
        return items;
      },
      checkAnswer: (_itemId, input) => {
        return checkAnswer6(currentQRef.current, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion6(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, _ctx) => {
        const dir2 = currentQRef.current?.dir;
        if (dir2 === "fwd") {
          return noteHandler.handleKey(e3);
        }
        if (e3.key >= "1" && e3.key <= "7") {
          e3.preventDefault();
          engineSubmitRef.current(e3.key);
          return true;
        }
        return false;
      },
      onStart: () => noteHandler.reset(),
      onStop: () => noteHandler.reset(),
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        if (groups.size === DEGREE_GROUPS.length) return "all degrees";
        const degrees = [...groups].sort((a3, b) => a3 - b).flatMap((g2) => DEGREE_GROUPS[g2].degrees).sort((a3, b) => a3 - b);
        return degrees.map((d3) => DEGREE_LABELS[d3 - 1]).join(", ") + " degrees";
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS6,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const dir = currentQ?.dir ?? "fwd";
    const promptText = currentQ ? currentQ.dir === "fwd" ? DEGREE_LABELS[currentQ.degree - 1] + " of " + displayNote(currentQ.keyRoot) + " major" : displayNote(currentQ.keyRoot) + " major: " + displayNote(currentQ.noteName) : "";
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    const handleDegreeAnswer = q2(
      (degree) => engine.submitAnswer(degree),
      [engine.submitAnswer]
    );
    const round = useRoundSummary(engine, learner, practicingLabel);
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Scale Degrees", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: DEGREE_GROUPS.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsGrid,
              {
                selector: statsSel,
                colLabels: DEGREE_LABELS,
                getItemId: getGridItemId3,
                statsMode,
                notes: GRID_NOTES,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(NoteButtons, { hidden: dir === "rev", onAnswer: handleNoteAnswer }),
            /* @__PURE__ */ u3(DegreeButtons, { hidden: dir === "fwd", onAnswer: handleDegreeAnswer }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/diatonic-chords/logic.ts
  var CHORD_GROUPS = [
    { degrees: [1, 4, 5], label: "I,IV,V" },
    { degrees: [2, 6], label: "ii,vi" },
    { degrees: [3, 7], label: "iii,vii\xB0" }
    // \u00B0 = ° (degree sign)
  ];
  function getItemIdsForGroup5(groupIndex) {
    const degrees = CHORD_GROUPS[groupIndex].degrees;
    const items = [];
    for (const key of MAJOR_KEYS) {
      for (const d3 of degrees) {
        items.push(key.root + ":" + d3 + ":fwd");
        items.push(key.root + ":" + d3 + ":rev");
      }
    }
    return items;
  }
  var ALL_ITEMS7 = [];
  for (const key of MAJOR_KEYS) {
    for (let d3 = 1; d3 <= 7; d3++) {
      ALL_ITEMS7.push(key.root + ":" + d3 + ":fwd");
      ALL_ITEMS7.push(key.root + ":" + d3 + ":rev");
    }
  }
  var ALL_GROUP_INDICES5 = CHORD_GROUPS.map((_3, i3) => i3);
  var GRID_NOTES2 = MAJOR_KEYS.map((k3) => ({
    name: k3.root,
    displayName: k3.root
  }));
  function getQuestion7(itemId) {
    const parts = itemId.split(":");
    const keyRoot = parts[0];
    const degree = parseInt(parts[1]);
    const dir = parts[2];
    const chord = DIATONIC_CHORDS[degree - 1];
    const rootNote = getScaleDegreeNote(keyRoot, degree);
    return { keyRoot, degree, chord, dir, rootNote };
  }
  function checkAnswer7(q3, input) {
    if (q3.dir === "fwd") {
      const correct = spelledNoteMatchesSemitone(q3.rootNote, input);
      const fullAnswer = displayNote(q3.rootNote) + " " + q3.chord.quality;
      return { correct, correctAnswer: fullAnswer };
    }
    const expectedNumeral = q3.chord.numeral;
    return {
      correct: input === expectedNumeral,
      correctAnswer: expectedNumeral
    };
  }
  function getGridItemId4(keyRoot, colIdx) {
    const d3 = colIdx + 1;
    return [keyRoot + ":" + d3 + ":fwd", keyRoot + ":" + d3 + ":rev"];
  }

  // src/modes/diatonic-chords/diatonic-chords-mode.tsx
  function DiatonicChordsMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: CHORD_GROUPS.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup5(i3)
      })),
      defaultEnabled: [0],
      storageKey: "diatonicChords_enabledGroups",
      label: "Chords",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
    const learner = useLearnerModel("diatonicChords", ALL_ITEMS7);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup5(g2));
      }
      return items;
    }, [enabledGroups]);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES5,
        getItemIdsForGroup5,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => CHORD_GROUPS[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === CHORD_GROUPS.length) return "all chords";
      const numerals = [...enabledGroups].sort((a3, b) => a3 - b).flatMap((g2) => CHORD_GROUPS[g2].degrees).sort((a3, b) => a3 - b).map((d3) => ROMAN_NUMERALS[d3 - 1]);
      return numerals.join(", ") + " chords";
    }, [enabledGroups]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup5(g2));
        }
        return items;
      },
      checkAnswer: (_itemId, input) => {
        return checkAnswer7(currentQRef.current, input);
      },
      onPresent: (itemId) => {
        const q3 = getQuestion7(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
      },
      handleKey: (e3, _ctx) => {
        const dir2 = currentQRef.current?.dir;
        if (dir2 === "fwd") {
          return noteHandler.handleKey(e3);
        }
        if (e3.key >= "1" && e3.key <= "7") {
          e3.preventDefault();
          engineSubmitRef.current(ROMAN_NUMERALS[parseInt(e3.key) - 1]);
          return true;
        }
        return false;
      },
      onStart: () => noteHandler.reset(),
      onStop: () => noteHandler.reset(),
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        if (groups.size === CHORD_GROUPS.length) return "all chords";
        const numerals = [...groups].sort((a3, b) => a3 - b).flatMap((g2) => CHORD_GROUPS[g2].degrees).sort((a3, b) => a3 - b).map((d3) => ROMAN_NUMERALS[d3 - 1]);
        return numerals.join(", ") + " chords";
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS7,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const dir = currentQ?.dir ?? "fwd";
    const promptText = currentQ ? currentQ.dir === "fwd" ? currentQ.chord.numeral + " in " + displayNote(currentQ.keyRoot) + " major" : displayNote(currentQ.rootNote) + currentQ.chord.qualityLabel + " in " + displayNote(currentQ.keyRoot) + " major" : "";
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    const handleNumeralAnswer = q2(
      (numeral) => engine.submitAnswer(numeral),
      [engine.submitAnswer]
    );
    const round = useRoundSummary(engine, learner, practicingLabel);
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Diatonic Chords", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: CHORD_GROUPS.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsGrid,
              {
                selector: statsSel,
                colLabels: ROMAN_NUMERALS,
                getItemId: getGridItemId4,
                statsMode,
                notes: GRID_NOTES2,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(NoteButtons, { hidden: dir === "rev", onAnswer: handleNoteAnswer }),
            /* @__PURE__ */ u3(
              NumeralButtons,
              {
                hidden: dir === "fwd",
                onAnswer: handleNumeralAnswer
              }
            ),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/chord-spelling/logic.ts
  function buildGroups() {
    let maxGroup = 0;
    for (const ct of CHORD_TYPES) {
      if (ct.group > maxGroup) maxGroup = ct.group;
    }
    const result = [];
    for (let g2 = 0; g2 <= maxGroup; g2++) {
      const types = CHORD_TYPES.filter((t3) => t3.group === g2);
      const label = types.map((t3) => t3.symbol || "maj").join(", ");
      result.push({ types, label });
    }
    return result;
  }
  var SPELLING_GROUPS = buildGroups();
  function getItemIdsForGroup6(groupIndex) {
    const types = SPELLING_GROUPS[groupIndex].types;
    const items = [];
    for (const root of CHORD_ROOTS) {
      for (const type of types) {
        items.push(root + ":" + type.name);
      }
    }
    return items;
  }
  var ALL_ITEMS8 = [];
  for (const root of CHORD_ROOTS) {
    for (const type of CHORD_TYPES) {
      ALL_ITEMS8.push(root + ":" + type.name);
    }
  }
  var ALL_GROUP_INDICES6 = SPELLING_GROUPS.map((_3, i3) => i3);
  var GRID_NOTES3 = CHORD_ROOTS.map((r3) => ({
    name: r3,
    displayName: r3
  }));
  var GRID_COL_LABELS3 = CHORD_TYPES.map((t3) => t3.symbol || "maj");
  function parseItem(itemId) {
    const colonIdx = itemId.indexOf(":");
    const rootName = itemId.substring(0, colonIdx);
    const typeName = itemId.substring(colonIdx + 1);
    const chordType = CHORD_TYPES.find((t3) => t3.name === typeName);
    const tones = getChordTones(rootName, chordType);
    return { rootName, chordType, tones };
  }
  function initSequentialState(itemId) {
    const item = parseItem(itemId);
    return { expectedCount: item.tones.length, entries: [] };
  }
  function handleInput(itemId, input, state) {
    const item = parseItem(itemId);
    const idx = state.entries.length;
    if (idx >= item.tones.length) {
      const allCorrect = state.entries.every((e3) => e3.correct);
      return {
        status: "complete",
        correct: allCorrect,
        correctAnswer: item.tones.map(displayNote).join(" ")
      };
    }
    const expected = item.tones[idx];
    if (spelledNoteMatchesSemitone(expected, input)) {
      input = expected;
    }
    const isCorrect = spelledNoteMatchesInput(expected, input);
    const entries = [
      ...state.entries,
      {
        input,
        display: isCorrect ? displayNote(expected) : displayNote(input),
        correct: isCorrect
      }
    ];
    const newState = {
      expectedCount: item.tones.length,
      entries
    };
    if (entries.length === item.tones.length) {
      const allCorrect = entries.every((e3) => e3.correct);
      return {
        status: "complete",
        correct: allCorrect,
        correctAnswer: item.tones.map(displayNote).join(" ")
      };
    }
    return { status: "continue", state: newState };
  }
  function checkAnswer8(itemId, input) {
    const allCorrect = input === "__correct__";
    const item = parseItem(itemId);
    const correctAnswer = item.tones.map(displayNote).join(" ");
    return { correct: allCorrect, correctAnswer };
  }
  function getGridItemId5(rootName, colIdx) {
    return rootName + ":" + CHORD_TYPES[colIdx].name;
  }

  // src/modes/chord-spelling/chord-spelling-mode.tsx
  function ChordSlots({ state }) {
    if (!state) return /* @__PURE__ */ u3("div", { class: "chord-slots" });
    return /* @__PURE__ */ u3("div", { class: "chord-slots", children: Array.from({ length: state.expectedCount }, (_3, i3) => {
      let cls = "chord-slot";
      let content = "_";
      if (i3 < state.entries.length) {
        content = state.entries[i3].display;
        cls += state.entries[i3].correct ? " correct" : " wrong";
      } else if (i3 === state.entries.length) {
        cls += " active";
      }
      return /* @__PURE__ */ u3("span", { class: cls, children: content }, i3);
    }) });
  }
  function ChordSpellingMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "groups",
      groups: SPELLING_GROUPS.map((g2, i3) => ({
        index: i3,
        label: g2.label,
        itemIds: getItemIdsForGroup6(i3)
      })),
      defaultEnabled: [0],
      storageKey: "chordSpelling_enabledGroups",
      label: "Chord types",
      sortUnstarted: (a3, b) => a3.string - b.string
    });
    const enabledGroups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
    const learner = useLearnerModel("chordSpelling", ALL_ITEMS8);
    const enabledItems = T2(() => {
      const items = [];
      for (const g2 of enabledGroups) {
        items.push(...getItemIdsForGroup6(g2));
      }
      return items;
    }, [enabledGroups]);
    const [seqState, setSeqState] = d2(null);
    const seqStateRef = A2(null);
    const [currentQ, setCurrentQ] = d2(null);
    const currentItemRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const handleSeqInputRef = A2(() => {
    });
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => handleSeqInputRef.current(note),
        () => true
      ),
      []
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        ALL_GROUP_INDICES6,
        getItemIdsForGroup6,
        { expansionThreshold: 0.7 },
        { sortUnstarted: (a3, b) => a3.string - b.string }
      );
    }, [learner.selector]);
    const recommendationText = T2(() => {
      return buildRecommendationText(
        recommendation,
        (i3) => SPELLING_GROUPS[i3].label
      );
    }, [recommendation]);
    const applyRecommendation = q2(() => {
      if (recommendation.enabled) {
        scopeActions.setScope({
          kind: "groups",
          enabledGroups: recommendation.enabled
        });
      }
    }, [recommendation, scopeActions]);
    const practicingLabel = T2(() => {
      if (enabledGroups.size === SPELLING_GROUPS.length) return "all chord types";
      const labels = [...enabledGroups].sort((a3, b) => a3 - b).map((g2) => SPELLING_GROUPS[g2].label);
      return labels.join(", ") + " chords";
    }, [enabledGroups]);
    const handleSequentialInput = q2((input) => {
      const itemId = currentItemRef.current;
      const state = seqStateRef.current;
      if (!itemId || !state) return;
      const result = handleInput(itemId, input, state);
      if (result.status === "continue") {
        seqStateRef.current = result.state;
        setSeqState(result.state);
      } else {
        engineSubmitRef.current(result.correct ? "__correct__" : "__wrong__");
      }
    }, []);
    handleSeqInputRef.current = handleSequentialInput;
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const items = [];
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        for (const g2 of groups) {
          items.push(...getItemIdsForGroup6(g2));
        }
        return items;
      },
      checkAnswer: (itemId, input) => {
        return checkAnswer8(itemId, input);
      },
      onPresent: (itemId) => {
        const q3 = parseItem(itemId);
        currentItemRef.current = itemId;
        setCurrentQ(q3);
        const newSeqState = initSequentialState(itemId);
        seqStateRef.current = newSeqState;
        setSeqState(newSeqState);
      },
      handleKey: (e3, _ctx) => {
        return noteHandler.handleKey(e3);
      },
      onStart: () => noteHandler.reset(),
      onStop: () => {
        noteHandler.reset();
        seqStateRef.current = null;
        setSeqState(null);
      },
      getPracticingLabel: () => {
        const groups = scope.kind === "groups" ? scope.enabledGroups : /* @__PURE__ */ new Set([0]);
        if (groups.size === SPELLING_GROUPS.length) return "all chord types";
        const labels = [...groups].sort((a3, b) => a3 - b).map((g2) => SPELLING_GROUPS[g2].label);
        return labels.join(", ") + " chords";
      }
    }), [scope, noteHandler]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const sessionSummary = enabledItems.length + " items \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS8,
        selector: learner.selector,
        itemNoun: "items",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const promptText = currentQ ? displayNote(currentQ.rootName) + currentQ.chordType.symbol : "";
    const handleNoteAnswer = q2(
      (note) => handleSequentialInput(note),
      [handleSequentialInput]
    );
    const round = useRoundSummary(engine, learner, practicingLabel);
    const statsSel = useStatsSelector(
      learner.selector,
      engine.state.phase,
      statsMode
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Chord Spelling", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(
                GroupToggles,
                {
                  labels: SPELLING_GROUPS.map((g2) => g2.label),
                  active: enabledGroups,
                  recommended: recommendation.expandIndex ?? void 0,
                  onToggle: scopeActions.toggleGroup
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: /* @__PURE__ */ u3(
              StatsGrid,
              {
                selector: statsSel,
                colLabels: GRID_COL_LABELS3,
                getItemId: getGridItemId5,
                statsMode,
                notes: GRID_NOTES3,
                baseline: learner.motorBaseline ?? void 0
              }
            ) })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(ChordSlots, { state: seqState }),
            /* @__PURE__ */ u3(NoteButtons, { onAnswer: handleNoteAnswer }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/quiz-fretboard-state.ts
  function createFretboardHelpers(musicData) {
    const noteNames2 = musicData.notes.map((n2) => n2.name);
    const fretCount = musicData.fretCount || 13;
    function getNoteAtPosition2(string, fret) {
      const offset = musicData.stringOffsets[string];
      return noteNames2[(offset + fret) % 12];
    }
    function parseFretboardItem(itemId) {
      const [s3, f4] = itemId.split("-").map(Number);
      return {
        currentString: s3,
        currentFret: f4,
        currentNote: getNoteAtPosition2(s3, f4)
      };
    }
    function checkFretboardAnswer(currentNote, input) {
      const note = musicData.notes.find((n2) => n2.name === currentNote);
      const correct = !!(note && musicData.noteMatchesInput(note, input));
      return { correct, correctAnswer: displayNote(currentNote) };
    }
    function notePassesFilter(note, noteFilter) {
      if (noteFilter === "all") return true;
      const isNatural = musicData.naturalNotes.includes(note);
      return noteFilter === "natural" ? isNatural : !isNatural;
    }
    function getFretboardEnabledItems(enabledStrings, noteFilter) {
      const items = [];
      for (const s3 of enabledStrings) {
        for (let f4 = 0; f4 < fretCount; f4++) {
          const note = getNoteAtPosition2(s3, f4);
          if (notePassesFilter(note, noteFilter)) {
            items.push(s3 + "-" + f4);
          }
        }
      }
      return items;
    }
    function getItemIdsForString(string, noteFilter) {
      const items = [];
      for (let f4 = 0; f4 < fretCount; f4++) {
        const note = getNoteAtPosition2(string, f4);
        if (notePassesFilter(note, noteFilter)) {
          items.push(string + "-" + f4);
        }
      }
      return items;
    }
    return {
      fretCount,
      getNoteAtPosition: getNoteAtPosition2,
      parseFretboardItem,
      checkFretboardAnswer,
      getFretboardEnabledItems,
      getItemIdsForString
    };
  }
  function computeNotePrioritization(naturalStats, threshold) {
    let totalSeen = 0;
    let totalMastered = 0;
    for (const r3 of naturalStats) {
      totalSeen += r3.masteredCount + r3.dueCount;
      totalMastered += r3.masteredCount;
    }
    const ratio = totalSeen > 0 ? totalMastered / totalSeen : 0;
    if (totalSeen === 0 || ratio < threshold) {
      return { suggestedFilter: "natural", naturalMasteryRatio: ratio };
    }
    return { suggestedFilter: "all", naturalMasteryRatio: ratio };
  }

  // src/fretboard.ts
  var fretPositions = [
    0,
    65,
    126,
    183,
    237,
    288,
    336,
    381,
    423,
    463,
    500,
    535,
    568,
    600
  ];
  var MAX_FRET_COUNT = fretPositions.length - 1;
  var PAD_Y = 18;
  var STRING_GAP = 38;
  function stringY(stringIndex) {
    return PAD_Y + stringIndex * STRING_GAP;
  }
  function noteX(fret) {
    return fret === 0 ? (fretPositions[0] + fretPositions[1]) / 2 : (fretPositions[fret] + fretPositions[fret + 1]) / 2;
  }
  function svgHeight(stringCount) {
    return (stringCount - 1) * STRING_GAP + PAD_Y * 2;
  }
  function fretLines(height) {
    return fretPositions.slice(2).map(
      (x2) => `<line class="fb-fret" x1="${x2}" y1="0" x2="${x2}" y2="${height}" stroke-width="1"/>`
    ).join("\n      ");
  }
  function stringLines(stringCount = 6) {
    return Array.from({ length: stringCount }, (_3, i3) => {
      const thickness = 1 + i3 * 0.4;
      return `<line class="fb-string" x1="0" y1="${stringY(i3)}" x2="600" y2="${stringY(i3)}" stroke-width="${thickness}"/>`;
    }).join("\n      ");
  }
  function fretMarkerDots(stringCount = 6, markers = [3, 5, 7, 9, 12], fretCount = 13) {
    const h3 = svgHeight(stringCount);
    return markers.filter((fret) => fret < fretCount).map((fret) => {
      const cx = noteX(fret);
      if (fret === 12) {
        let y1, y22;
        if (stringCount <= 4) {
          y1 = stringY(1);
          y22 = stringY(stringCount - 2);
        } else {
          y1 = (stringY(1) + stringY(2)) / 2;
          y22 = (stringY(stringCount - 3) + stringY(stringCount - 2)) / 2;
        }
        return `<circle class="fb-marker" cx="${cx}" cy="${y1}" r="4"/><circle class="fb-marker" cx="${cx}" cy="${y22}" r="4"/>`;
      }
      return `<circle class="fb-marker" cx="${cx}" cy="${h3 / 2}" r="4"/>`;
    }).join("\n      ");
  }
  function positionCircles(stringCount = 6, fretCount = 13) {
    if (fretCount > MAX_FRET_COUNT) {
      throw new Error(
        `fretCount ${fretCount} exceeds max ${MAX_FRET_COUNT} (fretPositions has ${fretPositions.length} entries)`
      );
    }
    return Array.from(
      { length: stringCount },
      (_3, string) => Array.from({ length: fretCount }, (_4, fret) => {
        return `<circle class="fb-pos" data-string="${string}" data-fret="${fret}" cx="${noteX(fret)}" cy="${stringY(string)}" r="10"/>`;
      }).join("\n      ")
    ).join("\n      ");
  }

  // src/html-helpers.ts
  function fretboardSVG(config = {}) {
    const sc = config.stringCount ?? 6;
    const fc = config.fretCount ?? 13;
    const h3 = svgHeight(sc);
    const markers = config.fretMarkers ?? [3, 5, 7, 9, 12];
    const idAttr = config.id ? ` id="${config.id}"` : "";
    return `<div class="fretboard-wrapper">
      <div class="fretboard-container">
        <svg class="fretboard"${idAttr} viewBox="0 0 600 ${h3}">
          <!-- Fret marker dots (inlays) -->
          ${fretMarkerDots(sc, markers, fc)}
          <!-- Nut (wide bar at fret 0) -->
          <rect class="fb-nut" x="${fretPositions[1] - 2}" y="0" width="4" height="${h3}" rx="1"/>
          <!-- Frets (vertical lines) -->
          ${fretLines(h3)}
          <!-- Strings (horizontal lines) -->
          ${stringLines(sc)}
          <!-- Position circles -->
          ${positionCircles(sc, fc)}
        </svg>
        <div class="hover-card"><div class="hc-inner">
          <div class="hc-note"></div>
          <div class="hc-string-fret"></div>
          <div class="hc-detail"></div>
          <div class="hc-bar"><div class="hc-bar-fill"></div></div>
        </div></div>
      </div>
    </div>`;
  }

  // src/modes/fretboard/fretboard-mode.tsx
  var FB_QUIZ_HL = "hsl(50, 100%, 50%)";
  function setCircleFill(root, string, fret, color) {
    const circle = root.querySelector(
      'circle.fb-pos[data-string="' + string + '"][data-fret="' + fret + '"]'
    );
    if (circle) circle.style.fill = color;
  }
  function clearAll(root) {
    root.querySelectorAll(".fb-pos").forEach((c3) => {
      c3.style.fill = "";
    });
  }
  function setupHoverCard(wrapper, instrument, fb, selector) {
    const card = wrapper.querySelector(".hover-card");
    if (!card) return () => {
    };
    const svg = wrapper.querySelector("svg");
    if (!svg) return () => {
    };
    function onOver(e3) {
      const el = e3.target.closest(".fb-pos");
      if (!el || !card) return;
      const s3 = parseInt(el.getAttribute("data-string"));
      const f4 = parseInt(el.getAttribute("data-fret"));
      const itemId = s3 + "-" + f4;
      const q3 = fb.parseFretboardItem(itemId);
      const auto = selector.getAutomaticity(itemId);
      const noteEl = card.querySelector(".hc-note");
      if (noteEl) noteEl.textContent = displayNote(q3.currentNote);
      const sfEl = card.querySelector(".hc-string-fret");
      if (sfEl) {
        sfEl.textContent = displayNote(instrument.stringNames[s3]) + " string, fret " + f4;
      }
      const detailEl = card.querySelector(".hc-detail");
      const barFill = card.querySelector(".hc-bar-fill");
      if (auto !== null) {
        const pct = Math.round(auto * 100);
        let label;
        if (auto > 0.8) label = "Automatic";
        else if (auto > 0.6) label = "Solid";
        else if (auto > 0.4) label = "Getting there";
        else if (auto > 0.2) label = "Fading";
        else label = "Needs work";
        if (detailEl) detailEl.textContent = label + " \xB7 " + pct + "%";
        if (barFill) {
          barFill.style.width = pct + "%";
          barFill.style.background = getAutomaticityColor(auto);
        }
      } else {
        if (detailEl) detailEl.textContent = "Not seen yet";
        if (barFill) {
          barFill.style.width = "0%";
          barFill.style.background = "";
        }
      }
      const containerRect = wrapper.querySelector(
        ".fretboard-container"
      ).getBoundingClientRect();
      const elRect = el.getBoundingClientRect();
      const cx = elRect.left + elRect.width / 2 - containerRect.left;
      const cy = elRect.top - containerRect.top;
      if (cy < 50) {
        card.style.left = cx + "px";
        card.style.top = cy + elRect.height + 6 + "px";
        card.style.transform = "translate(-50%, 0)";
      } else {
        card.style.left = cx + "px";
        card.style.top = cy - 6 + "px";
        card.style.transform = "translate(-50%, -100%)";
      }
      card.classList.add("visible");
    }
    function onOut(e3) {
      const el = e3.target.closest(".fb-pos");
      if (el && card) card.classList.remove("visible");
    }
    svg.addEventListener("mouseover", onOver);
    svg.addEventListener("mouseout", onOut);
    return () => {
      svg.removeEventListener("mouseover", onOver);
      svg.removeEventListener("mouseout", onOut);
    };
  }
  function FretboardMode({ instrument, container, navigateHome, onMount }) {
    const fb = T2(
      () => createFretboardHelpers({
        notes: NOTES,
        naturalNotes: NATURAL_NOTES,
        stringOffsets: instrument.stringOffsets,
        fretCount: instrument.fretCount,
        noteMatchesInput
      }),
      [instrument]
    );
    const allStrings = T2(
      () => Array.from({ length: instrument.stringCount }, (_3, i3) => i3),
      [instrument]
    );
    const ALL_ITEMS10 = T2(() => {
      const items = [];
      for (const s3 of allStrings) {
        for (let f4 = 0; f4 < instrument.fretCount; f4++) {
          items.push(s3 + "-" + f4);
        }
      }
      return items;
    }, [allStrings, instrument]);
    const [scope, scopeActions] = useScopeState({
      kind: "fretboard",
      instrument
    });
    const enabledStrings = scope.kind === "fretboard" ? scope.enabledStrings : /* @__PURE__ */ new Set([instrument.defaultString]);
    const noteFilter = scope.kind === "fretboard" ? scope.noteFilter : "natural";
    const learner = useLearnerModel(instrument.storageNamespace, ALL_ITEMS10);
    const [currentQ, setCurrentQ] = d2(null);
    const currentQRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const noteFilterRef = A2(noteFilter);
    noteFilterRef.current = noteFilter;
    const noteHandler = T2(
      () => createAdaptiveKeyHandler(
        (note) => engineSubmitRef.current(note),
        () => noteFilterRef.current !== "natural"
      ),
      []
    );
    const quizFbRef = A2(null);
    const progressFbRef = A2(null);
    const svgHTML = T2(
      () => fretboardSVG({
        stringCount: instrument.stringCount,
        fretCount: instrument.fretCount,
        fretMarkers: instrument.fretMarkers
      }),
      [instrument]
    );
    const recommendation = T2(() => {
      return computeRecommendations(
        learner.selector,
        allStrings,
        (s3) => {
          const prefix = s3 + "-";
          return ALL_ITEMS10.filter((id) => id.startsWith(prefix));
        },
        DEFAULT_CONFIG,
        { sortUnstarted: (a3, b) => b.string - a3.string }
      );
    }, [learner.selector, allStrings, ALL_ITEMS10]);
    const recommendationText = T2(() => {
      if (!recommendation || recommendation.recommended.size === 0) return "";
      const naturalStats = learner.selector.getStringRecommendations(
        [...recommendation.recommended],
        (s3) => fb.getItemIdsForString(s3, "natural")
      );
      const pri = computeNotePrioritization(
        naturalStats,
        DEFAULT_CONFIG.expansionThreshold
      );
      const extraParts = pri.suggestedFilter === "natural" ? ["naturals first"] : ["add sharps & flats"];
      return buildRecommendationText(
        recommendation,
        (s3) => displayNote(instrument.stringNames[s3]) + " string",
        extraParts
      );
    }, [recommendation, learner.selector, fb, instrument]);
    const applyRecommendation = q2(() => {
      if (!recommendation || !recommendation.enabled) return;
      const naturalStats = learner.selector.getStringRecommendations(
        [...recommendation.recommended],
        (s3) => fb.getItemIdsForString(s3, "natural")
      );
      const pri = computeNotePrioritization(
        naturalStats,
        DEFAULT_CONFIG.expansionThreshold
      );
      const newNoteFilter = pri.suggestedFilter === "natural" ? "natural" : "all";
      scopeActions.setScope({
        kind: "fretboard",
        enabledStrings: recommendation.enabled,
        noteFilter: newNoteFilter
      });
    }, [recommendation, learner.selector, fb, scopeActions]);
    const practicingLabel = T2(() => {
      const parts = [];
      if (enabledStrings.size < instrument.stringCount) {
        const names = Array.from(enabledStrings).sort((a3, b) => b - a3).map((s3) => displayNote(instrument.stringNames[s3]));
        parts.push(
          names.join(", ") + " string" + (names.length === 1 ? "" : "s")
        );
      } else {
        parts.push("all strings");
      }
      if (noteFilter === "natural") parts.push("natural notes");
      else if (noteFilter === "sharps-flats") parts.push("sharps and flats");
      return parts.join(", ");
    }, [enabledStrings, noteFilter, instrument]);
    const sessionSummary = T2(() => {
      const count = enabledStrings.size;
      let filterLabel = "all notes";
      if (noteFilter === "natural") filterLabel = "natural notes";
      else if (noteFilter === "sharps-flats") filterLabel = "sharps and flats";
      return count + " string" + (count !== 1 ? "s" : "") + " \xB7 " + filterLabel + " \xB7 60s";
    }, [enabledStrings, noteFilter]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const s3 = scope.kind === "fretboard" ? scope.enabledStrings : /* @__PURE__ */ new Set([instrument.defaultString]);
        const nf = scope.kind === "fretboard" ? scope.noteFilter : "natural";
        return fb.getFretboardEnabledItems(s3, nf);
      },
      checkAnswer: (itemId, input) => {
        const q3 = fb.parseFretboardItem(itemId);
        return fb.checkFretboardAnswer(q3.currentNote, input);
      },
      onPresent: (itemId) => {
        const q3 = fb.parseFretboardItem(itemId);
        currentQRef.current = q3;
        setCurrentQ(q3);
        if (quizFbRef.current) {
          clearAll(quizFbRef.current);
          setCircleFill(
            quizFbRef.current,
            q3.currentString,
            q3.currentFret,
            FB_QUIZ_HL
          );
        }
      },
      onAnswer: (itemId, result) => {
        if (quizFbRef.current) {
          const q3 = fb.parseFretboardItem(itemId);
          const color = result.correct ? "var(--color-success)" : "var(--color-error)";
          setCircleFill(
            quizFbRef.current,
            q3.currentString,
            q3.currentFret,
            color
          );
        }
      },
      handleKey: (e3, _ctx) => {
        return noteHandler.handleKey(e3);
      },
      onStart: () => noteHandler.reset(),
      onStop: () => {
        noteHandler.reset();
        if (quizFbRef.current) clearAll(quizFbRef.current);
      },
      getPracticingLabel: () => {
        const s3 = scope.kind === "fretboard" ? scope.enabledStrings : /* @__PURE__ */ new Set([instrument.defaultString]);
        const nf = scope.kind === "fretboard" ? scope.noteFilter : "natural";
        const parts = [];
        if (s3.size < instrument.stringCount) {
          const names = Array.from(s3).sort((a3, b) => b - a3).map((i3) => displayNote(instrument.stringNames[i3]));
          parts.push(
            names.join(", ") + " string" + (names.length === 1 ? "" : "s")
          );
        } else {
          parts.push("all strings");
        }
        if (nf === "natural") parts.push("natural notes");
        else if (nf === "sharps-flats") parts.push("sharps and flats");
        return parts.join(", ");
      }
    }), [scope, noteHandler, fb, instrument]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const round = useRoundSummary(engine, learner, practicingLabel);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS10,
        selector: learner.selector,
        itemNoun: "positions",
        recommendation,
        recommendationText,
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        recommendation,
        recommendationText,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase,
        ALL_ITEMS10
      ]
    );
    y2(() => {
      const wrapper = progressFbRef.current;
      if (!wrapper) return;
      for (const s3 of allStrings) {
        for (let f4 = 0; f4 < instrument.fretCount; f4++) {
          const itemId = s3 + "-" + f4;
          if (statsMode === "retention") {
            const auto = learner.selector.getAutomaticity(itemId);
            setCircleFill(wrapper, s3, f4, getAutomaticityColor(auto));
          } else {
            const stats = learner.selector.getStats(itemId);
            const ewma = stats ? stats.ewma : null;
            setCircleFill(
              wrapper,
              s3,
              f4,
              getSpeedHeatmapColor(ewma, learner.motorBaseline ?? void 0)
            );
          }
        }
      }
    }, [
      learner.selector,
      statsMode,
      engine.state.phase,
      allStrings,
      instrument,
      learner.motorBaseline
    ]);
    y2(() => {
      const wrapper = progressFbRef.current;
      if (!wrapper) return;
      return setupHoverCard(wrapper, instrument, fb, learner.selector);
    }, [instrument, fb, learner.selector]);
    const legendHTML = T2(
      () => buildStatsLegend(statsMode, learner.motorBaseline ?? void 0),
      [statsMode, learner.motorBaseline]
    );
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
          noteHandler.reset();
        }
      });
    }, [engine, learner, noteHandler]);
    const promptText = currentQ ? "Name this note." : "";
    const handleNoteAnswer = q2(
      (note) => engine.submitAnswer(note),
      [engine.submitAnswer]
    );
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: instrument.name, onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              recommendation: summary.recommendationText || void 0,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              sessionSummary,
              onStart: engine.start,
              onApplyRecommendation: summary.showRecommendationButton ? applyRecommendation : void 0,
              scope: /* @__PURE__ */ u3(k, { children: [
                /* @__PURE__ */ u3(
                  StringToggles,
                  {
                    stringNames: instrument.stringNames,
                    active: enabledStrings,
                    recommended: recommendation.expandIndex ?? void 0,
                    onToggle: scopeActions.toggleString
                  }
                ),
                /* @__PURE__ */ u3(
                  NoteFilter,
                  {
                    mode: noteFilter,
                    onChange: (f4) => scopeActions.setNoteFilter(f4)
                  }
                )
              ] })
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3("div", { class: "stats-container", children: [
              /* @__PURE__ */ u3(
                "div",
                {
                  ref: progressFbRef,
                  dangerouslySetInnerHTML: { __html: svgHTML }
                }
              ),
              /* @__PURE__ */ u3(
                "div",
                {
                  dangerouslySetInnerHTML: { __html: legendHTML }
                }
              )
            ] })
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3(
              "div",
              {
                ref: quizFbRef,
                dangerouslySetInnerHTML: { __html: svgHTML }
              }
            ),
            /* @__PURE__ */ u3(
              PianoNoteButtons,
              {
                onAnswer: handleNoteAnswer,
                hideAccidentals: noteFilter === "natural"
              }
            ),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/modes/speed-tap/logic.ts
  var noteNames = NOTES.map((n2) => n2.name);
  var ALL_ITEMS9 = NOTES.map((n2) => n2.name);
  function getNoteAtPosition(string, fret) {
    const offset = STRING_OFFSETS[string];
    return noteNames[(offset + fret) % 12];
  }
  function getPositionsForNote(noteName) {
    const positions = [];
    for (let s3 = 0; s3 < 6; s3++) {
      for (let f4 = 0; f4 <= 12; f4++) {
        if (getNoteAtPosition(s3, f4) === noteName) {
          positions.push({ string: s3, fret: f4 });
        }
      }
    }
    return positions;
  }
  function getEnabledNotes(filter) {
    if (filter === "natural") return NATURAL_NOTES.slice();
    if (filter === "sharps-flats") {
      return NOTES.filter((n2) => !NATURAL_NOTES.includes(n2.name)).map((n2) => n2.name);
    }
    return NOTES.map((n2) => n2.name);
  }

  // src/modes/speed-tap/speed-tap-mode.tsx
  var FB_TAP_NEUTRAL = "hsl(30, 4%, 90%)";
  var FB_TAP_CORRECT = "hsl(90, 45%, 35%)";
  function setCircleFill2(root, string, fret, color) {
    const circle = root.querySelector(
      'circle.fb-pos[data-string="' + string + '"][data-fret="' + fret + '"]'
    );
    if (circle) circle.style.fill = color;
  }
  function clearAllCircles(root) {
    root.querySelectorAll(".fb-pos").forEach((c3) => {
      c3.style.fill = "";
    });
  }
  function SpeedTapMode({ container, navigateHome, onMount }) {
    const [scope, scopeActions] = useScopeState({
      kind: "note-filter",
      storageKey: "speedTap_noteFilter"
    });
    const noteFilter = scope.kind === "note-filter" ? scope.noteFilter : "natural";
    const learner = useLearnerModel("speedTap", ALL_ITEMS9);
    const currentNoteRef = A2(null);
    const targetPosRef = A2([]);
    const foundPosRef = A2(/* @__PURE__ */ new Set());
    const roundActiveRef = A2(false);
    const wrongFlashTimeoutsRef = A2(
      /* @__PURE__ */ new Set()
    );
    const quizFbRef = A2(null);
    const engineSubmitRef = A2(() => {
    });
    const [progressText, setProgressText] = d2("");
    const colorErrorRef = A2("#d32f2f");
    y2(() => {
      try {
        const val = getComputedStyle(document.documentElement).getPropertyValue("--color-error").trim();
        if (val) colorErrorRef.current = val;
      } catch (_3) {
      }
    }, []);
    const [currentDisplayName, setCurrentDisplayName] = d2("");
    const svgHTML = T2(() => fretboardSVG(), []);
    const handleTap = q2((e3) => {
      if (!roundActiveRef.current || !currentNoteRef.current) return;
      const el = e3.target.closest(
        "circle.fb-pos[data-string][data-fret]"
      );
      if (!el) return;
      const s3 = parseInt(el.dataset.string);
      const f4 = parseInt(el.dataset.fret);
      const key = s3 + "-" + f4;
      if (foundPosRef.current.has(key)) return;
      const wrapper = quizFbRef.current;
      if (!wrapper) return;
      const tappedNote = getNoteAtPosition(s3, f4);
      if (tappedNote === currentNoteRef.current) {
        foundPosRef.current.add(key);
        setCircleFill2(wrapper, s3, f4, FB_TAP_CORRECT);
        setProgressText(
          foundPosRef.current.size + " / " + targetPosRef.current.length
        );
        if (foundPosRef.current.size === targetPosRef.current.length) {
          roundActiveRef.current = false;
          engineSubmitRef.current("complete");
        }
      } else {
        setCircleFill2(wrapper, s3, f4, colorErrorRef.current);
        const timeout = setTimeout(() => {
          wrongFlashTimeoutsRef.current.delete(timeout);
          if (!foundPosRef.current.has(key)) {
            setCircleFill2(wrapper, s3, f4, FB_TAP_NEUTRAL);
          }
        }, 800);
        wrongFlashTimeoutsRef.current.add(timeout);
      }
    }, []);
    y2(() => {
      const wrapper = quizFbRef.current;
      if (!wrapper) return;
      wrapper.addEventListener("click", handleTap);
      return () => wrapper.removeEventListener("click", handleTap);
    }, [handleTap]);
    const engineConfig = T2(() => ({
      getEnabledItems: () => {
        const nf = scope.kind === "note-filter" ? scope.noteFilter : "natural";
        return getEnabledNotes(nf);
      },
      checkAnswer: (_itemId, input) => {
        const allFound = input === "complete";
        return {
          correct: allFound,
          correctAnswer: displayNote(currentNoteRef.current)
        };
      },
      onPresent: (itemId) => {
        const note = NOTES.find((n2) => n2.name === itemId);
        const name = note ? displayNote(pickRandomAccidental(note.displayName)) : displayNote(itemId);
        const positions = getPositionsForNote(itemId);
        currentNoteRef.current = itemId;
        targetPosRef.current = positions;
        foundPosRef.current = /* @__PURE__ */ new Set();
        roundActiveRef.current = true;
        setCurrentDisplayName(name);
        setProgressText("0 / " + positions.length);
        const wrapper = quizFbRef.current;
        if (wrapper) {
          wrongFlashTimeoutsRef.current.forEach((t3) => clearTimeout(t3));
          wrongFlashTimeoutsRef.current.clear();
          clearAllCircles(wrapper);
          wrapper.querySelectorAll(".fb-pos").forEach((c3) => {
            c3.style.fill = FB_TAP_NEUTRAL;
          });
        }
      },
      onAnswer: (_itemId, result) => {
        roundActiveRef.current = false;
        if (!result.correct && quizFbRef.current) {
          for (const pos of targetPosRef.current) {
            const key = pos.string + "-" + pos.fret;
            if (!foundPosRef.current.has(key)) {
              setCircleFill2(
                quizFbRef.current,
                pos.string,
                pos.fret,
                colorErrorRef.current
              );
            }
          }
        }
      },
      onStart: () => {
      },
      onStop: () => {
        roundActiveRef.current = false;
        wrongFlashTimeoutsRef.current.forEach((t3) => clearTimeout(t3));
        wrongFlashTimeoutsRef.current.clear();
        currentNoteRef.current = null;
        setProgressText("");
        setCurrentDisplayName("");
        if (quizFbRef.current) clearAllCircles(quizFbRef.current);
      },
      getPracticingLabel: () => {
        const nf = scope.kind === "note-filter" ? scope.noteFilter : "natural";
        if (nf === "all") return "all notes";
        if (nf === "sharps-flats") return "sharps & flats";
        return "natural notes";
      },
      getExpectedResponseCount: (itemId) => {
        return getPositionsForNote(itemId).length;
      }
    }), [scope]);
    const engine = useQuizEngine(engineConfig, learner.selector);
    engineSubmitRef.current = engine.submitAnswer;
    usePhaseClass(container, engine.state.phase);
    const practicingLabel = T2(() => {
      if (noteFilter === "all") return "all notes";
      if (noteFilter === "sharps-flats") return "sharps & flats";
      return "natural notes";
    }, [noteFilter]);
    const round = useRoundSummary(engine, learner, practicingLabel);
    const [activeTab, setActiveTab] = d2(
      "practice"
    );
    const [statsMode, setStatsMode] = d2("retention");
    const enabledNotes = T2(
      () => getEnabledNotes(noteFilter),
      [noteFilter]
    );
    const sessionSummary = enabledNotes.length + " notes \xB7 60s";
    const summary = T2(
      () => computePracticeSummary({
        allItemIds: ALL_ITEMS9,
        selector: learner.selector,
        itemNoun: "notes",
        recommendation: null,
        recommendationText: "",
        sessionSummary,
        masteryText: engine.state.masteryText,
        showMastery: engine.state.showMastery
      }),
      [
        learner.selector,
        sessionSummary,
        engine.state.masteryText,
        engine.state.showMastery,
        engine.state.phase
      ]
    );
    y2(() => {
      return () => {
        wrongFlashTimeoutsRef.current.forEach((t3) => clearTimeout(t3));
      };
    }, []);
    _2(() => {
      onMount({
        activate() {
          learner.syncBaseline();
          engine.updateIdleMessage();
        },
        deactivate() {
          if (engine.state.phase !== "idle") engine.stop();
        }
      });
    }, [engine, learner]);
    const statsHTML = T2(() => {
      let html = '<table class="stats-table speed-tap-stats"><thead><tr>';
      for (let i3 = 0; i3 < NOTES.length; i3++) {
        html += "<th>" + displayNote(NOTES[i3].name) + "</th>";
      }
      html += "</tr></thead><tbody><tr>";
      for (let j3 = 0; j3 < NOTES.length; j3++) {
        if (statsMode === "retention") {
          const auto = learner.selector.getAutomaticity(NOTES[j3].name);
          html += '<td class="stats-cell" style="background:' + getAutomaticityColor(auto) + '"></td>';
        } else {
          const stats = learner.selector.getStats(NOTES[j3].name);
          const posCount = getPositionsForNote(NOTES[j3].name).length;
          const perPosMs = stats ? stats.ewma / posCount : null;
          html += '<td class="stats-cell" style="background:' + getSpeedHeatmapColor(perPosMs, learner.motorBaseline ?? void 0) + '"></td>';
        }
      }
      html += "</tr></tbody></table>";
      html += buildStatsLegend(statsMode, learner.motorBaseline ?? void 0);
      return html;
    }, [learner.selector, statsMode, engine.state.phase, learner.motorBaseline]);
    const promptText = currentDisplayName ? "Tap all " + currentDisplayName : "";
    return /* @__PURE__ */ u3(k, { children: [
      /* @__PURE__ */ u3(ModeTopBar, { title: "Speed Tap", onBack: navigateHome }),
      /* @__PURE__ */ u3(
        TabbedIdle,
        {
          activeTab,
          onTabSwitch: setActiveTab,
          practiceContent: /* @__PURE__ */ u3(
            PracticeCard,
            {
              statusLabel: summary.statusLabel,
              statusDetail: summary.statusDetail,
              sessionSummary,
              mastery: summary.showMastery ? summary.masteryText : void 0,
              onStart: engine.start,
              scope: /* @__PURE__ */ u3(
                NoteFilter,
                {
                  mode: noteFilter,
                  onChange: (f4) => scopeActions.setNoteFilter(f4)
                }
              )
            }
          ),
          progressContent: /* @__PURE__ */ u3("div", { children: [
            /* @__PURE__ */ u3("div", { class: "baseline-info", children: round.baselineText }),
            /* @__PURE__ */ u3("div", { class: "stats-controls", children: /* @__PURE__ */ u3(StatsToggle, { active: statsMode, onToggle: setStatsMode }) }),
            /* @__PURE__ */ u3(
              "div",
              {
                class: "stats-container",
                dangerouslySetInnerHTML: { __html: statsHTML }
              }
            )
          ] })
        }
      ),
      /* @__PURE__ */ u3(
        QuizSession,
        {
          timeLeft: engine.timerText,
          context: practicingLabel,
          count: round.countText,
          fluent: engine.state.masteredCount,
          total: engine.state.totalEnabledCount,
          isWarning: engine.timerWarning,
          isLastQuestion: engine.timerLastQuestion,
          onClose: engine.stop
        }
      ),
      /* @__PURE__ */ u3(
        QuizArea,
        {
          prompt: promptText,
          lastQuestion: engine.state.roundTimerExpired ? "Last question" : "",
          children: [
            /* @__PURE__ */ u3("div", { class: "speed-tap-status", children: /* @__PURE__ */ u3("span", { class: "speed-tap-progress", children: progressText }) }),
            /* @__PURE__ */ u3(
              "div",
              {
                ref: quizFbRef,
                dangerouslySetInnerHTML: { __html: svgHTML }
              }
            ),
            /* @__PURE__ */ u3(NoteButtons, { hidden: true, onAnswer: () => {
            } }),
            /* @__PURE__ */ u3(
              FeedbackDisplay,
              {
                text: engine.state.feedbackText,
                className: engine.state.feedbackClass,
                time: engine.state.timeDisplayText || void 0,
                hint: engine.state.hintText || void 0
              }
            ),
            /* @__PURE__ */ u3(
              RoundComplete,
              {
                context: round.roundContext,
                heading: "Round complete",
                correct: round.roundCorrect,
                median: round.roundMedian,
                onContinue: engine.continueQuiz,
                onStop: engine.stop
              }
            )
          ]
        }
      )
    ] });
  }

  // src/app.ts
  var nav = createNavigation();
  function registerPreactMode(id, name, Component) {
    let handle = null;
    const container = document.getElementById("mode-" + id);
    nav.registerMode(id, {
      name,
      init() {
        J(
          _(Component, {
            container,
            navigateHome: () => nav.navigateHome(),
            onMount: (h3) => {
              handle = h3;
            }
          }),
          container
        );
      },
      activate() {
        handle?.activate();
      },
      deactivate() {
        handle?.deactivate();
      }
    });
  }
  function registerFretboardMode(id, name, instrument) {
    let handle = null;
    const cont = document.getElementById("mode-" + id);
    nav.registerMode(id, {
      name,
      init() {
        J(
          _(FretboardMode, {
            instrument,
            container: cont,
            navigateHome: () => nav.navigateHome(),
            onMount: (h3) => {
              handle = h3;
            }
          }),
          cont
        );
      },
      activate() {
        handle?.activate();
      },
      deactivate() {
        handle?.deactivate();
      }
    });
  }
  registerFretboardMode("fretboard", "Guitar Fretboard", GUITAR);
  registerFretboardMode("ukulele", "Ukulele Fretboard", UKULELE);
  registerPreactMode("noteSemitones", "Note \u2194 Semitones", NoteSemitonesMode);
  registerPreactMode(
    "intervalSemitones",
    "Interval \u2194 Semitones",
    IntervalSemitonesMode
  );
  registerPreactMode("semitoneMath", "Semitone Math", SemitoneMathMode);
  registerPreactMode("intervalMath", "Interval Math", IntervalMathMode);
  registerPreactMode("keySignatures", "Key Signatures", KeySignaturesMode);
  registerPreactMode("scaleDegrees", "Scale Degrees", ScaleDegreesMode);
  registerPreactMode("diatonicChords", "Diatonic Chords", DiatonicChordsMode);
  registerPreactMode("chordSpelling", "Chord Spelling", ChordSpellingMode);
  registerPreactMode("speedTap", "Speed Tap", SpeedTapMode);
  nav.init();
  var settings = createSettingsModal({
    onNotationChange() {
      document.querySelectorAll(".mode-screen.mode-active").forEach(
        (el) => {
          refreshNoteButtonLabels(el);
          const activeToggle = el.querySelector(".stats-toggle-btn.active");
          if (activeToggle) activeToggle.click();
        }
      );
    }
  });
  var settingsBtn = document.querySelector(".home-settings-btn");
  if (settingsBtn) {
    settingsBtn.addEventListener("click", () => settings.open());
  }
  if ("serviceWorker" in navigator && !window.Capacitor) {
    navigator.serviceWorker.register("sw.js");
  }
})();

  </script>
</body>
</html>