<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fretboard Design — Direction 1 Variations</title>
<style>
  :root {
    --page-bg: #f5f4f1;
    --card-bg: #fff;
    --text: hsl(30, 5%, 20%);
    --text-muted: hsl(30, 3%, 45%);
    --border: hsl(30, 5%, 85%);
    --brand: hsl(90, 35%, 45%);
    --heat-none: hsl(60, 5%, 93%);
    --heat-1: hsl(15, 55%, 68%);
    --heat-2: hsl(35, 55%, 58%);
    --heat-3: hsl(55, 45%, 50%);
    --heat-4: hsl(72, 42%, 42%);
    --heat-5: hsl(88, 52%, 33%);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: var(--page-bg);
    color: var(--text);
    padding: 1rem 0.5rem;
    max-width: 400px;
    margin: 0 auto;
  }
  h1 { font-size: 1.2rem; font-weight: 700; text-align: center; margin-bottom: 0.25rem; }
  .subtitle { text-align: center; color: var(--text-muted); font-size: 0.75rem; margin-bottom: 1rem; }
  .exploration {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 0.75rem;
    margin-bottom: 1.25rem;
  }
  .exploration h2 { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.15rem; }
  .exploration .desc {
    font-size: 0.72rem; color: var(--text-muted); margin-bottom: 0.5rem; line-height: 1.4;
  }
  .fretboard-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; position: relative; }

  /* State toggles */
  .state-toggles { display: flex; gap: 0.2rem; margin-bottom: 0.5rem; flex-wrap: wrap; }
  .state-btn {
    font-size: 0.65rem; font-weight: 500; padding: 0.2rem 0.5rem;
    border: 1px solid var(--border); border-radius: 5px;
    background: var(--card-bg); color: var(--text-muted);
    cursor: pointer; transition: all 0.15s;
  }
  .state-btn:hover { background: #f0efec; }
  .state-btn.active { background: var(--brand); color: #fff; border-color: var(--brand); }

  /* Legend */
  .legend {
    display: flex; gap: 0.4rem; flex-wrap: wrap; margin-top: 0.5rem; justify-content: center;
  }
  .legend-item { display: flex; align-items: center; gap: 0.15rem; font-size: 0.6rem; color: var(--text-muted); }
  .legend-swatch { width: 9px; height: 9px; border-radius: 2px; border: 1px solid rgba(0,0,0,0.08); }

  /* ===== Shared fretboard styles ===== */
  .fb svg { width: 100%; height: auto; display: block; }
  .fb .fb-string { stroke: hsl(30, 8%, 72%); }
  .fb .fb-fret { stroke: hsl(30, 5%, 82%); }
  .fb .fb-nut { fill: hsl(30, 8%, 52%); }
  .fb .fb-marker { fill: hsl(30, 5%, 75%); }
  .fb .fb-fret-num {
    font-family: system-ui, sans-serif; font-size: 8px; font-weight: 500;
    fill: hsl(30, 3%, 65%); text-anchor: middle;
  }

  /* Quiz highlight */
  .fb .fb-quiz-hl {
    fill: hsl(45, 90%, 55%); opacity: 0; transition: opacity 0.15s;
  }
  .fb .fb-quiz-hl.visible { opacity: 1; }

  /* Tap target */
  .fb .fb-tap {
    fill: transparent; stroke: hsl(30, 5%, 65%); stroke-width: 1;
    opacity: 0; cursor: pointer; transition: opacity 0.15s;
  }
  .fb .fb-tap.visible { opacity: 1; }
  .fb .fb-tap.correct {
    fill: hsla(90, 45%, 50%, 0.25); stroke: hsl(90, 45%, 45%); stroke-width: 1.5;
  }

  /* Heatmap dot */
  .fb .fb-dot {
    opacity: 0; cursor: pointer; transition: opacity 0.15s;
  }
  .fb .fb-dot.visible { opacity: 1; }
  .fb .fb-dot.heat-none { fill: hsl(30, 3%, 82%); }
  .fb .fb-dot.heat-1 { fill: var(--heat-1); }
  .fb .fb-dot.heat-2 { fill: var(--heat-2); }
  .fb .fb-dot.heat-3 { fill: var(--heat-3); }
  .fb .fb-dot.heat-4 { fill: var(--heat-4); }
  .fb .fb-dot.heat-5 { fill: var(--heat-5); }

  /* Ring variant (dots drawn as outlined rings) */
  .fb .fb-ring {
    fill: transparent; stroke-width: 1.5; opacity: 0;
    cursor: pointer; transition: opacity 0.15s;
  }
  .fb .fb-ring.visible { opacity: 1; }
  .fb .fb-ring.heat-none { stroke: hsl(30, 3%, 82%); }
  .fb .fb-ring.heat-1 { stroke: var(--heat-1); }
  .fb .fb-ring.heat-2 { stroke: var(--heat-2); }
  .fb .fb-ring.heat-3 { stroke: var(--heat-3); }
  .fb .fb-ring.heat-4 { stroke: var(--heat-4); }
  .fb .fb-ring.heat-5 { stroke: var(--heat-5); }

  /* Tap quiz prompt */
  .tap-prompt {
    font-size: 0.72rem; font-weight: 600; color: var(--text);
    text-align: center; padding: 0.3rem 0; min-height: 1.3rem;
  }

  /* ===== Hover card (shared) ===== */
  .hover-card {
    position: absolute;
    pointer-events: none;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.12s;
  }
  .hover-card.visible { opacity: 1; }

  /* Style A: small dark pill */
  .hover-card.style-pill .hc-inner {
    background: hsl(30, 5%, 22%); color: #fff; border-radius: 6px;
    padding: 0.25rem 0.5rem; font-size: 0.7rem; font-weight: 600;
    white-space: nowrap; text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  .hover-card.style-pill .hc-detail {
    font-size: 0.55rem; font-weight: 400; opacity: 0.7; margin-top: 0.1rem;
  }

  /* Style B: card with bar */
  .hover-card.style-card .hc-inner {
    background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px;
    padding: 0.4rem 0.55rem; min-width: 70px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.12);
  }
  .hover-card.style-card .hc-note {
    font-size: 0.85rem; font-weight: 700; color: var(--text);
  }
  .hover-card.style-card .hc-detail {
    font-size: 0.6rem; color: var(--text-muted); margin-top: 0.15rem;
  }
  .hover-card.style-card .hc-bar {
    height: 3px; border-radius: 2px; background: hsl(30, 5%, 90%);
    margin-top: 0.3rem; overflow: hidden;
  }
  .hover-card.style-card .hc-bar-fill {
    height: 100%; border-radius: 2px; transition: width 0.2s;
  }

  /* ===== Per-variation overrides ===== */

  /* A: Whisper — ultra-thin, tiny dots */
  #v-a .fb-string { stroke: hsl(30, 5%, 80%); }
  #v-a .fb-fret { stroke: hsl(30, 3%, 87%); }
  #v-a .fb-tap { stroke: hsl(30, 5%, 72%); stroke-width: 0.75; }

  /* B: Standard — balanced default */
  /* (uses shared defaults) */

  /* C: Even Grid — same as B but even spacing */
  #v-c .fb-fret { stroke: hsl(30, 3%, 85%); }

  /* D: Rings — colored outlines instead of filled dots */
  #v-d .fb-ring { stroke-width: 2; }

  /* E: Data Dense — dot size encodes skill */
  /* (handled in JS) */
</style>
</head>
<body>

<h1>Direction 1 — Variations</h1>
<p class="subtitle">Clean fretboard, dots for heatmap, circles for tap targets, hover card for detail</p>

<div class="exploration" id="v-a">
  <h2>A. Whisper</h2>
  <p class="desc">
    Ultra-minimal. Tiny dots (r=3), thin strings. The fretboard nearly disappears
    until you interact. Small dark pill tooltip.
  </p>
  <div class="state-toggles" data-v="a">
    <button class="state-btn active" data-state="quiz">Quiz</button>
    <button class="state-btn" data-state="tap">Tap quiz</button>
    <button class="state-btn" data-state="stats">Heatmap</button>
    <button class="state-btn" data-state="blank">Blank</button>
  </div>
  <div class="tap-prompt" id="tap-prompt-a"></div>
  <div class="fretboard-wrap">
    <div class="fb" id="fb-a"></div>
    <div class="hover-card style-pill" id="hc-a"><div class="hc-inner"><span class="hc-note"></span><div class="hc-detail"></div></div></div>
  </div>
  <div class="legend" id="legend-a" style="display:none"></div>
</div>

<div class="exploration" id="v-b">
  <h2>B. Standard</h2>
  <p class="desc">
    Balanced default. Medium dots (r=5), normal strings. Card tooltip with note
    name and skill bar — room for future stats.
  </p>
  <div class="state-toggles" data-v="b">
    <button class="state-btn active" data-state="quiz">Quiz</button>
    <button class="state-btn" data-state="tap">Tap quiz</button>
    <button class="state-btn" data-state="stats">Heatmap</button>
    <button class="state-btn" data-state="blank">Blank</button>
  </div>
  <div class="tap-prompt" id="tap-prompt-b"></div>
  <div class="fretboard-wrap">
    <div class="fb" id="fb-b"></div>
    <div class="hover-card style-card" id="hc-b"><div class="hc-inner"><span class="hc-note"></span><div class="hc-detail"></div><div class="hc-bar"><div class="hc-bar-fill"></div></div></div></div>
  </div>
  <div class="legend" id="legend-b" style="display:none"></div>
</div>

<div class="exploration" id="v-c">
  <h2>C. Even Grid</h2>
  <p class="desc">
    Same as B but with equal fret spacing — cleaner geometry, easier to scan.
    Trade-off: loses the "real neck" feel.
  </p>
  <div class="state-toggles" data-v="c">
    <button class="state-btn active" data-state="quiz">Quiz</button>
    <button class="state-btn" data-state="tap">Tap quiz</button>
    <button class="state-btn" data-state="stats">Heatmap</button>
    <button class="state-btn" data-state="blank">Blank</button>
  </div>
  <div class="tap-prompt" id="tap-prompt-c"></div>
  <div class="fretboard-wrap">
    <div class="fb" id="fb-c"></div>
    <div class="hover-card style-card" id="hc-c"><div class="hc-inner"><span class="hc-note"></span><div class="hc-detail"></div><div class="hc-bar"><div class="hc-bar-fill"></div></div></div></div>
  </div>
  <div class="legend" id="legend-c" style="display:none"></div>
</div>

<div class="exploration" id="v-d">
  <h2>D. Rings</h2>
  <p class="desc">
    Heatmap uses colored ring outlines instead of filled dots — feels like an overlay
    rather than dots on a map. Slightly more fretboard visible through.
  </p>
  <div class="state-toggles" data-v="d">
    <button class="state-btn active" data-state="quiz">Quiz</button>
    <button class="state-btn" data-state="tap">Tap quiz</button>
    <button class="state-btn" data-state="stats">Heatmap</button>
    <button class="state-btn" data-state="blank">Blank</button>
  </div>
  <div class="tap-prompt" id="tap-prompt-d"></div>
  <div class="fretboard-wrap">
    <div class="fb" id="fb-d"></div>
    <div class="hover-card style-pill" id="hc-d"><div class="hc-inner"><span class="hc-note"></span><div class="hc-detail"></div></div></div>
  </div>
  <div class="legend" id="legend-d" style="display:none"></div>
</div>

<div class="exploration" id="v-e">
  <h2>E. Data Dense</h2>
  <p class="desc">
    Dot size encodes skill: bigger dots = weaker (needs attention), smaller = stronger.
    Adds an information channel beyond color alone.
  </p>
  <div class="state-toggles" data-v="e">
    <button class="state-btn active" data-state="quiz">Quiz</button>
    <button class="state-btn" data-state="tap">Tap quiz</button>
    <button class="state-btn" data-state="stats">Heatmap</button>
    <button class="state-btn" data-state="blank">Blank</button>
  </div>
  <div class="tap-prompt" id="tap-prompt-e"></div>
  <div class="fretboard-wrap">
    <div class="fb" id="fb-e"></div>
    <div class="hover-card style-card" id="hc-e"><div class="hc-inner"><span class="hc-note"></span><div class="hc-detail"></div><div class="hc-bar"><div class="hc-bar-fill"></div></div></div></div>
  </div>
  <div class="legend" id="legend-e" style="display:none"></div>
</div>

<script>
// ===== Data =====
const NOTES = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
const STR_NAMES = ['e','B','G','D','A','E'];
const STR_OFFSETS = [4, 11, 7, 2, 9, 4];
const FRETS = 13;
const MARKERS = [3, 5, 7, 9, 12];
const FRET_POS = [0,65,126,183,237,288,336,381,423,463,500,535,568,600];
const W = 600, GAP = 38, PAD_Y = 18;
const H = 5 * GAP + PAD_Y * 2;

function noteAt(s, f) { return NOTES[(STR_OFFSETS[s] + f) % 12]; }

// Even grid positions
const EVEN_W = W - 30; // leave room for open string
const OPEN_W = 50;     // wider open-string zone
const CELL_W = (EVEN_W - OPEN_W) / 12;
function evenX(f) {
  if (f === 0) return OPEN_W / 2;
  return OPEN_W + (f - 0.5) * CELL_W;
}
function evenFretX(f) {
  if (f === 0) return 0;
  if (f === 1) return OPEN_W;
  return OPEN_W + (f - 1) * CELL_W;
}

function noteX(f, even) {
  if (even) return evenX(f);
  return f === 0
    ? FRET_POS[0] + (FRET_POS[1] - FRET_POS[0]) / 2
    : (FRET_POS[f] + FRET_POS[f + 1]) / 2;
}
function noteY(s) { return PAD_Y + s * GAP; }

function fakeSkill(s, f) {
  const base = Math.max(0, 1 - f * 0.065);
  const bonus = [0.1, 0.05, 0, -0.05, 0.15, 0.2][s];
  const noise = Math.sin(s * 7 + f * 13) * 0.15;
  return Math.max(0, Math.min(1, base + bonus + noise));
}
function heatLevel(sk) {
  if (sk === null) return 'none';
  if (sk > 0.8) return '5';
  if (sk > 0.6) return '4';
  if (sk > 0.4) return '3';
  if (sk > 0.2) return '2';
  return '1';
}
function heatLabel(sk) {
  if (sk > 0.8) return 'Automatic';
  if (sk > 0.6) return 'Solid';
  if (sk > 0.4) return 'Getting there';
  if (sk > 0.2) return 'Fading';
  return 'Needs work';
}

const HL_S = 4, HL_F = 5; // quiz: A string fret 5 = D
const TAP_NOTE = 'G';     // tap quiz: "Find G"

const LEGEND_HTML = `
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-none)"></span>Unseen</div>
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-1)"></span>&lt;20%</div>
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-2)"></span>&gt;20%</div>
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-3)"></span>&gt;40%</div>
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-4)"></span>&gt;60%</div>
  <div class="legend-item"><span class="legend-swatch" style="background:var(--heat-5)"></span>&gt;80%</div>
`;

// ===== Configs =====
const CONFIGS = {
  a: { dotR: 3,  tapR: 10, quizR: 8,  even: false, rings: false, sizeEncode: false, stringW: s => 0.7 + s * 0.3 },
  b: { dotR: 5,  tapR: 12, quizR: 10, even: false, rings: false, sizeEncode: false, stringW: s => 1 + s * 0.4 },
  c: { dotR: 5,  tapR: 12, quizR: 10, even: true,  rings: false, sizeEncode: false, stringW: s => 1 + s * 0.4 },
  d: { dotR: 7,  tapR: 12, quizR: 10, even: false, rings: true,  sizeEncode: false, stringW: s => 1 + s * 0.4 },
  e: { dotR: 5,  tapR: 12, quizR: 10, even: false, rings: false, sizeEncode: true,  stringW: s => 1 + s * 0.4 },
};

// ===== Build =====
function buildFretboard(id, cfg) {
  const even = cfg.even;
  const nutX = even ? OPEN_W : FRET_POS[1];
  const totalW = even ? EVEN_W : W;
  let svg = `<svg viewBox="0 0 ${totalW} ${H}">`;

  // Fret markers — darker, fret 12 between strings
  for (const m of MARKERS) {
    const cx = noteX(m, even);
    if (m === 12) {
      // Between 2nd & 3rd strings (index 1 & 2), and 3rd & 4th (index 3 & 4)
      const y1 = (noteY(1) + noteY(2)) / 2;
      const y2 = (noteY(3) + noteY(4)) / 2;
      svg += `<circle class="fb-marker" cx="${cx}" cy="${y1}" r="4"/>`;
      svg += `<circle class="fb-marker" cx="${cx}" cy="${y2}" r="4"/>`;
    } else {
      svg += `<circle class="fb-marker" cx="${cx}" cy="${H / 2}" r="4"/>`;
    }
  }

  // Nut
  svg += `<rect class="fb-nut" x="${nutX - 2}" y="0" width="4" height="${H}" rx="1"/>`;

  // Frets
  if (even) {
    for (let f = 2; f <= FRETS; f++) {
      const x = evenFretX(f);
      svg += `<line class="fb-fret" x1="${x}" y1="0" x2="${x}" y2="${H}" stroke-width="1"/>`;
    }
  } else {
    for (let f = 2; f < FRET_POS.length; f++) {
      svg += `<line class="fb-fret" x1="${FRET_POS[f]}" y1="0" x2="${FRET_POS[f]}" y2="${H}" stroke-width="1"/>`;
    }
  }

  // Strings
  for (let s = 0; s < 6; s++) {
    svg += `<line class="fb-string" x1="0" y1="${noteY(s)}" x2="${totalW}" y2="${noteY(s)}" stroke-width="${cfg.stringW(s)}"/>`;
  }

  // Per-position elements
  for (let s = 0; s < 6; s++) {
    for (let f = 0; f < FRETS; f++) {
      const x = noteX(f, even), y = noteY(s);
      const ds = `data-s="${s}" data-f="${f}"`;

      // Quiz highlight (solid dot)
      svg += `<circle class="fb-quiz-hl" ${ds} cx="${x}" cy="${y}" r="${cfg.quizR}"/>`;

      // Tap target (outlined circle)
      svg += `<circle class="fb-tap" ${ds} cx="${x}" cy="${y}" r="${cfg.tapR}"/>`;

      // Heatmap dot or ring
      if (cfg.rings) {
        svg += `<circle class="fb-ring" ${ds} cx="${x}" cy="${y}" r="${cfg.dotR}"/>`;
      } else {
        svg += `<circle class="fb-dot" ${ds} cx="${x}" cy="${y}" r="${cfg.dotR}"/>`;
      }
    }
  }

  // Fret numbers
  for (const m of MARKERS) {
    const cx = noteX(m, even);
    svg += `<text class="fb-fret-num" x="${cx}" y="${H - 3}">${m}</text>`;
  }

  svg += '</svg>';
  document.getElementById('fb-' + id).innerHTML = svg;
}

// ===== Update state =====
function updateState(id, state, cfg) {
  const root = document.getElementById('fb-' + id);
  const legend = document.getElementById('legend-' + id);
  const prompt = document.getElementById('tap-prompt-' + id);
  const dotSel = cfg.rings ? '.fb-ring' : '.fb-dot';

  // Reset all
  root.querySelectorAll('.fb-quiz-hl').forEach(c => c.setAttribute('class', 'fb-quiz-hl'));
  root.querySelectorAll('.fb-tap').forEach(c => c.setAttribute('class', 'fb-tap'));
  root.querySelectorAll(dotSel).forEach(c => {
    c.setAttribute('class', cfg.rings ? 'fb-ring' : 'fb-dot');
    if (cfg.sizeEncode) c.setAttribute('r', cfg.dotR);
  });

  prompt.textContent = '';

  if (state === 'quiz') {
    root.querySelectorAll('.fb-quiz-hl').forEach(c => {
      if (+c.dataset.s === HL_S && +c.dataset.f === HL_F) {
        c.setAttribute('class', 'fb-quiz-hl visible');
      }
    });
  } else if (state === 'tap') {
    prompt.textContent = 'Find: ' + TAP_NOTE;
    // Show all tap targets
    root.querySelectorAll('.fb-tap').forEach(c => {
      c.setAttribute('class', 'fb-tap visible');
      // Highlight correct positions (all G notes for demo)
      const note = noteAt(+c.dataset.s, +c.dataset.f);
      if (note === TAP_NOTE) {
        c.setAttribute('class', 'fb-tap visible correct');
      }
    });
  } else if (state === 'stats') {
    root.querySelectorAll(dotSel).forEach(c => {
      const s = +c.dataset.s, f = +c.dataset.f;
      const sk = fakeSkill(s, f);
      const base = cfg.rings ? 'fb-ring' : 'fb-dot';
      c.setAttribute('class', base + ' visible heat-' + heatLevel(sk));
      if (cfg.sizeEncode) {
        // Bigger = weaker: r from 3 (strong) to 9 (weak)
        const r = 3 + (1 - sk) * 6;
        c.setAttribute('r', r.toFixed(1));
      }
    });
  }
  // blank: everything hidden (default)

  legend.style.display = state === 'stats' ? 'flex' : 'none';
  legend.innerHTML = state === 'stats' ? LEGEND_HTML : '';
}

// ===== Hover card =====
function setupHoverCard(id, cfg) {
  const root = document.getElementById('fb-' + id);
  const card = document.getElementById('hc-' + id);
  const dotSel = cfg.rings ? '.fb-ring' : '.fb-dot';

  function showCard(el) {
    const s = +el.dataset.s, f = +el.dataset.f;
    const note = noteAt(s, f);
    const sk = fakeSkill(s, f);
    const pct = Math.round(sk * 100);

    card.querySelector('.hc-note').textContent = note;
    const detail = card.querySelector('.hc-detail');
    if (detail) detail.textContent = heatLabel(sk) + ' \u00B7 ' + pct + '%';

    const barFill = card.querySelector('.hc-bar-fill');
    if (barFill) {
      barFill.style.width = pct + '%';
      // Color from the heatmap scale
      const colors = ['hsl(15,55%,68%)', 'hsl(35,55%,58%)', 'hsl(55,45%,50%)', 'hsl(72,42%,42%)', 'hsl(88,52%,33%)'];
      const ci = sk > 0.8 ? 4 : sk > 0.6 ? 3 : sk > 0.4 ? 2 : sk > 0.2 ? 1 : 0;
      barFill.style.background = colors[ci];
    }

    // Position the card near the element
    const svgRect = root.querySelector('svg').getBoundingClientRect();
    const wrapRect = root.closest('.fretboard-wrap').getBoundingClientRect();
    const elRect = el.getBoundingClientRect();

    const cx = elRect.left + elRect.width / 2 - wrapRect.left;
    const cy = elRect.top - wrapRect.top;

    card.style.left = cx + 'px';
    card.style.top = (cy - 6) + 'px';
    card.style.transform = 'translate(-50%, -100%)';
    card.classList.add('visible');
  }

  function hideCard() {
    card.classList.remove('visible');
  }

  // Attach to all interactive elements (dots/rings + tap targets)
  root.addEventListener('mouseover', e => {
    const el = e.target.closest(dotSel + '.visible, .fb-tap.visible');
    if (el) showCard(el);
  });
  root.addEventListener('mouseout', e => {
    const el = e.target.closest(dotSel + ', .fb-tap');
    if (el) hideCard();
  });
}

// ===== Init =====
for (const [id, cfg] of Object.entries(CONFIGS)) {
  buildFretboard(id, cfg);
  updateState(id, 'quiz', cfg);
  setupHoverCard(id, cfg);
}

// Wire up toggles
document.querySelectorAll('.state-toggles').forEach(group => {
  const id = group.dataset.v;
  group.addEventListener('click', e => {
    const btn = e.target.closest('.state-btn');
    if (!btn) return;
    group.querySelectorAll('.state-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updateState(id, btn.dataset.state, CONFIGS[id]);
  });
});
</script>
</body>
</html>
